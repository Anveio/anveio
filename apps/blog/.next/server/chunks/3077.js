"use strict";exports.id=3077,exports.ids=[3077],exports.modules={98719:(e,t,i)=>{i.d(t,{Z:()=>requiredArgs});function requiredArgs(e,t){if(t.length<e)throw TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}},13971:(e,t,i)=>{i.d(t,{Z:()=>toInteger});function toInteger(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}},33925:(e,t,i)=>{i.d(t,{Z:()=>addDays});var s=i(13971),r=i(78909),n=i(98719);function addDays(e,t){(0,n.Z)(2,arguments);var i=(0,r.Z)(e),a=(0,s.Z)(t);return isNaN(a)?new Date(NaN):(a&&i.setDate(i.getDate()+a),i)}},78909:(e,t,i)=>{i.d(t,{Z:()=>toDate});var s=i(56170),r=i(98719);function toDate(e){(0,r.Z)(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===(0,s.Z)(e)&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):(("string"==typeof e||"[object String]"===t)&&"undefined"!=typeof console&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(Error().stack)),new Date(NaN))}},56170:(e,t,i)=>{i.d(t,{Z:()=>_typeof});function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}},49295:(e,t,i)=>{function format(e,t){let i;return Array.isArray(t)?(i=0,e.replace(/\?/g,e=>i<t.length?sanitize(t[i++]):e)):e.replace(/:(\w+)/g,(e,i)=>Object.prototype.hasOwnProperty.call(t,i)?sanitize(t[i]):e)}function sanitize(e){return null==e?"null":"number"==typeof e?String(e):"boolean"==typeof e?e?"true":"false":"string"==typeof e?quote(e):Array.isArray(e)?e.map(sanitize).join(", "):e instanceof Date?quote(e.toISOString().replace("Z","")):quote(e.toString())}function quote(e){return`'${e.replace(s,replacement)}'`}i.d(t,{$j:()=>connect});let s=/[\0\b\n\r\t\x1a\\"']/g;function replacement(e){switch(e){case'"':return'\\"';case"'":return"\\'";case"\n":return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\\":return"\\\\";case"\x00":return"\\0";case"\b":return"\\b";case"\x1a":return"\\Z";default:return""}}let r=new TextDecoder("utf-8");function decode(e){return e?r.decode(Uint8Array.from(e.split("").map(e=>e.charCodeAt(0)))):""}let DatabaseError=class DatabaseError extends Error{constructor(e,t,i){super(e),this.status=t,this.name="DatabaseError",this.body=i}};let n={as:"object"};let Tx=class Tx{constructor(e){this.conn=e}async execute(e,t=null,i=n){return this.conn.execute(e,t,i)}};let Connection=class Connection{constructor(e){var t;if(this.session=null,this.config={...e},"undefined"!=typeof fetch&&((t=this.config).fetch||(t.fetch=fetch)),e.url){let t=new URL(e.url);this.config.username=t.username,this.config.password=t.password,this.config.host=t.hostname,this.url=function(e){var t;let i=`${"http:"===(t=e.protocol)?t:"https:"}//`;return new URL(e.pathname,`${i}${e.host}`).toString()}(t)}else this.url=new URL(`https://${this.config.host}`).toString()}async transaction(e){let t=new Connection(this.config),i=new Tx(t);try{await i.execute("BEGIN");let t=await e(i);return await i.execute("COMMIT"),t}catch(e){throw await i.execute("ROLLBACK"),e}}async refresh(){await this.createSession()}async execute(e,t=null,i=n){let s=new URL("/psdb.v1alpha1.Database/Execute",this.url),r=this.config.format||format,a=t?r(e,t):e,l=await postJSON(this.config,s,{query:a,session:this.session}),{result:o,session:u,error:c,timing:h}=l;if(u&&(this.session=u),c)throw new DatabaseError(c.message,400,c);let d=o?.rowsAffected?parseInt(o.rowsAffected,10):0,f=o?.insertId??"0",m=o?.fields??[];for(let e of m)e.type||(e.type="NULL");let y=i.cast||this.config.cast||cast,p=o?function(e,t,i){let s=e.fields,r=e.rows??[];return r.map(e=>"array"===i?function(e,t,i){let s=decodeRow(t);return e.map((e,t)=>i(e,s[t]))}(s,e,t):function(e,t,i){let s=decodeRow(t);return e.reduce((e,t,r)=>(e[t.name]=i(t,s[r]),e),{})}(s,e,t))}(o,y,i.as||"object"):[],g=m.map(e=>e.name),S=m.reduce((e,{name:t,type:i})=>({...e,[t]:i}),{});return{headers:g,types:S,fields:m,rows:p,rowsAffected:d,insertId:f,size:p.length,statement:a,time:1e3*(h??0)}}async createSession(){let e=new URL("/psdb.v1alpha1.Database/CreateSession",this.url),{session:t}=await postJSON(this.config,e);return this.session=t,t}};async function postJSON(e,t,i={}){let s=btoa(`${e.username}:${e.password}`),{fetch:r}=e,n=await r(t.toString(),{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json","User-Agent":"database-js/1.11.0",Authorization:`Basic ${s}`},cache:"no-store"});if(n.ok)return await n.json();{let e=null;try{let t=(await n.json()).error;e=new DatabaseError(t.message,n.status,t)}catch{e=new DatabaseError(n.statusText,n.status,{code:"internal",message:n.statusText})}throw e}}function connect(e){return new Connection(e)}function decodeRow(e){let t=e.values?atob(e.values):"",i=0;return e.lengths.map(e=>{let s=parseInt(e,10);if(s<0)return null;let r=t.substring(i,i+s);return i+=s,r})}function cast(e,t){if(""===t||null==t)return t;switch(e.type){case"INT8":case"INT16":case"INT24":case"INT32":case"UINT8":case"UINT16":case"UINT24":case"UINT32":case"YEAR":return parseInt(t,10);case"FLOAT32":case"FLOAT64":return parseFloat(t);case"DECIMAL":case"INT64":case"UINT64":case"DATE":case"TIME":case"DATETIME":case"TIMESTAMP":case"BLOB":case"BIT":case"VARBINARY":case"BINARY":case"GEOMETRY":return t;case"JSON":return JSON.parse(decode(t));default:return decode(t)}}},24121:(e,t,i)=>{i.d(t,{s:()=>Column});var s=i(23638);let Column=class Column{constructor(e,t){this.enumValues=void 0,this.table=e,this.config=t,this.name=t.name,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType}static{this[s.Q]="Column"}mapFromDriverValue(e){return e}mapToDriverValue(e){return e}}},23638:(e,t,i)=>{i.d(t,{Q:()=>s,is:()=>is});let s=Symbol.for("drizzle:entityKind");function is(e,t){if(!e||"object"!=typeof e)return!1;if(e instanceof t)return!0;if(!Object.prototype.hasOwnProperty.call(t,s))throw Error(`Class "${t.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let i=e.constructor;if(i)for(;i;){if(s in i&&i[s]===t[s])return!0;i=Object.getPrototypeOf(i)}return!1}Symbol.for("drizzle:hasOwnEntityKind")},84515:(e,t,i)=>{i.d(t,{Kv:()=>bigint});var s=i(23638),r=i(5753);let MySqlBigInt53Builder=class MySqlBigInt53Builder extends r.Tq{static{this[s.Q]="MySqlBigInt53Builder"}constructor(e,t=!1){super(e,"number","MySqlBigInt53"),this.config.unsigned=t}build(e){return new MySqlBigInt53(e,this.config)}};let MySqlBigInt53=class MySqlBigInt53 extends r.mZ{static{this[s.Q]="MySqlBigInt53"}getSQLType(){return`bigint${this.config.unsigned?" unsigned":""}`}mapFromDriverValue(e){return"number"==typeof e?e:Number(e)}};let MySqlBigInt64Builder=class MySqlBigInt64Builder extends r.Tq{static{this[s.Q]="MySqlBigInt64Builder"}constructor(e,t=!1){super(e,"bigint","MySqlBigInt64"),this.config.unsigned=t}build(e){return new MySqlBigInt64(e,this.config)}};let MySqlBigInt64=class MySqlBigInt64 extends r.mZ{static{this[s.Q]="MySqlBigInt64"}getSQLType(){return`bigint${this.config.unsigned?" unsigned":""}`}mapFromDriverValue(e){return BigInt(e)}};function bigint(e,t){return"number"===t.mode?new MySqlBigInt53Builder(e,t.unsigned):new MySqlBigInt64Builder(e,t.unsigned)}},5753:(e,t,i)=>{i.d(t,{zB:()=>MySqlColumn,B1:()=>MySqlColumnBuilder,Tq:()=>MySqlColumnBuilderWithAutoIncrement,mZ:()=>MySqlColumnWithAutoIncrement});var s=i(23638);let ColumnBuilder=class ColumnBuilder{static{this[s.Q]="ColumnBuilder"}constructor(e,t,i){this.$default=this.$defaultFn,this.config={name:e,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:i}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}};var r=i(24121),n=i(25668);let ForeignKeyBuilder=class ForeignKeyBuilder{static{this[s.Q]="MySqlForeignKeyBuilder"}constructor(e,t){this.reference=()=>{let{name:t,columns:i,foreignColumns:s}=e();return{name:t,columns:i,foreignTable:s[0].table,foreignColumns:s}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e,this}onDelete(e){return this._onDelete=e,this}build(e){return new ForeignKey(e,this)}};let ForeignKey=class ForeignKey{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static{this[s.Q]="MySqlForeignKey"}getName(){let{name:e,columns:t,foreignColumns:i}=this.reference(),s=t.map(e=>e.name),r=i.map(e=>e.name),a=[this.table[n.zV.Symbol.Name],...s,i[0].table[n.zV.Symbol.Name],...r];return e??`${a.join("_")}_fk`}};function uniqueKeyName(e,t){return`${e[n.zV.Symbol.Name]}_${t.join("_")}_unique`}let UniqueConstraintBuilder=class UniqueConstraintBuilder{constructor(e,t){this.name=t,this.columns=e}static{this[s.Q]="MySqlUniqueConstraintBuilder"}build(e){return new UniqueConstraint(e,this.columns,this.name)}};let UniqueOnConstraintBuilder=class UniqueOnConstraintBuilder{static{this[s.Q]="MySqlUniqueOnConstraintBuilder"}constructor(e){this.name=e}on(...e){return new UniqueConstraintBuilder(e,this.name)}};let UniqueConstraint=class UniqueConstraint{constructor(e,t,i){this.nullsNotDistinct=!1,this.table=e,this.columns=t,this.name=i??uniqueKeyName(this.table,this.columns.map(e=>e.name))}static{this[s.Q]="MySqlUniqueConstraint"}getName(){return this.name}};let MySqlColumnBuilder=class MySqlColumnBuilder extends ColumnBuilder{static{this[s.Q]="MySqlColumnBuilder"}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e){return this.config.isUnique=!0,this.config.uniqueName=e,this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:i,actions:s})=>((i,s)=>{let r=new ForeignKeyBuilder(()=>{let t=i();return{columns:[e],foreignColumns:[t]}});return s.onUpdate&&r.onUpdate(s.onUpdate),s.onDelete&&r.onDelete(s.onDelete),r.build(t)})(i,s))}constructor(...e){super(...e),this.foreignKeyConfigs=[]}};let MySqlColumn=class MySqlColumn extends r.s{constructor(e,t){t.uniqueName||(t.uniqueName=uniqueKeyName(e,[t.name])),super(e,t),this.table=e}static{this[s.Q]="MySqlColumn"}};let MySqlColumnBuilderWithAutoIncrement=class MySqlColumnBuilderWithAutoIncrement extends MySqlColumnBuilder{static{this[s.Q]="MySqlColumnBuilderWithAutoIncrement"}constructor(e,t,i){super(e,t,i),this.config.autoIncrement=!1}autoincrement(){return this.config.autoIncrement=!0,this.config.hasDefault=!0,this}};let MySqlColumnWithAutoIncrement=class MySqlColumnWithAutoIncrement extends MySqlColumn{static{this[s.Q]="MySqlColumnWithAutoIncrement"}constructor(...e){super(...e),this.autoIncrement=this.config.autoIncrement}}},20461:(e,t,i)=>{i.d(t,{AV:()=>json});var s=i(23638),r=i(5753);let MySqlJsonBuilder=class MySqlJsonBuilder extends r.B1{static{this[s.Q]="MySqlJsonBuilder"}constructor(e){super(e,"json","MySqlJson")}build(e){return new MySqlJson(e,this.config)}};let MySqlJson=class MySqlJson extends r.zB{static{this[s.Q]="MySqlJson"}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}};function json(e){return new MySqlJsonBuilder(e)}},98683:(e,t,i)=>{i.d(t,{eP:()=>serial});var s=i(23638),r=i(5753);let MySqlSerialBuilder=class MySqlSerialBuilder extends r.Tq{static{this[s.Q]="MySqlSerialBuilder"}constructor(e){super(e,"number","MySqlSerial"),this.config.hasDefault=!0,this.config.autoIncrement=!0}build(e){return new MySqlSerial(e,this.config)}};let MySqlSerial=class MySqlSerial extends r.mZ{static{this[s.Q]="MySqlSerial"}getSQLType(){return"serial"}mapFromDriverValue(e){return"string"==typeof e?Number(e):e}};function serial(e){return new MySqlSerialBuilder(e)}},20320:(e,t,i)=>{i.d(t,{AB:()=>timestamp});var s=i(23638),r=i(12212),n=i(5753);let MySqlDateColumnBaseBuilder=class MySqlDateColumnBaseBuilder extends n.B1{static{this[s.Q]="MySqlDateColumnBuilder"}defaultNow(){return this.default(r.i6`(now())`)}onUpdateNow(){return this.config.hasOnUpdateNow=!0,this.config.hasDefault=!0,this}};let MySqlDateBaseColumn=class MySqlDateBaseColumn extends n.zB{static{this[s.Q]="MySqlDateColumn"}constructor(...e){super(...e),this.hasOnUpdateNow=this.config.hasOnUpdateNow}};let MySqlTimestampBuilder=class MySqlTimestampBuilder extends MySqlDateColumnBaseBuilder{static{this[s.Q]="MySqlTimestampBuilder"}constructor(e,t){super(e,"date","MySqlTimestamp"),this.config.fsp=t?.fsp}build(e){return new MySqlTimestamp(e,this.config)}};let MySqlTimestamp=class MySqlTimestamp extends MySqlDateBaseColumn{static{this[s.Q]="MySqlTimestamp"}getSQLType(){let e=void 0===this.fsp?"":`(${this.fsp})`;return`timestamp${e}`}mapFromDriverValue(e){return new Date(e+"+0000")}mapToDriverValue(e){return e.toISOString().slice(0,-1).replace("T"," ")}constructor(...e){super(...e),this.fsp=this.config.fsp}};let MySqlTimestampStringBuilder=class MySqlTimestampStringBuilder extends MySqlDateColumnBaseBuilder{static{this[s.Q]="MySqlTimestampStringBuilder"}constructor(e,t){super(e,"string","MySqlTimestampString"),this.config.fsp=t?.fsp}build(e){return new MySqlTimestampString(e,this.config)}};let MySqlTimestampString=class MySqlTimestampString extends MySqlDateBaseColumn{static{this[s.Q]="MySqlTimestampString"}getSQLType(){let e=void 0===this.fsp?"":`(${this.fsp})`;return`timestamp${e}`}constructor(...e){super(...e),this.fsp=this.config.fsp}};function timestamp(e,t={}){return"string"===t.mode?new MySqlTimestampStringBuilder(e,t):new MySqlTimestampBuilder(e,t)}},438:(e,t,i)=>{i.d(t,{L7:()=>varchar});var s=i(23638),r=i(5753);let MySqlVarCharBuilder=class MySqlVarCharBuilder extends r.B1{static{this[s.Q]="MySqlVarCharBuilder"}constructor(e,t){super(e,"string","MySqlVarChar"),this.config.length=t.length,this.config.enum=t.enum}build(e){return new MySqlVarChar(e,this.config)}};let MySqlVarChar=class MySqlVarChar extends r.zB{static{this[s.Q]="MySqlVarChar"}getSQLType(){return void 0===this.length?"varchar":`varchar(${this.length})`}constructor(...e){super(...e),this.length=this.config.length,this.enumValues=this.config.enum}};function varchar(e,t){return new MySqlVarCharBuilder(e,t)}},20211:(e,t,i)=>{i.d(t,{o9:()=>uniqueIndex});var s=i(23638);let IndexBuilderOn=class IndexBuilderOn{constructor(e,t){this.name=e,this.unique=t}static{this[s.Q]="MySqlIndexBuilderOn"}on(...e){return new IndexBuilder(this.name,e,this.unique)}};let IndexBuilder=class IndexBuilder{static{this[s.Q]="MySqlIndexBuilder"}constructor(e,t,i){this.config={name:e,columns:t,unique:i}}using(e){return this.config.using=e,this}algorythm(e){return this.config.algorythm=e,this}lock(e){return this.config.lock=e,this}build(e){return new Index(this.config,e)}};let Index=class Index{static{this[s.Q]="MySqlIndex"}constructor(e,t){this.config={...e,table:t}}};function uniqueIndex(e){return new IndexBuilderOn(e,!0)}},25668:(e,t,i)=>{let s;i.d(t,{iq:()=>mysqlTable,zV:()=>MySqlTable});var r=i(23638),n=i(87455);let a=Symbol.for("drizzle:MySqlInlineForeignKeys");let MySqlTable=class MySqlTable extends n.iA{static{n.iA.Symbol.Columns,s=n.iA.Symbol.ExtraConfigBuilder}static{this[r.Q]="MySqlTable"}static{this.Symbol=Object.assign({},n.iA.Symbol,{InlineForeignKeys:a})}constructor(...e){super(...e),this[a]=[],this[s]=void 0}};let mysqlTable=(e,t,i)=>(function(e,t,i,s,r=e){let l=new MySqlTable(e,s,r),o=Object.fromEntries(Object.entries(t).map(([e,t])=>{let i=t.build(l);return l[a].push(...t.buildForeignKeys(i,l)),[e,i]})),u=Object.assign(l,o);return u[n.iA.Symbol.Columns]=o,i&&(u[MySqlTable.Symbol.ExtraConfigBuilder]=i),u})(e,t,i,void 0,e)},33974:(e,t,i)=>{let s;i.d(t,{t:()=>drizzle});var r=i(23638);let ConsoleLogWriter=class ConsoleLogWriter{static{this[r.Q]="ConsoleLogWriter"}write(e){console.log(e)}};let DefaultLogger=class DefaultLogger{static{this[r.Q]="DefaultLogger"}constructor(e){this.writer=e?.writer??new ConsoleLogWriter}logQuery(e,t){let i=t.map(e=>{try{return JSON.stringify(e)}catch{return String(e)}}),s=i.length?` -- params: [${i.join(", ")}]`:"";this.writer.write(`Query: ${e}${s}`)}};let NoopLogger=class NoopLogger{static{this[r.Q]="NoopLogger"}logQuery(){}};var n=i(24121),a=i(12212),l=i(87455),o=i(99769);let ColumnAliasProxyHandler=class ColumnAliasProxyHandler{constructor(e){this.table=e}static{this[r.Q]="ColumnAliasProxyHandler"}get(e,t){return"table"===t?this.table:e[t]}};let TableAliasProxyHandler=class TableAliasProxyHandler{constructor(e,t){this.alias=e,this.replaceOriginalName=t}static{this[r.Q]="TableAliasProxyHandler"}get(e,t){if(t===l.iA.Symbol.IsAlias)return!0;if(t===l.iA.Symbol.Name||this.replaceOriginalName&&t===l.iA.Symbol.OriginalName)return this.alias;if(t===o.d)return{...e[o.d],name:this.alias,isAlias:!0};if(t===l.iA.Symbol.Columns){let t=e[l.iA.Symbol.Columns];if(!t)return t;let i={};return Object.keys(t).map(s=>{i[s]=new Proxy(t[s],new ColumnAliasProxyHandler(new Proxy(e,this)))}),i}let i=e[t];return(0,r.is)(i,n.s)?new Proxy(i,new ColumnAliasProxyHandler(new Proxy(e,this))):i}};let RelationTableAliasProxyHandler=class RelationTableAliasProxyHandler{constructor(e){this.alias=e}static{this[r.Q]="RelationTableAliasProxyHandler"}get(e,t){return"sourceTable"===t?aliasedTable(e.sourceTable,this.alias):e[t]}};function aliasedTable(e,t){return new Proxy(e,new TableAliasProxyHandler(t,!1))}function aliasedTableColumn(e,t){return new Proxy(e,new ColumnAliasProxyHandler(new Proxy(e.table,new TableAliasProxyHandler(t,!1))))}function mapColumnsInAliasedSQLToAlias(e,t){return new a.$s.Aliased(mapColumnsInSQLToAlias(e.sql,t),e.fieldAlias)}function mapColumnsInSQLToAlias(e,t){return a.i6.join(e.queryChunks.map(e=>(0,r.is)(e,n.s)?aliasedTableColumn(e,t):(0,r.is)(e,a.$s)?mapColumnsInSQLToAlias(e,t):(0,r.is)(e,a.$s.Aliased)?mapColumnsInAliasedSQLToAlias(e,t):e))}var u=i(27252);let SelectionProxyHandler=class SelectionProxyHandler{static{this[r.Q]="SelectionProxyHandler"}constructor(e){this.config={...e}}get(e,t){if(t===u.g1)return{...e[u.g1],selection:new Proxy(e[u.g1].selection,this)};if(t===o.d)return{...e[o.d],selectedFields:new Proxy(e[o.d].selectedFields,this)};if("symbol"==typeof t)return e[t];let i=(0,r.is)(e,u.k)?e[u.g1].selection:(0,r.is)(e,a.G7)?e[o.d].selectedFields:e,s=i[t];if((0,r.is)(s,a.$s.Aliased)){if("sql"===this.config.sqlAliasedBehavior&&!s.isSelectionField)return s.sql;let e=s.clone();return e.isSelectionField=!0,e}if((0,r.is)(s,a.$s)){if("sql"===this.config.sqlBehavior)return s;throw Error(`You tried to reference "${t}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return(0,r.is)(s,n.s)?this.config.alias?new Proxy(s,new ColumnAliasProxyHandler(new Proxy(s.table,new TableAliasProxyHandler(this.config.alias,this.config.replaceOriginalName??!1)))):s:"object"!=typeof s||null===s?s:new Proxy(s,new SelectionProxyHandler(this.config))}};var c=i(90663);function orderSelectedFields(e,t){return Object.entries(e).reduce((e,[i,s])=>{if("string"!=typeof i)return e;let o=t?[...t,i]:[i];return(0,r.is)(s,n.s)||(0,r.is)(s,a.$s)||(0,r.is)(s,a.$s.Aliased)?e.push({path:o,field:s}):(0,r.is)(s,l.iA)?e.push(...orderSelectedFields(s[l.iA.Symbol.Columns],o)):e.push(...orderSelectedFields(s,o)),e},[])}function haveSameKeys(e,t){let i=Object.keys(e),s=Object.keys(t);if(i.length!==s.length)return!1;for(let[e,t]of i.entries())if(t!==s[e])return!1;return!0}function mapUpdateSet(e,t){let i=Object.entries(t).filter(([,e])=>void 0!==e).map(([t,i])=>(0,r.is)(i,a.$s)?[t,i]:[t,new a.dO(i,e[l.iA.Symbol.Columns][t])]);if(0===i.length)throw Error("No values to set");return Object.fromEntries(i)}function getTableLikeName(e){return(0,r.is)(e,u.k)?e[u.g1].alias:(0,r.is)(e,a.G7)?e[o.d].name:(0,r.is)(e,a.$s)?void 0:e[l.iA.Symbol.IsAlias]?e[l.iA.Symbol.Name]:e[l.iA.Symbol.BaseName]}var h=i(31349);let DrizzleError=class DrizzleError extends Error{static{this[r.Q]="DrizzleError"}constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}};let TransactionRollbackError=class TransactionRollbackError extends DrizzleError{static{this[r.Q]="TransactionRollbackError"}constructor(){super({message:"Rollback"})}};var d=i(5753),f=i(25668);let MySqlViewBase=class MySqlViewBase extends a.G7{static{this[r.Q]="MySqlViewBase"}};let MySqlDialect=class MySqlDialect{static{this[r.Q]="MySqlDialect"}async migrate(e,t,i){let s=i.migrationsTable??"__drizzle_migrations",r=a.i6`
			create table if not exists ${a.i6.identifier(s)} (
				id serial primary key,
				hash text not null,
				created_at bigint
			)
		`;await t.execute(r);let n=await t.all(a.i6`select id, hash, created_at from ${a.i6.identifier(s)} order by created_at desc limit 1`),l=n[0];await t.transaction(async t=>{for(let i of e)if(!l||Number(l.created_at)<i.folderMillis){for(let e of i.sql)await t.execute(a.i6.raw(e));await t.execute(a.i6`insert into ${a.i6.identifier(s)} (\`hash\`, \`created_at\`) values(${i.hash}, ${i.folderMillis})`)}})}escapeName(e){return`\`${e}\``}escapeParam(e){return"?"}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildDeleteQuery({table:e,where:t,returning:i}){let s=i?a.i6` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,r=t?a.i6` where ${t}`:void 0;return a.i6`delete from ${e}${r}${s}`}buildUpdateSet(e,t){let i=Object.entries(t),s=i.length;return a.i6.join(i.flatMap(([t,i],r)=>{let n=e[l.iA.Symbol.Columns][t],o=a.i6`${a.i6.identifier(n.name)} = ${i}`;return r<s-1?[o,a.i6.raw(", ")]:[o]}))}buildUpdateQuery({table:e,set:t,where:i,returning:s}){let r=this.buildUpdateSet(e,t),n=s?a.i6` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,l=i?a.i6` where ${i}`:void 0;return a.i6`update ${e} set ${r}${l}${n}`}buildSelection(e,{isSingleTable:t=!1}={}){let i=e.length,s=e.flatMap(({field:e},s)=>{let l=[];if((0,r.is)(e,a.$s.Aliased)&&e.isSelectionField)l.push(a.i6.identifier(e.fieldAlias));else if((0,r.is)(e,a.$s.Aliased)||(0,r.is)(e,a.$s)){let i=(0,r.is)(e,a.$s.Aliased)?e.sql:e;t?l.push(new a.$s(i.queryChunks.map(e=>(0,r.is)(e,d.zB)?a.i6.identifier(e.name):e))):l.push(i),(0,r.is)(e,a.$s.Aliased)&&l.push(a.i6` as ${a.i6.identifier(e.fieldAlias)}`)}else(0,r.is)(e,n.s)&&(t?l.push(a.i6.identifier(e.name)):l.push(e));return s<i-1&&l.push(a.i6`, `),l});return a.i6.join(s)}buildSelectQuery({withList:e,fields:t,fieldsFlat:i,where:s,having:c,table:h,joins:d,orderBy:m,groupBy:y,limit:p,offset:g,lockingClause:S,distinct:b,setOperators:w}){let q,Q,$,v;let T=i??orderSelectedFields(t);for(let e of T){var N;if((0,r.is)(e.field,n.s)&&(0,l.SP)(e.field.table)!==((0,r.is)(h,u.k)?h[u.g1].alias:(0,r.is)(h,MySqlViewBase)?h[o.d].name:(0,r.is)(h,a.$s)?void 0:(0,l.SP)(h))&&(N=e.field.table,!d?.some(({alias:e})=>e===(N[l.iA.Symbol.IsAlias]?l.SP(N):N[l.iA.Symbol.BaseName])))){let t=(0,l.SP)(e.field.table);throw Error(`Your "${e.path.join("->")}" field references a column "${t}"."${e.field.name}", but the table "${t}" is not part of the query! Did you forget to join it?`)}}let M=!d||0===d.length;if(e?.length){let t=[a.i6`with `];for(let[i,s]of e.entries())t.push(a.i6`${a.i6.identifier(s[u.g1].alias)} as (${s[u.g1].sql})`),i<e.length-1&&t.push(a.i6`, `);t.push(a.i6` `),q=a.i6.join(t)}let A=b?a.i6` distinct`:void 0,x=this.buildSelection(T,{isSingleTable:M}),B=(0,r.is)(h,l.iA)&&h[l.iA.Symbol.OriginalName]!==h[l.iA.Symbol.Name]?a.i6`${a.i6.identifier(h[l.iA.Symbol.OriginalName])} ${a.i6.identifier(h[l.iA.Symbol.Name])}`:h,C=[];if(d)for(let[e,t]of d.entries()){0===e&&C.push(a.i6` `);let i=t.table,s=t.lateral?a.i6` lateral`:void 0;if((0,r.is)(i,f.zV)){let e=i[f.zV.Symbol.Name],r=i[f.zV.Symbol.Schema],n=i[f.zV.Symbol.OriginalName],l=e===n?void 0:t.alias;C.push(a.i6`${a.i6.raw(t.joinType)} join${s} ${r?a.i6`${a.i6.identifier(r)}.`:void 0}${a.i6.identifier(n)}${l&&a.i6` ${a.i6.identifier(l)}`} on ${t.on}`)}else if((0,r.is)(i,a.G7)){let e=i[o.d].name,r=i[o.d].schema,n=i[o.d].originalName,l=e===n?void 0:t.alias;C.push(a.i6`${a.i6.raw(t.joinType)} join${s} ${r?a.i6`${a.i6.identifier(r)}.`:void 0}${a.i6.identifier(n)}${l&&a.i6` ${a.i6.identifier(l)}`} on ${t.on}`)}else C.push(a.i6`${a.i6.raw(t.joinType)} join${s} ${i} on ${t.on}`);e<d.length-1&&C.push(a.i6` `)}let O=a.i6.join(C),P=s?a.i6` where ${s}`:void 0,j=c?a.i6` having ${c}`:void 0;m&&m.length>0&&(Q=a.i6` order by ${a.i6.join(m,a.i6`, `)}`),y&&y.length>0&&($=a.i6` group by ${a.i6.join(y,a.i6`, `)}`);let I=p?a.i6` limit ${p}`:void 0,L=g?a.i6` offset ${g}`:void 0;if(S){let{config:e,strength:t}=S;v=a.i6` for ${a.i6.raw(t)}`,e.noWait?v.append(a.i6` no wait`):e.skipLocked&&v.append(a.i6` skip locked`)}let D=a.i6`${q}select${A} ${x} from ${B}${O}${P}${$}${j}${Q}${I}${L}${v}`;return w.length>0?this.buildSetOperations(D,w):D}buildSetOperations(e,t){let[i,...s]=t;if(!i)throw Error("Cannot pass undefined values to any set operator");return 0===s.length?this.buildSetOperationQuery({leftSelect:e,setOperator:i}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:i}),s)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:i,rightSelect:s,limit:n,orderBy:l,offset:o}}){let u;let c=a.i6`(${e.getSQL()}) `,h=a.i6`(${s.getSQL()})`;if(l&&l.length>0){let e=[];for(let t of l)if((0,r.is)(t,d.zB))e.push(a.i6.identifier(t.name));else if((0,r.is)(t,a.$s)){for(let e=0;e<t.queryChunks.length;e++){let i=t.queryChunks[e];(0,r.is)(i,d.zB)&&(t.queryChunks[e]=a.i6.identifier(i.name))}e.push(a.i6`${t}`)}else e.push(a.i6`${t}`);u=a.i6` order by ${a.i6.join(e,a.i6`, `)} `}let f=n?a.i6` limit ${n}`:void 0,m=a.i6.raw(`${t} ${i?"all ":""}`),y=o?a.i6` offset ${o}`:void 0;return a.i6`${c}${m}${h}${u}${f}${y}`}buildInsertQuery({table:e,values:t,ignore:i,onConflict:s}){let n=[],o=e[l.iA.Symbol.Columns],u=Object.entries(o),c=u.map(([,e])=>a.i6.identifier(e.name));for(let[e,i]of t.entries()){let s=[];for(let[e,t]of u){let n=i[e];if(void 0===n||(0,r.is)(n,a.dO)&&void 0===n.value){if(void 0!==t.defaultFn){let e=t.defaultFn(),i=(0,r.is)(e,a.$s)?e:a.i6.param(e,t);s.push(i)}else s.push(a.i6`default`)}else s.push(n)}n.push(s),e<t.length-1&&n.push(a.i6`, `)}let h=a.i6.join(n),d=i?a.i6` ignore`:void 0,f=s?a.i6` on duplicate key ${s}`:void 0;return a.i6`insert${d} into ${e} ${c} values ${h}${f}`}sqlToQuery(e){return e.toQuery({escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString})}buildRelationalQuery({fullSchema:e,schema:t,tableNamesMap:i,table:s,tableConfig:o,queryConfig:d,tableAlias:m,nestedQueryRelation:y,joinOn:p}){let g,S,b,w,q,Q=[],$=[];if(!0===d){let e=Object.entries(o.columns);Q=e.map(([e,t])=>({dbKey:t.name,tsKey:e,field:aliasedTableColumn(t,m),relationTableTsKey:void 0,isJson:!1,selection:[]}))}else{let s=Object.fromEntries(Object.entries(o.columns).map(([e,t])=>[e,aliasedTableColumn(t,m)]));if(d.where){let e="function"==typeof d.where?d.where(s,(0,c.vU)()):d.where;w=e&&mapColumnsInSQLToAlias(e,m)}let f=[],y=[];if(d.columns){let e=!1;for(let[t,i]of Object.entries(d.columns))void 0!==i&&t in o.columns&&(e||!0!==i||(e=!0),y.push(t));y.length>0&&(y=e?y.filter(e=>d.columns?.[e]===!0):Object.keys(o.columns).filter(e=>!y.includes(e)))}else y=Object.keys(o.columns);for(let e of y){let t=o.columns[e];f.push({tsKey:e,value:t})}let p=[];if(d.with&&(p=Object.entries(d.with).filter(e=>!!e[1]).map(([e,t])=>({tsKey:e,queryConfig:t,relation:o.relations[e]}))),d.extras)for(let[e,t]of Object.entries("function"==typeof d.extras?d.extras(s,{sql:a.i6}):d.extras))f.push({tsKey:e,value:mapColumnsInAliasedSQLToAlias(t,m)});for(let{tsKey:e,value:t}of f)Q.push({dbKey:(0,r.is)(t,a.$s.Aliased)?t.fieldAlias:o.columns[e].name,tsKey:e,field:(0,r.is)(t,n.s)?aliasedTableColumn(t,m):t,relationTableTsKey:void 0,isJson:!1,selection:[]});let q="function"==typeof d.orderBy?d.orderBy(s,(0,c.pl)()):d.orderBy??[];for(let{tsKey:s,queryConfig:o,relation:f}of(Array.isArray(q)||(q=[q]),b=q.map(e=>(0,r.is)(e,n.s)?aliasedTableColumn(e,m):mapColumnsInSQLToAlias(e,m)),g=d.limit,S=d.offset,p)){let n=(0,c.wG)(t,i,f),d=f.referencedTable[l.iA.Symbol.Name],y=i[d],p=`${m}_${s}`,g=(0,h.xD)(...n.fields.map((e,t)=>(0,h.eq)(aliasedTableColumn(n.references[t],p),aliasedTableColumn(e,m)))),S=this.buildRelationalQuery({fullSchema:e,schema:t,tableNamesMap:i,table:e[y],tableConfig:t[y],queryConfig:(0,r.is)(f,c.fh)?!0===o?{limit:1}:{...o,limit:1}:o,tableAlias:p,joinOn:g,nestedQueryRelation:f}),b=a.i6`${a.i6.identifier(p)}.${a.i6.identifier("data")}`.as(s);$.push({on:a.i6`true`,table:new u.k(S.sql,{},p),alias:p,joinType:"left",lateral:!0}),Q.push({dbKey:s,tsKey:s,field:b,relationTableTsKey:y,isJson:!0,selection:S.selection})}}if(0===Q.length)throw new DrizzleError({message:`No fields selected for table "${o.tsName}" ("${m}")`});if(w=(0,h.xD)(p,w),y){let e=a.i6`json_array(${a.i6.join(Q.map(({field:e,tsKey:t,isJson:i})=>i?a.i6`${a.i6.identifier(`${m}_${t}`)}.${a.i6.identifier("data")}`:(0,r.is)(e,a.$s.Aliased)?e.sql:e),a.i6`, `)})`;(0,r.is)(y,c.sj)&&(e=a.i6`coalesce(json_arrayagg(${e}), json_array())`);let t=[{dbKey:"data",tsKey:"data",field:e.as("data"),isJson:!0,relationTableTsKey:o.tsName,selection:Q}],i=void 0!==g||void 0!==S||(b?.length??0)>0;i?(q=this.buildSelectQuery({table:aliasedTable(s,m),fields:{},fieldsFlat:[{path:[],field:a.i6.raw("*")},...(b?.length??0)>0?[{path:[],field:a.i6`row_number() over (order by ${a.i6.join(b,a.i6`, `)})`}]:[]],where:w,limit:g,offset:S,setOperators:[]}),w=void 0,g=void 0,S=void 0,b=void 0):q=aliasedTable(s,m),q=this.buildSelectQuery({table:(0,r.is)(q,f.zV)?q:new u.k(q,{},m),fields:{},fieldsFlat:t.map(({field:e})=>({path:[],field:(0,r.is)(e,n.s)?aliasedTableColumn(e,m):e})),joins:$,where:w,limit:g,offset:S,orderBy:b,setOperators:[]})}else q=this.buildSelectQuery({table:aliasedTable(s,m),fields:{},fieldsFlat:Q.map(({field:e})=>({path:[],field:(0,r.is)(e,n.s)?aliasedTableColumn(e,m):e})),joins:$,where:w,limit:g,offset:S,orderBy:b,setOperators:[]});return{tableTsKey:o.tsName,sql:q,selection:Q}}buildRelationalQueryWithoutLateralSubqueries({fullSchema:e,schema:t,tableNamesMap:i,table:s,tableConfig:o,queryConfig:m,tableAlias:y,nestedQueryRelation:p,joinOn:g}){let S,b=[],w,q,Q=[],$;if(!0===m){let e=Object.entries(o.columns);b=e.map(([e,t])=>({dbKey:t.name,tsKey:e,field:aliasedTableColumn(t,y),relationTableTsKey:void 0,isJson:!1,selection:[]}))}else{let s=Object.fromEntries(Object.entries(o.columns).map(([e,t])=>[e,aliasedTableColumn(t,y)]));if(m.where){let e="function"==typeof m.where?m.where(s,(0,c.vU)()):m.where;$=e&&mapColumnsInSQLToAlias(e,y)}let u=[],d=[];if(m.columns){let e=!1;for(let[t,i]of Object.entries(m.columns))void 0!==i&&t in o.columns&&(e||!0!==i||(e=!0),d.push(t));d.length>0&&(d=e?d.filter(e=>m.columns?.[e]===!0):Object.keys(o.columns).filter(e=>!d.includes(e)))}else d=Object.keys(o.columns);for(let e of d){let t=o.columns[e];u.push({tsKey:e,value:t})}let f=[];if(m.with&&(f=Object.entries(m.with).filter(e=>!!e[1]).map(([e,t])=>({tsKey:e,queryConfig:t,relation:o.relations[e]}))),m.extras)for(let[e,t]of Object.entries("function"==typeof m.extras?m.extras(s,{sql:a.i6}):m.extras))u.push({tsKey:e,value:mapColumnsInAliasedSQLToAlias(t,y)});for(let{tsKey:e,value:t}of u)b.push({dbKey:(0,r.is)(t,a.$s.Aliased)?t.fieldAlias:o.columns[e].name,tsKey:e,field:(0,r.is)(t,n.s)?aliasedTableColumn(t,y):t,relationTableTsKey:void 0,isJson:!1,selection:[]});let p="function"==typeof m.orderBy?m.orderBy(s,(0,c.pl)()):m.orderBy??[];for(let{tsKey:s,queryConfig:o,relation:u}of(Array.isArray(p)||(p=[p]),Q=p.map(e=>(0,r.is)(e,n.s)?aliasedTableColumn(e,y):mapColumnsInSQLToAlias(e,y)),w=m.limit,q=m.offset,f)){let n=(0,c.wG)(t,i,u),d=u.referencedTable[l.iA.Symbol.Name],f=i[d],m=`${y}_${s}`,p=(0,h.xD)(...n.fields.map((e,t)=>(0,h.eq)(aliasedTableColumn(n.references[t],m),aliasedTableColumn(e,y)))),g=this.buildRelationalQueryWithoutLateralSubqueries({fullSchema:e,schema:t,tableNamesMap:i,table:e[f],tableConfig:t[f],queryConfig:(0,r.is)(u,c.fh)?!0===o?{limit:1}:{...o,limit:1}:o,tableAlias:m,joinOn:p,nestedQueryRelation:u}),S=a.i6`(${g.sql})`;(0,r.is)(u,c.sj)&&(S=a.i6`coalesce(${S}, json_array())`);let w=S.as(s);b.push({dbKey:s,tsKey:s,field:w,relationTableTsKey:f,isJson:!0,selection:g.selection})}}if(0===b.length)throw new DrizzleError({message:`No fields selected for table "${o.tsName}" ("${y}"). You need to have at least one item in "columns", "with" or "extras". If you need to select all columns, omit the "columns" key or set it to undefined.`});if($=(0,h.xD)(g,$),p){let e=a.i6`json_array(${a.i6.join(b.map(({field:e})=>(0,r.is)(e,d.zB)?a.i6.identifier(e.name):(0,r.is)(e,a.$s.Aliased)?e.sql:e),a.i6`, `)})`;(0,r.is)(p,c.sj)&&(e=a.i6`json_arrayagg(${e})`);let t=[{dbKey:"data",tsKey:"data",field:e,isJson:!0,relationTableTsKey:o.tsName,selection:b}],i=void 0!==w||void 0!==q||Q.length>0;i?(S=this.buildSelectQuery({table:aliasedTable(s,y),fields:{},fieldsFlat:[{path:[],field:a.i6.raw("*")},...Q.length>0?[{path:[],field:a.i6`row_number() over (order by ${a.i6.join(Q,a.i6`, `)})`}]:[]],where:$,limit:w,offset:q,setOperators:[]}),$=void 0,w=void 0,q=void 0,Q=void 0):S=aliasedTable(s,y),S=this.buildSelectQuery({table:(0,r.is)(S,f.zV)?S:new u.k(S,{},y),fields:{},fieldsFlat:t.map(({field:e})=>({path:[],field:(0,r.is)(e,n.s)?aliasedTableColumn(e,y):e})),where:$,limit:w,offset:q,orderBy:Q,setOperators:[]})}else S=this.buildSelectQuery({table:aliasedTable(s,y),fields:{},fieldsFlat:b.map(({field:e})=>({path:[],field:(0,r.is)(e,n.s)?aliasedTableColumn(e,y):e})),where:$,limit:w,offset:q,orderBy:Q,setOperators:[]});return{tableTsKey:o.tsName,sql:S,selection:b}}};let TypedQueryBuilder=class TypedQueryBuilder{static{this[r.Q]="TypedQueryBuilder"}getSelectedFields(){return this._.selectedFields}};let QueryPromise=class QueryPromise{static{s=Symbol.toStringTag}static{this[r.Q]="QueryPromise"}catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}constructor(){this[s]="QueryPromise"}};let MySqlSelectBuilder=class MySqlSelectBuilder{static{this[r.Q]="MySqlSelectBuilder"}constructor(e){this.withList=[],this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}from(e){let t;let i=!!this.fields;return t=this.fields?this.fields:(0,r.is)(e,u.k)?Object.fromEntries(Object.keys(e[u.g1].selection).map(t=>[t,e[t]])):(0,r.is)(e,MySqlViewBase)?e[o.d].selectedFields:(0,r.is)(e,a.$s)?{}:e[l.iA.Symbol.Columns],new MySqlSelectBase({table:e,fields:t,isPartialSelect:i,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}};let MySqlSelectQueryBuilderBase=class MySqlSelectQueryBuilderBase extends TypedQueryBuilder{static{this[r.Q]="MySqlSelectQueryBuilder"}constructor({table:e,fields:t,isPartialSelect:i,session:s,dialect:r,withList:n,distinct:a}){super(),this.leftJoin=this.createJoin("left"),this.rightJoin=this.createJoin("right"),this.innerJoin=this.createJoin("inner"),this.fullJoin=this.createJoin("full"),this.union=this.createSetOperator("union",!1),this.unionAll=this.createSetOperator("union",!0),this.intersect=this.createSetOperator("intersect",!1),this.intersectAll=this.createSetOperator("intersect",!0),this.except=this.createSetOperator("except",!1),this.exceptAll=this.createSetOperator("except",!0),this.config={withList:n,table:e,fields:{...t},distinct:a,setOperators:[]},this.isPartialSelect=i,this.session=s,this.dialect=r,this._={selectedFields:t},this.tableName=getTableLikeName(e),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{}}createJoin(e){return(t,i)=>{let s=this.tableName,n=getTableLikeName(t);if("string"==typeof n&&this.config.joins?.some(e=>e.alias===n))throw Error(`Alias "${n}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof s&&(this.config.fields={[s]:this.config.fields}),"string"==typeof n&&!(0,r.is)(t,a.$s))){let e=(0,r.is)(t,u.k)?t[u.g1].selection:(0,r.is)(t,a.G7)?t[o.d].selectedFields:t[l.iA.Symbol.Columns];this.config.fields[n]=e}if("function"==typeof i&&(i=i(new Proxy(this.config.fields,new SelectionProxyHandler({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:i,table:t,joinType:e,alias:n}),"string"==typeof n)switch(e){case"left":this.joinsNotNullableMap[n]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[n]=!0;break;case"inner":this.joinsNotNullableMap[n]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[n]=!1}return this}}createSetOperator(e,t){return i=>{let s="function"==typeof i?i(getMySqlSetOperators()):i;if(!haveSameKeys(this.getSelectedFields(),s.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:s}),this}}addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new SelectionProxyHandler({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new SelectionProxyHandler({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if("function"==typeof e[0]){let t=e[0](new Proxy(this.config.fields,new SelectionProxyHandler({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if("function"==typeof e[0]){let t=e[0](new Proxy(this.config.fields,new SelectionProxyHandler({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),i=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}else this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=e:this.config.orderBy=e;return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){return new Proxy(new u.k(this.getSQL(),this.config.fields,e),new SelectionProxyHandler({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new SelectionProxyHandler({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}};let MySqlSelectBase=class MySqlSelectBase extends MySqlSelectQueryBuilderBase{static{this[r.Q]="MySqlSelect"}prepare(){if(!this.session)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let e=orderSelectedFields(this.config.fields),t=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),e);return t.joinsNotNullableMap=this.joinsNotNullableMap,t}constructor(...e){super(...e),this.execute=e=>this.prepare().execute(e),this.createIterator=()=>{let e=this;return async function*(t){yield*e.prepare().iterator(t)}},this.iterator=this.createIterator()}};function createSetOperator(e,t){return(i,s,...r)=>{let n=[s,...r].map(i=>({type:e,isAll:t,rightSelect:i}));for(let e of n)if(!haveSameKeys(i.getSelectedFields(),e.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return i.addSetOperators(n)}}!function(e,t){for(let i of t)for(let t of Object.getOwnPropertyNames(i.prototype))Object.defineProperty(e.prototype,t,Object.getOwnPropertyDescriptor(i.prototype,t)||Object.create(null))}(MySqlSelectBase,[QueryPromise]);let getMySqlSetOperators=()=>({union:m,unionAll:y,intersect:p,intersectAll:g,except:S,exceptAll:b}),m=createSetOperator("union",!1),y=createSetOperator("union",!0),p=createSetOperator("intersect",!1),g=createSetOperator("intersect",!0),S=createSetOperator("except",!1),b=createSetOperator("except",!0);let QueryBuilder=class QueryBuilder{static{this[r.Q]="MySqlQueryBuilder"}$with(e){let t=this;return{as:i=>("function"==typeof i&&(i=i(t)),new Proxy(new u.SC(i.getSQL(),i.getSelectedFields(),e,!0),new SelectionProxyHandler({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}}with(...e){let t=this;return{select:function(i){return new MySqlSelectBuilder({fields:i??void 0,session:void 0,dialect:t.getDialect(),withList:e})},selectDistinct:function(i){return new MySqlSelectBuilder({fields:i??void 0,session:void 0,dialect:t.getDialect(),withList:e,distinct:!0})}}}select(e){return new MySqlSelectBuilder({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new MySqlSelectBuilder({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}getDialect(){return this.dialect||(this.dialect=new MySqlDialect),this.dialect}};let MySqlUpdateBuilder=class MySqlUpdateBuilder{constructor(e,t,i){this.table=e,this.session=t,this.dialect=i}static{this[r.Q]="MySqlUpdateBuilder"}set(e){return new MySqlUpdateBase(this.table,mapUpdateSet(this.table,e),this.session,this.dialect)}};let MySqlUpdateBase=class MySqlUpdateBase extends QueryPromise{constructor(e,t,i,s){super(),this.execute=e=>this.prepare().execute(e),this.createIterator=()=>{let e=this;return async function*(t){yield*e.prepare().iterator(t)}},this.iterator=this.createIterator(),this.session=i,this.dialect=s,this.config={set:t,table:e}}static{this[r.Q]="MySqlUpdate"}where(e){return this.config.where=e,this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}prepare(){return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning)}$dynamic(){return this}};let MySqlInsertBuilder=class MySqlInsertBuilder{constructor(e,t,i){this.shouldIgnore=!1,this.table=e,this.session=t,this.dialect=i}static{this[r.Q]="MySqlInsertBuilder"}ignore(){return this.shouldIgnore=!0,this}values(e){if(0===(e=Array.isArray(e)?e:[e]).length)throw Error("values() must be called with at least one value");let t=e.map(e=>{let t={},i=this.table[l.iA.Symbol.Columns];for(let s of Object.keys(e)){let n=e[s];t[s]=(0,r.is)(n,a.$s)?n:new a.dO(n,i[s])}return t});return new MySqlInsertBase(this.table,t,this.shouldIgnore,this.session,this.dialect)}};let MySqlInsertBase=class MySqlInsertBase extends QueryPromise{constructor(e,t,i,s,r){super(),this.execute=e=>this.prepare().execute(e),this.createIterator=()=>{let e=this;return async function*(t){yield*e.prepare().iterator(t)}},this.iterator=this.createIterator(),this.session=s,this.dialect=r,this.config={table:e,values:t,ignore:i}}static{this[r.Q]="MySqlInsert"}onDuplicateKeyUpdate(e){let t=this.dialect.buildUpdateSet(this.config.table,mapUpdateSet(this.config.table,e.set));return this.config.onConflict=a.i6`update ${t}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}prepare(){return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0)}$dynamic(){return this}};let MySqlDeleteBase=class MySqlDeleteBase extends QueryPromise{constructor(e,t,i){super(),this.execute=e=>this.prepare().execute(e),this.createIterator=()=>{let e=this;return async function*(t){yield*e.prepare().iterator(t)}},this.iterator=this.createIterator(),this.table=e,this.session=t,this.dialect=i,this.config={table:e}}static{this[r.Q]="MySqlDelete"}where(e){return this.config.where=e,this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}prepare(){return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning)}$dynamic(){return this}};let RelationalQueryBuilder=class RelationalQueryBuilder{constructor(e,t,i,s,r,n,a,l){this.fullSchema=e,this.schema=t,this.tableNamesMap=i,this.table=s,this.tableConfig=r,this.dialect=n,this.session=a,this.mode=l}static{this[r.Q]="MySqlRelationalQueryBuilder"}findMany(e){return new MySqlRelationalQuery(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many",this.mode)}findFirst(e){return new MySqlRelationalQuery(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first",this.mode)}};let MySqlRelationalQuery=class MySqlRelationalQuery extends QueryPromise{constructor(e,t,i,s,r,n,a,l,o,u){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=i,this.table=s,this.tableConfig=r,this.dialect=n,this.session=a,this.config=l,this.queryMode=o,this.mode=u}static{this[r.Q]="MySqlRelationalQuery"}prepare(){let{query:e,builtQuery:t}=this._toSQL();return this.session.prepareQuery(t,void 0,t=>{let i=t.map(t=>(0,c.WX)(this.schema,this.tableConfig,t,e.selection));return"first"===this.queryMode?i[0]:i})}_getQuery(){let e="planetscale"===this.mode?this.dialect.buildRelationalQueryWithoutLateralSubqueries({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}):this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName});return e}_toSQL(){let e=this._getQuery(),t=this.dialect.sqlToQuery(e.sql);return{builtQuery:t,query:e}}getSQL(){return this._getQuery().sql}toSQL(){return this._toSQL().builtQuery}execute(){return this.prepare().execute()}};let MySqlDatabase=class MySqlDatabase{constructor(e,t,i,s){if(this.dialect=e,this.session=t,this.mode=s,this._=i?{schema:i.schema,tableNamesMap:i.tableNamesMap}:{schema:void 0,tableNamesMap:{}},this.query={},this._.schema)for(let[s,r]of Object.entries(this._.schema))this.query[s]=new RelationalQueryBuilder(i.fullSchema,this._.schema,this._.tableNamesMap,i.fullSchema[s],r,e,t,this.mode)}static{this[r.Q]="MySqlDatabase"}$with(e){return{as:t=>("function"==typeof t&&(t=t(new QueryBuilder)),new Proxy(new u.SC(t.getSQL(),t.getSelectedFields(),e,!0),new SelectionProxyHandler({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}}with(...e){let t=this;return{select:function(i){return new MySqlSelectBuilder({fields:i??void 0,session:t.session,dialect:t.dialect,withList:e})},selectDistinct:function(i){return new MySqlSelectBuilder({fields:i??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})}}}select(e){return new MySqlSelectBuilder({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new MySqlSelectBuilder({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}update(e){return new MySqlUpdateBuilder(e,this.session,this.dialect)}insert(e){return new MySqlInsertBuilder(e,this.session,this.dialect)}delete(e){return new MySqlDeleteBase(e,this.session,this.dialect)}execute(e){return this.session.execute(e.getSQL())}transaction(e,t){return this.session.transaction(e,t)}};let PreparedQuery=class PreparedQuery{static{this[r.Q]="MySqlPreparedQuery"}};let MySqlSession=class MySqlSession{constructor(e){this.dialect=e}static{this[r.Q]="MySqlSession"}execute(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0).execute()}getSetTransactionSQL(e){let t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),t.length?a.i6.join(["set transaction ",t.join(" ")]):void 0}getStartTransactionSQL(e){let t=[];return e.withConsistentSnapshot&&t.push("with consistent snapshot"),e.accessMode&&t.push(e.accessMode),t.length?a.i6.join(["start transaction ",t.join(" ")]):void 0}};let MySqlTransaction=class MySqlTransaction extends MySqlDatabase{constructor(e,t,i,s,r){super(e,t,i,r),this.schema=i,this.nestedIndex=s}static{this[r.Q]="MySqlTransaction"}rollback(){throw new TransactionRollbackError}};let PlanetScalePreparedQuery=class PlanetScalePreparedQuery extends PreparedQuery{constructor(e,t,i,s,r,n){super(),this.rawQuery={as:"object"},this.query={as:"array"},this.client=e,this.queryString=t,this.params=i,this.logger=s,this.fields=r,this.customResultMapper=n}static{this[r.Q]="PlanetScalePreparedQuery"}async execute(e={}){let t=(0,a.Pr)(this.params,e);this.logger.logQuery(this.queryString,t);let{fields:i,client:s,queryString:o,rawQuery:u,query:c,joinsNotNullableMap:h,customResultMapper:d}=this;if(!i&&!d)return s.execute(o,t,u);let{rows:f}=await s.execute(o,t,c);return d?d(f):f.map(e=>(function(e,t,i){let s={},o=e.reduce((e,{path:o,field:u},c)=>{let h;h=(0,r.is)(u,n.s)?u:(0,r.is)(u,a.$s)?u.decoder:u.sql.decoder;let d=e;for(let[e,a]of o.entries())if(e<o.length-1)a in d||(d[a]={}),d=d[a];else{let e=t[c],f=d[a]=null===e?null:h.mapFromDriverValue(e);if(i&&(0,r.is)(u,n.s)&&2===o.length){let e=o[0];e in s?"string"==typeof s[e]&&s[e]!==(0,l.SP)(u.table)&&(s[e]=!1):s[e]=null===f&&(0,l.SP)(u.table)}}return e},{});if(i&&Object.keys(s).length>0)for(let[e,t]of Object.entries(s))"string"!=typeof t||i[t]||(o[e]=null);return o})(i,e,h))}iterator(e){throw Error("Streaming is not supported by the PlanetScale Serverless driver")}};let PlanetscaleSession=class PlanetscaleSession extends MySqlSession{constructor(e,t,i,s,r={}){super(t),this.baseClient=e,this.schema=s,this.options=r,this.client=i??e,this.logger=r.logger??new NoopLogger}static{this[r.Q]="PlanetscaleSession"}prepareQuery(e,t,i){return new PlanetScalePreparedQuery(this.client,e.sql,e.params,this.logger,t,i)}async query(e,t){return this.logger.logQuery(e,t),await this.client.execute(e,t,{as:"array"})}async queryObjects(e,t){return this.client.execute(e,t,{as:"object"})}all(e){let t=this.dialect.sqlToQuery(e);return this.logger.logQuery(t.sql,t.params),this.client.execute(t.sql,t.params,{as:"object"}).then(e=>e.rows)}transaction(e){return this.baseClient.transaction(t=>{let i=new PlanetscaleSession(this.baseClient,this.dialect,t,this.schema,this.options),s=new PlanetScaleTransaction(this.dialect,i,this.schema);return e(s)})}};let PlanetScaleTransaction=class PlanetScaleTransaction extends MySqlTransaction{static{this[r.Q]="PlanetScaleTransaction"}constructor(e,t,i,s=0){super(e,t,i,s,"planetscale")}async transaction(e){let t=`sp${this.nestedIndex+1}`,i=new PlanetScaleTransaction(this.dialect,this.session,this.schema,this.nestedIndex+1);await i.execute(a.i6.raw(`savepoint ${t}`));try{let s=await e(i);return await i.execute(a.i6.raw(`release savepoint ${t}`)),s}catch(e){throw await i.execute(a.i6.raw(`rollback to savepoint ${t}`)),e}}};function drizzle(e,t={}){let i,s;let r=new MySqlDialect;if(!0===t.logger?i=new DefaultLogger:!1!==t.logger&&(i=t.logger),t.schema){let e=(0,c.pb)(t.schema,c._J);s={fullSchema:t.schema,schema:e.tables,tableNamesMap:e.tableNamesMap}}let n=new PlanetscaleSession(e,r,void 0,s,{logger:i});return new MySqlDatabase(r,n,s,"planetscale")}},90663:(e,t,i)=>{let s;i.d(t,{sj:()=>Many,fh:()=>One,or:()=>Relation,_J:()=>createTableRelationsHelpers,pb:()=>extractTablesRelationalConfig,vU:()=>getOperators,pl:()=>getOrderByOperators,WX:()=>function mapRelationalRow(e,t,i,s,r=e=>e){let l={};for(let[o,c]of s.entries())if(c.isJson){let s=t.relations[c.tsKey],n=i[o],u="string"==typeof n?JSON.parse(n):n;l[c.tsKey]=(0,a.is)(s,One)?u&&mapRelationalRow(e,e[c.relationTableTsKey],u,c.selection,r):u.map(t=>mapRelationalRow(e,e[c.relationTableTsKey],t,c.selection,r))}else{let e;let t=r(i[o]),s=c.field;e=(0,a.is)(s,n.s)?s:(0,a.is)(s,u.$s)?s.decoder:s.sql.decoder,l[c.tsKey]=null===t?null:e.mapFromDriverValue(t)}return l},wG:()=>normalizeRelation});var r=i(87455),n=i(24121),a=i(23638);let l=Symbol.for("drizzle:PgInlineForeignKeys");let PgTable=class PgTable extends r.iA{static{s=r.iA.Symbol.ExtraConfigBuilder}static{this[a.Q]="PgTable"}static{this.Symbol=Object.assign({},r.iA.Symbol,{InlineForeignKeys:l})}constructor(...e){super(...e),this[l]=[],this[s]=void 0}};let PrimaryKeyBuilder=class PrimaryKeyBuilder{static{this[a.Q]="PgPrimaryKeyBuilder"}constructor(e,t){this.columns=e,this.name=t}build(e){return new PrimaryKey(e,this.columns,this.name)}};let PrimaryKey=class PrimaryKey{constructor(e,t,i){this.table=e,this.columns=t,this.name=i}static{this[a.Q]="PgPrimaryKey"}getName(){return this.name??`${this.table[PgTable.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}};var o=i(31349),u=i(12212);function asc(e){return u.i6`${e} asc`}function desc(e){return u.i6`${e} desc`}let Relation=class Relation{constructor(e,t,i){this.sourceTable=e,this.referencedTable=t,this.relationName=i,this.referencedTableName=t[r.iA.Symbol.Name]}static{this[a.Q]="Relation"}};let Relations=class Relations{constructor(e,t){this.table=e,this.config=t}static{this[a.Q]="Relations"}};let One=class One extends Relation{constructor(e,t,i,s){super(e,t,i?.relationName),this.config=i,this.isNullable=s}static{this[a.Q]="One"}withFieldName(e){let t=new One(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}};let Many=class Many extends Relation{constructor(e,t,i){super(e,t,i?.relationName),this.config=i}static{this[a.Q]="Many"}withFieldName(e){let t=new Many(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}};function getOperators(){return{and:o.xD,between:o.vX,eq:o.eq,exists:o.Gg,gt:o.gt,gte:o.eg,ilike:o.o$,inArray:o.d3,isNull:o.Ft,isNotNull:o.K0,like:o.vL,lt:o.lt,lte:o.G,ne:o.ne,not:o.ff,notBetween:o.OL,notExists:o.UN,notLike:o.Qg,notIlike:o.mM,notInArray:o.Nl,or:o.or,sql:u.i6}}function getOrderByOperators(){return{sql:u.i6,asc:asc,desc:desc}}function extractTablesRelationalConfig(e,t){1===Object.keys(e).length&&"default"in e&&!(0,a.is)(e.default,r.iA)&&(e=e.default);let i={},s={},n={};for(let[l,o]of Object.entries(e))if((0,r.wb)(o)){let e=o[r.iA.Symbol.Name],t=s[e];for(let s of(i[e]=l,n[l]={tsName:l,dbName:o[r.iA.Symbol.Name],schema:o[r.iA.Symbol.Schema],columns:o[r.iA.Symbol.Columns],relations:t?.relations??{},primaryKey:t?.primaryKey??[]},Object.values(o[r.iA.Symbol.Columns])))s.primary&&n[l].primaryKey.push(s);let u=o[r.iA.Symbol.ExtraConfigBuilder]?.(o);if(u)for(let e of Object.values(u))(0,a.is)(e,PrimaryKeyBuilder)&&n[l].primaryKey.push(...e.columns)}else if((0,a.is)(o,Relations)){let e;let a=o.table[r.iA.Symbol.Name],l=i[a],u=o.config(t(o.table));for(let[t,i]of Object.entries(u))if(l){let s=n[l];s.relations[t]=i,e&&s.primaryKey.push(...e)}else a in s||(s[a]={relations:{},primaryKey:e}),s[a].relations[t]=i}return{tables:n,tableNamesMap:i}}function normalizeRelation(e,t,i){if((0,a.is)(i,One)&&i.config)return{fields:i.config.fields,references:i.config.references};let s=t[i.referencedTable[r.iA.Symbol.Name]];if(!s)throw Error(`Table "${i.referencedTable[r.iA.Symbol.Name]}" not found in schema`);let n=e[s];if(!n)throw Error(`Table "${s}" not found in schema`);let l=i.sourceTable,o=t[l[r.iA.Symbol.Name]];if(!o)throw Error(`Table "${l[r.iA.Symbol.Name]}" not found in schema`);let u=[];for(let e of Object.values(n.relations))(i.relationName&&i!==e&&e.relationName===i.relationName||!i.relationName&&e.referencedTable===i.sourceTable)&&u.push(e);if(u.length>1)throw i.relationName?Error(`There are multiple relations with name "${i.relationName}" in table "${s}"`):Error(`There are multiple relations between "${s}" and "${i.sourceTable[r.iA.Symbol.Name]}". Please specify relation name`);if(u[0]&&(0,a.is)(u[0],One)&&u[0].config)return{fields:u[0].config.references,references:u[0].config.fields};throw Error(`There is not enough information to infer relation "${o}.${i.fieldName}"`)}function createTableRelationsHelpers(e){return{one:function(t,i){return new One(e,t,i,i?.fields.reduce((e,t)=>e&&t.notNull,!0)??!1)},many:function(t,i){return new Many(e,t,i)}}}},31349:(e,t,i)=>{i.d(t,{Ft:()=>isNull,G:()=>lte,Gg:()=>exists,K0:()=>isNotNull,Nl:()=>notInArray,OL:()=>notBetween,Qg:()=>notLike,UN:()=>notExists,d3:()=>inArray,eg:()=>gte,eq:()=>eq,ff:()=>not,gt:()=>gt,lt:()=>lt,mM:()=>notIlike,ne:()=>ne,o$:()=>ilike,or:()=>or,vL:()=>like,vX:()=>between,xD:()=>and});var s=i(24121),r=i(23638),n=i(87455),a=i(12212);function bindIfParam(e,t){return!(0,a._B)(t)||(0,a.zl)(e)||(0,r.is)(e,a.dO)||(0,r.is)(e,a.Vm)||(0,r.is)(e,s.s)||(0,r.is)(e,n.iA)||(0,r.is)(e,a.G7)?e:new a.dO(e,t)}let eq=(e,t)=>a.i6`${e} = ${bindIfParam(t,e)}`,ne=(e,t)=>a.i6`${e} <> ${bindIfParam(t,e)}`;function and(...e){let t=e.filter(e=>void 0!==e);return 0===t.length?void 0:new a.$s(1===t.length?t:[new a.Zm("("),a.i6.join(t,new a.Zm(" and ")),new a.Zm(")")])}function or(...e){let t=e.filter(e=>void 0!==e);return 0===t.length?void 0:new a.$s(1===t.length?t:[new a.Zm("("),a.i6.join(t,new a.Zm(" or ")),new a.Zm(")")])}function not(e){return a.i6`not ${e}`}let gt=(e,t)=>a.i6`${e} > ${bindIfParam(t,e)}`,gte=(e,t)=>a.i6`${e} >= ${bindIfParam(t,e)}`,lt=(e,t)=>a.i6`${e} < ${bindIfParam(t,e)}`,lte=(e,t)=>a.i6`${e} <= ${bindIfParam(t,e)}`;function inArray(e,t){if(Array.isArray(t)){if(0===t.length)throw Error("inArray requires at least one value");return a.i6`${e} in ${t.map(t=>bindIfParam(t,e))}`}return a.i6`${e} in ${bindIfParam(t,e)}`}function notInArray(e,t){if(Array.isArray(t)){if(0===t.length)throw Error("notInArray requires at least one value");return a.i6`${e} not in ${t.map(t=>bindIfParam(t,e))}`}return a.i6`${e} not in ${bindIfParam(t,e)}`}function isNull(e){return a.i6`${e} is null`}function isNotNull(e){return a.i6`${e} is not null`}function exists(e){return a.i6`exists (${e})`}function notExists(e){return a.i6`not exists (${e})`}function between(e,t,i){return a.i6`${e} between ${bindIfParam(t,e)} and ${bindIfParam(i,e)}`}function notBetween(e,t,i){return a.i6`${e} not between ${bindIfParam(t,e)} and ${bindIfParam(i,e)}`}function like(e,t){return a.i6`${e} like ${t}`}function notLike(e,t){return a.i6`${e} not like ${t}`}function ilike(e,t){return a.i6`${e} ilike ${t}`}function notIlike(e,t){return a.i6`${e} not ilike ${t}`}},12212:(e,t,i)=>{let s,r;i.d(t,{dO:()=>Param,Vm:()=>Placeholder,$s:()=>SQL,Zm:()=>StringChunk,G7:()=>View,Pr:()=>fillPlaceholders,_B:()=>isDriverValueEncoder,zl:()=>isSQLWrapper,i6:()=>sql});var n=i(23638),a=i(90663),l=i(27252);let o={startActiveSpan:(e,t)=>s?(r||(r=s.trace.getTracer("drizzle-orm","0.29.1")),function(e,...t){return e(...t)}((i,s)=>s.startActiveSpan(e,e=>{try{return t(e)}catch(t){throw e.setStatus({code:i.SpanStatusCode.ERROR,message:t instanceof Error?t.message:"Unknown error"}),t}finally{e.end()}}),s,r)):t()};var u=i(99769),c=i(24121),h=i(87455);let FakePrimitiveParam=class FakePrimitiveParam{static{this[n.Q]="FakePrimitiveParam"}};function isSQLWrapper(e){return"object"==typeof e&&null!==e&&"getSQL"in e&&"function"==typeof e.getSQL}let StringChunk=class StringChunk{static{this[n.Q]="StringChunk"}constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new SQL([this])}};let SQL=class SQL{constructor(e){this.decoder=d,this.shouldInlineParams=!1,this.queryChunks=e}static{this[n.Q]="SQL"}append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return o.startActiveSpan("drizzle.buildSQL",t=>{let i=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":i.sql,"drizzle.query.params":JSON.stringify(i.params)}),i})}buildQueryFromSourceParams(e,t){let i=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{escapeName:s,escapeParam:r,prepareTyping:o,inlineParams:d,paramStartIndex:f}=i;return function(e){let t={sql:"",params:[]};for(let i of e)t.sql+=i.sql,t.params.push(...i.params),i.typings?.length&&(t.typings||(t.typings=[]),t.typings.push(...i.typings));return t}(e.map(e=>{if((0,n.is)(e,StringChunk))return{sql:e.value.join(""),params:[]};if((0,n.is)(e,Name))return{sql:s(e.value),params:[]};if(void 0===e)return{sql:"",params:[]};if(Array.isArray(e)){let t=[new StringChunk("(")];for(let[i,s]of e.entries())t.push(s),i<e.length-1&&t.push(new StringChunk(", "));return t.push(new StringChunk(")")),this.buildQueryFromSourceParams(t,i)}if((0,n.is)(e,SQL))return this.buildQueryFromSourceParams(e.queryChunks,{...i,inlineParams:d||e.shouldInlineParams});if((0,n.is)(e,h.iA)){let t=e[h.iA.Symbol.Schema],i=e[h.iA.Symbol.Name];return{sql:void 0===t?s(i):s(t)+"."+s(i),params:[]}}if((0,n.is)(e,c.s))return{sql:s(e.table[h.iA.Symbol.Name])+"."+s(e.name),params:[]};if((0,n.is)(e,View)){let t=e[u.d].schema,i=e[u.d].name;return{sql:void 0===t?s(i):s(t)+"."+s(i),params:[]}}if((0,n.is)(e,Param)){let t;let s=null===e.value?null:e.encoder.mapToDriverValue(e.value);return(0,n.is)(s,SQL)?this.buildQueryFromSourceParams([s],i):d?{sql:this.mapInlineParam(s,i),params:[]}:(void 0!==o&&(t=[o(e.encoder)]),{sql:r(f.value++,s),params:[s],typings:t})}return(0,n.is)(e,Placeholder)?{sql:r(f.value++,e),params:[e]}:(0,n.is)(e,SQL.Aliased)&&void 0!==e.fieldAlias?{sql:s(e.fieldAlias),params:[]}:(0,n.is)(e,l.k)?e[l.g1].isWith?{sql:s(e[l.g1].alias),params:[]}:this.buildQueryFromSourceParams([new StringChunk("("),e[l.g1].sql,new StringChunk(") "),new Name(e[l.g1].alias)],i):isSQLWrapper(e)?this.buildQueryFromSourceParams([new StringChunk("("),e.getSQL(),new StringChunk(")")],i):(0,n.is)(e,a.or)?this.buildQueryFromSourceParams([e.sourceTable,new StringChunk("."),sql.identifier(e.fieldName)],i):d?{sql:this.mapInlineParam(e,i),params:[]}:{sql:r(f.value++,e),params:[e]}}))}mapInlineParam(e,{escapeString:t}){if(null===e)return"null";if("number"==typeof e||"boolean"==typeof e)return e.toString();if("string"==typeof e)return t(e);if("object"==typeof e){let i=e.toString();return"[object Object]"===i?t(JSON.stringify(e)):t(i)}throw Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return void 0===e?this:new SQL.Aliased(this,e)}mapWith(e){return this.decoder="function"==typeof e?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}};let Name=class Name{constructor(e){this.value=e}static{this[n.Q]="Name"}getSQL(){return new SQL([this])}};function isDriverValueEncoder(e){return"object"==typeof e&&null!==e&&"mapToDriverValue"in e&&"function"==typeof e.mapToDriverValue}let d={mapFromDriverValue:e=>e},f={mapToDriverValue:e=>e};({...d,...f});let Param=class Param{constructor(e,t=f){this.value=e,this.encoder=t}static{this[n.Q]="Param"}getSQL(){return new SQL([this])}};function sql(e,...t){let i=[];for(let[s,r]of((t.length>0||e.length>0&&""!==e[0])&&i.push(new StringChunk(e[0])),t.entries()))i.push(r,new StringChunk(e[s+1]));return new SQL(i)}(e=>{e.empty=function(){return new SQL([])},e.fromList=function(e){return new SQL(e)},e.raw=function(e){return new SQL([new StringChunk(e)])},e.join=function(e,t){let i=[];for(let[s,r]of e.entries())s>0&&void 0!==t&&i.push(t),i.push(r);return new SQL(i)},e.identifier=function(e){return new Name(e)},e.placeholder=function(e){return new Placeholder(e)},e.param=function(e,t){return new Param(e,t)}})(sql||(sql={})),(e=>{let Aliased=class Aliased{constructor(e,t){this.isSelectionField=!1,this.sql=e,this.fieldAlias=t}static{this[n.Q]="SQL.Aliased"}getSQL(){return this.sql}clone(){return new Aliased(this.sql,this.fieldAlias)}};e.Aliased=Aliased})(SQL||(SQL={}));let Placeholder=class Placeholder{constructor(e){this.name=e}static{this[n.Q]="Placeholder"}getSQL(){return new SQL([this])}};function fillPlaceholders(e,t){return e.map(e=>{if((0,n.is)(e,Placeholder)){if(!(e.name in t))throw Error(`No value for placeholder "${e.name}" was provided`);return t[e.name]}return e})}let View=class View{static{this[n.Q]="View"}constructor({name:e,schema:t,selectedFields:i,query:s}){this[u.d]={name:e,originalName:e,schema:t,selectedFields:i,query:s,isExisting:!s,isAlias:!1}}getSQL(){return new SQL([this])}};c.s.prototype.getSQL=function(){return new SQL([this])},h.iA.prototype.getSQL=function(){return new SQL([this])},l.k.prototype.getSQL=function(){return new SQL([this])}},27252:(e,t,i)=>{i.d(t,{SC:()=>WithSubquery,g1:()=>r,k:()=>Subquery});var s=i(23638);let r=Symbol.for("drizzle:SubqueryConfig");let Subquery=class Subquery{static{this[s.Q]="Subquery"}constructor(e,t,i,s=!1){this[r]={sql:e,selection:t,alias:i,isWith:s}}};let WithSubquery=class WithSubquery extends Subquery{static{this[s.Q]="WithSubquery"}}},87455:(e,t,i)=>{i.d(t,{SP:()=>getTableName,iA:()=>Table,wb:()=>isTable});var s=i(23638);let r=Symbol.for("drizzle:Name"),n=Symbol.for("drizzle:Schema"),a=Symbol.for("drizzle:Columns"),l=Symbol.for("drizzle:OriginalName"),o=Symbol.for("drizzle:BaseName"),u=Symbol.for("drizzle:IsAlias"),c=Symbol.for("drizzle:ExtraConfigBuilder"),h=Symbol.for("drizzle:IsDrizzleTable");let Table=class Table{static{this[s.Q]="Table"}static{this.Symbol={Name:r,Schema:n,OriginalName:l,Columns:a,BaseName:o,IsAlias:u,ExtraConfigBuilder:c}}constructor(e,t,i){this[u]=!1,this[c]=void 0,this[h]=!0,this[r]=this[l]=e,this[n]=t,this[o]=i}};function isTable(e){return"object"==typeof e&&null!==e&&h in e}function getTableName(e){return e[r]}},99769:(e,t,i)=>{i.d(t,{d:()=>s});let s=Symbol.for("drizzle:ViewBaseConfig")}};