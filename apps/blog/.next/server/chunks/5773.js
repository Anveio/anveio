"use strict";exports.id=5773,exports.ids=[5773],exports.modules={65773:(e,s,r)=>{r.d(s,{hE:()=>createSessionForUser,tc:()=>getUserForSessionToken});var i=r(58842),t=r(64142),o=r(31349),n=r(66355),a=r(66412),d=r(42078);let getUserForSessionToken=async e=>n.db.transaction(async s=>{let r=await s.select({userId:a.iG.userId,sessionToken:a.iG.sessionToken,expiresAt:a.iG.expiresAt}).from(a.iG).where((0,o.eq)(a.iG.sessionToken,e)).limit(1).execute(),i=r[0];if(void 0==i){console.log("Invalid session token used to attempt to authenticate.");return}if((0,t.Z)(i.expiresAt)){console.log(`Expired session token starting with ${e.slice(0,5)} used for login`);return}let n=await s.select({id:a.rC.publicId,email:a.rC.email}).from(a.rC).where((0,o.eq)(a.rC.id,i.userId)).limit(1).execute(),d=n[0];return void 0==d&&console.error(`User not found for session token ${e} when querying for id: ${i.userId}`),d}),createSessionForUser=async(e,s)=>{let r=await (0,d.k)();return n.db.transaction(async s=>{let t=new Date,n=await s.select({id:a.rC.id}).from(a.rC).where((0,o.eq)(a.rC.email,e)).limit(1).execute(),d=n[0]?.id;if(!d)throw Error(`Failed to find user while verifying email: ${e}. This should never happen.`);let l=(0,i.Z)(t,{days:365});return await s.insert(a.iG).values({expiresAt:l,sessionToken:r,userId:Number(d),createdAt:new Date}).execute(),{token:r,expirationDate:l}})}}};