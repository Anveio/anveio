exports.id=1031,exports.ids=[1031],exports.modules={21197:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(42056);let i=(0,r.Z)("Bird",[["path",{d:"M16 7h.01",key:"1kdx03"}],["path",{d:"M3.4 18H12a8 8 0 0 0 8-8V7a4 4 0 0 0-7.28-2.3L2 20",key:"oj1oa8"}],["path",{d:"m20 7 2 .5-2 .5",key:"12nv4d"}],["path",{d:"M10 18v3",key:"1yea0a"}],["path",{d:"M14 17.75V21",key:"1pymcb"}],["path",{d:"M7 18a6 6 0 0 0 3.84-10.61",key:"1npnn0"}]])},65517:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(42056);let i=(0,r.Z)("Bone",[["path",{d:"M17 10c.7-.7 1.69 0 2.5 0a2.5 2.5 0 1 0 0-5 .5.5 0 0 1-.5-.5 2.5 2.5 0 1 0-5 0c0 .81.7 1.8 0 2.5l-7 7c-.7.7-1.69 0-2.5 0a2.5 2.5 0 0 0 0 5c.28 0 .5.22.5.5a2.5 2.5 0 1 0 5 0c0-.81-.7-1.8 0-2.5Z",key:"w610uw"}]])},58041:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(42056);let i=(0,r.Z)("Cat",[["path",{d:"M12 5c.67 0 1.35.09 2 .26 1.78-2 5.03-2.84 6.42-2.26 1.4.58-.42 7-.42 7 .57 1.07 1 2.24 1 3.44C21 17.9 16.97 21 12 21s-9-3-9-7.56c0-1.25.5-2.4 1-3.44 0 0-1.89-6.42-.5-7 1.39-.58 4.72.23 6.5 2.23A9.04 9.04 0 0 1 12 5Z",key:"x6xyqk"}],["path",{d:"M8 14v.5",key:"1nzgdb"}],["path",{d:"M16 14v.5",key:"1lajdz"}],["path",{d:"M11.25 16.25h1.5L12 17l-.75-.75Z",key:"12kq1m"}]])},64768:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(42056);let i=(0,r.Z)("Dog",[["path",{d:"M10 5.172C10 3.782 8.423 2.679 6.5 3c-2.823.47-4.113 6.006-4 7 .08.703 1.725 1.722 3.656 1 1.261-.472 1.96-1.45 2.344-2.5",key:"19br0u"}],["path",{d:"M14.267 5.172c0-1.39 1.577-2.493 3.5-2.172 2.823.47 4.113 6.006 4 7-.08.703-1.725 1.722-3.656 1-1.261-.472-1.855-1.45-2.239-2.5",key:"11n1an"}],["path",{d:"M8 14v.5",key:"1nzgdb"}],["path",{d:"M16 14v.5",key:"1lajdz"}],["path",{d:"M11.25 16.25h1.5L12 17l-.75-.75Z",key:"12kq1m"}],["path",{d:"M4.42 11.247A13.152 13.152 0 0 0 4 14.556C4 18.728 7.582 21 12 21s8-2.272 8-6.444c0-1.061-.162-2.2-.493-3.309m-9.243-6.082A8.801 8.801 0 0 1 12 5c.78 0 1.5.108 2.161.306",key:"wsu29d"}]])},27456:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(42056);let i=(0,r.Z)("Fish",[["path",{d:"M6.5 12c.94-3.46 4.94-6 8.5-6 3.56 0 6.06 2.54 7 6-.94 3.47-3.44 6-7 6s-7.56-2.53-8.5-6Z",key:"15baut"}],["path",{d:"M18 12v.5",key:"18hhni"}],["path",{d:"M16 17.93a9.77 9.77 0 0 1 0-11.86",key:"16dt7o"}],["path",{d:"M7 10.67C7 8 5.58 5.97 2.73 5.5c-1 1.5-1 5 .23 6.5-1.24 1.5-1.24 5-.23 6.5C5.58 18.03 7 16 7 13.33",key:"l9di03"}],["path",{d:"M10.46 7.26C10.2 5.88 9.17 4.24 8 3h5.8a2 2 0 0 1 1.98 1.67l.23 1.4",key:"1kjonw"}],["path",{d:"m16.01 17.93-.23 1.4A2 2 0 0 1 13.8 21H9.5a5.96 5.96 0 0 0 1.49-3.98",key:"1zlm23"}]])},16811:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(42056);let i=(0,r.Z)("MousePointer2",[["path",{d:"m4 4 7.07 17 2.51-7.39L21 11.07z",key:"1vqm48"}]])},34126:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(42056);let i=(0,r.Z)("Rabbit",[["path",{d:"M20 8.54V4a2 2 0 1 0-4 0v3",key:"49iql8"}],["path",{d:"M18 21h-8a4 4 0 0 1-4-4 7 7 0 0 1 7-7h.2L9.6 6.4a1.93 1.93 0 1 1 2.8-2.8L15.8 7h.2c3.3 0 6 2.7 6 6v1a2 2 0 0 1-2 2h-1c-1.7 0-3 1.3-3 3",key:"1i2yr3"}],["path",{d:"M7.61 12.53a3 3 0 1 0-1.6 4.3",key:"9ygxkv"}],["path",{d:"M13 16a3 3 0 0 1 2.24 5",key:"1epib5"}],["path",{d:"M18 12h.01",key:"yjnet6"}]])},18666:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(42056);let i=(0,r.Z)("Snail",[["path",{d:"M2 13a6 6 0 1 0 12 0 4 4 0 1 0-8 0 2 2 0 0 0 4 0",key:"hneq2s"}],["circle",{cx:"10",cy:"13",r:"8",key:"194lz3"}],["path",{d:"M2 21h12c4.4 0 8-3.6 8-8V7a2 2 0 1 0-4 0v6",key:"ixqyt7"}],["path",{d:"M18 3 19.1 5.2",key:"9tjm43"}],["path",{d:"M22 3 20.9 5.2",key:"j3odrs"}]])},90605:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(42056);let i=(0,r.Z)("Turtle",[["path",{d:"m12 10 2 4v3a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-3a8 8 0 1 0-16 0v3a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-3l2-4h4Z",key:"1lbbv7"}],["path",{d:"M4.82 7.9 8 10",key:"m9wose"}],["path",{d:"M15.18 7.9 12 10",key:"p8dp2u"}],["path",{d:"M16.93 10H20a2 2 0 0 1 0 4H2",key:"12nsm7"}]])},6809:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{unstable_getImgProps:function(){return unstable_getImgProps},default:function(){return d}});let r=n(78446),i=n(15218),o=n(57626),s=n(49949),a=r._(n(5640)),unstable_getImgProps=e=>{(0,o.warnOnce)("Warning: unstable_getImgProps() is experimental and may change or be removed at any time. Use at your own risk.");let{props:t}=(0,i.getImgProps)(e,{defaultLoader:a.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,n]of Object.entries(t))void 0===n&&delete t[e];return{props:t}},d=s.Image},19328:(e,t,n)=>{e.exports=n(6809)},24288:(e,t,n)=>{e.exports=n(97745)},34705:(e,t,n)=>{"use strict";n.d(t,{$s:()=>createAsyncCache,I6:()=>isLiveNode,Pz:()=>stringify,Xd:()=>shallow,Zb:()=>makeEventSource,eI:()=>createClient,iV:()=>h,iz:()=>L,l8:()=>detectDupes});var r,i,o,s,a,d=Object.defineProperty,l="@liveblocks/core",u="1.8.2",c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function error(e){console.error(e)}function detectDupes(e,t,n){let r=Symbol.for(e),i=n?`${t||"dev"} (${n})`:t||"dev";if(c[r]){if(c[r]===i);else{let t=`Multiple copies of Liveblocks are being loaded in your project. This will cause issues! See https://liveblocks.io/docs/errors/dupes 

Conflicts:
- ${e} ${c[r]} (already loaded)
- ${e} ${i} (trying to load this now)`;error(t)}}else c[r]=i;t&&u&&t!==u&&error(`Cross-linked versions of Liveblocks found, which will cause issues! See https://liveblocks.io/docs/errors/cross-linked 

Conflicts:
- ${l} is at ${u}
- ${e} is at ${t}

Always upgrade all Liveblocks packages to the same version number.`)}function assertNever(e,t){throw Error(t)}function nn(e,t="Expected value to be non-nullable"){return e}function makeEventSource(){let e=new Set,t=new Set,n=null;function subscribe(e){return t.add(e),()=>t.delete(e)}function subscribeOnce(t){return e.add(t),()=>e.delete(t)}async function waitUntil(e){let t;return new Promise(n=>{t=subscribe(t=>{(void 0===e||e(t))&&n(t)})}).finally(()=>t?.())}function notify(n){e.forEach(e=>e(n)),e.clear(),t.forEach(e=>e(n))}return{notify:function(e){null!==n?n.push(e):notify(e)},subscribe,subscribeOnce,clear:function(){e.clear(),t.clear()},count:function(){return e.size+t.size},waitUntil,pause:function(){n=[]},unpause:function(){if(null!==n){for(let e of n)notify(e);n=null}},observable:{subscribe,subscribeOnce,waitUntil}}}var h={};((e,t)=>{for(var n in t)d(e,n,{get:t[n],enumerable:!0})})(h,{error:()=>m,errorWithTitle:()=>_,warn:()=>f,warnWithTitle:()=>y});var p="background:#0e0d12;border-radius:9999px;color:#fff;padding:3px 7px;font-family:sans-serif;font-weight:600;";function wrap(e){return"undefined"==typeof window?console[e]:(t,...n)=>console[e]("%cLiveblocks",p,t,...n)}var f=wrap("warn"),m=wrap("error");function wrapWithTitle(e){return"undefined"==typeof window?console[e]:(t,n,...r)=>console[e](`%cLiveblocks%c ${t}`,p,"font-weight:600",n,...r)}var y=wrapWithTitle("warn"),_=wrapWithTitle("error"),g=class{constructor(e){this.curr=e}get current(){return this.curr}allowPatching(e){let t=this,n=!0,r={...this.curr,patch(e){if(n)for(let n of(t.curr=Object.assign({},t.curr,e),Object.entries(e))){let[e,t]=n;"patch"!==e&&(this[e]=t)}else throw Error("Can no longer patch stale context")}};e(r),n=!1}},v=1,b=class{get initialState(){let e=this.states.values()[Symbol.iterator]().next();if(!e.done)return e.value;throw Error("No states defined yet")}get currentState(){if(null===this.currentStateOrNull){if(0===this.runningState)throw Error("Not started yet");throw Error("Already stopped")}return this.currentStateOrNull}start(){if(0!==this.runningState)throw Error("State machine has already started");return this.runningState=1,this.currentStateOrNull=this.initialState,this.enter(null),this}stop(){if(1!==this.runningState)throw Error("Cannot stop a state machine that hasn't started yet");this.exit(null),this.runningState=2,this.currentStateOrNull=null}constructor(e){this.id=v++,this.runningState=0,this.currentStateOrNull=null,this.states=new Set,this.enterFns=new Map,this.cleanupStack=[],this.knownEventTypes=new Set,this.allowedTransitions=new Map,this.currentContext=new g(e),this.eventHub={didReceiveEvent:makeEventSource(),willTransition:makeEventSource(),didIgnoreEvent:makeEventSource(),willExitState:makeEventSource(),didEnterState:makeEventSource()},this.events={didReceiveEvent:this.eventHub.didReceiveEvent.observable,willTransition:this.eventHub.willTransition.observable,didIgnoreEvent:this.eventHub.didIgnoreEvent.observable,willExitState:this.eventHub.willExitState.observable,didEnterState:this.eventHub.didEnterState.observable}}get context(){return this.currentContext.current}addState(e){if(0!==this.runningState)throw Error("Already started");return this.states.add(e),this}onEnter(e,t){if(0!==this.runningState)throw Error("Already started");if(this.enterFns.has(e))throw Error(`enter/exit function for ${e} already exists`);return this.enterFns.set(e,t),this}onEnterAsync(e,t,n,r){return this.onEnter(e,()=>{let e=!1;return t(this.currentContext.current).then(t=>{e||this.transition({type:"ASYNC_OK",data:t},n)},t=>{e||this.transition({type:"ASYNC_ERROR",reason:t},r)}),()=>{e=!0}})}getStatesMatching(e){let t=[];if("*"===e)for(let e of this.states)t.push(e);else if(e.endsWith(".*")){let n=e.slice(0,-1);for(let e of this.states)e.startsWith(n)&&t.push(e)}else this.states.has(e)&&t.push(e);if(0===t.length)throw Error(`No states match ${JSON.stringify(e)}`);return t}addTransitions(e,t){if(0!==this.runningState)throw Error("Already started");for(let n of this.getStatesMatching(e)){let r=this.allowedTransitions.get(n);for(let[i,o]of(void 0===r&&(r=new Map,this.allowedTransitions.set(n,r)),Object.entries(t))){if(r.has(i))throw Error(`Trying to set transition "${i}" on "${n}" (via "${e}"), but a transition already exists there.`);let t=o;if(this.knownEventTypes.add(i),void 0!==t){let e="function"==typeof t?t:()=>t;r.set(i,e)}}}return this}addTimedTransition(e,t,n){return this.onEnter(e,()=>{let e="function"==typeof t?t(this.currentContext.current):t,r=setTimeout(()=>{this.transition({type:"TIMER"},n)},e);return()=>{clearTimeout(r)}})}getTargetFn(e){return this.allowedTransitions.get(this.currentState)?.get(e)}exit(e){this.eventHub.willExitState.notify(this.currentState),this.currentContext.allowPatching(t=>{e=e??this.cleanupStack.length;for(let n=0;n<e;n++)this.cleanupStack.pop()?.(t)})}enter(e){let t=function(e,t){let n=e.split(".");if(t<1||t>n.length+1)throw Error("Invalid number of levels");let r=[];t>n.length&&r.push("*");for(let e=n.length-t+1;e<n.length;e++){let t=n.slice(0,e);t.length>0&&r.push(t.join(".")+".*")}return r.push(e),r}(this.currentState,e??this.currentState.split(".").length+1);this.currentContext.allowPatching(e=>{for(let n of t){let t=this.enterFns.get(n),r=t?.(e);"function"==typeof r?this.cleanupStack.push(r):this.cleanupStack.push(null)}}),this.eventHub.didEnterState.notify(this.currentState)}send(e){if(!this.knownEventTypes.has(e.type))throw Error(`Invalid event ${JSON.stringify(e.type)}`);if(2===this.runningState)return;let t=this.getTargetFn(e.type);if(void 0!==t)return this.transition(e,t);this.eventHub.didIgnoreEvent.notify(e)}transition(e,t){let n,r;this.eventHub.didReceiveEvent.notify(e);let i=this.currentState,o=("function"==typeof t?t:()=>t)(e,this.currentContext.current);if(null===o){this.eventHub.didIgnoreEvent.notify(e);return}if("string"==typeof o?n=o:(n=o.target,r=Array.isArray(o.effect)?o.effect:[o.effect]),!this.states.has(n))throw Error(`Invalid next state name: ${JSON.stringify(n)}`);this.eventHub.willTransition.notify({from:i,to:n});let[s,a]=function(e,t){if(e===t)return[0,0];let n=e.split("."),r=t.split("."),i=Math.min(n.length,r.length),o=0;for(;o<i&&n[o]===r[o];o++);let s=n.length-o,a=r.length-o;return[s,a]}(this.currentState,n);if(s>0&&this.exit(s),this.currentStateOrNull=n,void 0!==r){let t=r;this.currentContext.allowPatching(n=>{for(let r of t)"function"==typeof r?r(n,e):n.patch(r)})}a>0&&this.enter(a)}};function isPlainObject(e){return null!==e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)}function entries(e){return Object.entries(e)}function tryParseJson(e){try{return JSON.parse(e)}catch(e){return}}function deepClone(e){return JSON.parse(JSON.stringify(e))}function compact(e){return e.filter(e=>null!=e)}function compactObject(e){let t={...e};return Object.keys(e).forEach(e=>{void 0===t[e]&&delete t[e]}),t}async function withTimeout(e,t,n){let r;let i=new Promise((e,i)=>{r=setTimeout(()=>{i(Error(n))},t)});return Promise.race([e,i]).finally(()=>clearTimeout(r))}var E=((r=E||{})[r.UPDATE_PRESENCE=100]="UPDATE_PRESENCE",r[r.USER_JOINED=101]="USER_JOINED",r[r.USER_LEFT=102]="USER_LEFT",r[r.BROADCASTED_EVENT=103]="BROADCASTED_EVENT",r[r.ROOM_STATE=104]="ROOM_STATE",r[r.INITIAL_STORAGE_STATE=200]="INITIAL_STORAGE_STATE",r[r.UPDATE_STORAGE=201]="UPDATE_STORAGE",r[r.REJECT_STORAGE_OP=299]="REJECT_STORAGE_OP",r[r.UPDATE_YDOC=300]="UPDATE_YDOC",r[r.THREAD_CREATED=400]="THREAD_CREATED",r[r.THREAD_METADATA_UPDATED=401]="THREAD_METADATA_UPDATED",r[r.COMMENT_CREATED=402]="COMMENT_CREATED",r[r.COMMENT_EDITED=403]="COMMENT_EDITED",r[r.COMMENT_DELETED=404]="COMMENT_DELETED",r[r.COMMENT_REACTION_ADDED=405]="COMMENT_REACTION_ADDED",r[r.COMMENT_REACTION_REMOVED=406]="COMMENT_REACTION_REMOVED",r),S=((i=S||{})[i.CLOSE_ABNORMAL=1006]="CLOSE_ABNORMAL",i[i.UNEXPECTED_CONDITION=1011]="UNEXPECTED_CONDITION",i[i.TRY_AGAIN_LATER=1013]="TRY_AGAIN_LATER",i[i.INVALID_MESSAGE_FORMAT=4e3]="INVALID_MESSAGE_FORMAT",i[i.NOT_ALLOWED=4001]="NOT_ALLOWED",i[i.MAX_NUMBER_OF_MESSAGES_PER_SECONDS=4002]="MAX_NUMBER_OF_MESSAGES_PER_SECONDS",i[i.MAX_NUMBER_OF_CONCURRENT_CONNECTIONS=4003]="MAX_NUMBER_OF_CONCURRENT_CONNECTIONS",i[i.MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP=4004]="MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP",i[i.MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM=4005]="MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM",i[i.TOKEN_EXPIRED=4109]="TOKEN_EXPIRED",i[i.CLOSE_WITHOUT_RETRY=4999]="CLOSE_WITHOUT_RETRY",i);function shouldDisconnect(e){return 4999===e||e>=4e3&&e<4100}function shouldRetryWithoutReauth(e){return 1013===e||e>=4200&&e<4300}function newToLegacyStatus(e){switch(e){case"connecting":return"connecting";case"connected":return"open";case"reconnecting":return"unavailable";case"disconnected":return"failed";default:return"closed"}}function toNewConnectionStatus(e){let t=e.currentState;switch(t){case"@ok.connected":case"@ok.awaiting-pong":return"connected";case"@idle.initial":return"initial";case"@auth.busy":case"@auth.backoff":case"@connecting.busy":case"@connecting.backoff":case"@idle.zombie":return e.context.successCount>0?"reconnecting":"connecting";case"@idle.failed":return"disconnected";default:return assertNever(t,"Unknown state")}}var k=[250,500,1e3,2e3,4e3,8e3,1e4],w=[2e3,3e4,6e4,3e5],O=class extends Error{constructor(e){super(e)}},C=class extends Error{constructor(e,t){super(e),this.code=t}};function nextBackoffDelay(e,t=k){return t.find(t=>t>e)??t[t.length-1]}function increaseBackoffDelay(e){e.patch({backoffDelay:nextBackoffDelay(e.backoffDelay)})}function increaseBackoffDelayAggressively(e){e.patch({backoffDelay:nextBackoffDelay(e.backoffDelay,w)})}function resetSuccessCount(e){e.patch({successCount:0})}function log(e,t){let n=2===e?m:1===e?f:()=>{};return()=>{n(t)}}function logPrematureErrorOrCloseEvent(e){let t="Connection to Liveblocks websocket server";return n=>{e instanceof Error?f(`${t} could not be established. ${String(e)}`):f(isCloseEvent(e)?`${t} closed prematurely (code: ${e.code}). Retrying in ${n.backoffDelay}ms.`:`${t} could not be established.`)}}function logCloseEvent(e){return t=>{f(`Connection to Liveblocks websocket server closed (code: ${e.code}). Retrying in ${t.backoffDelay}ms.`)}}var T=log(1,"Connection to WebSocket closed permanently. Won't retry.");function isCloseEvent(e){return!(e instanceof Error)&&"close"===e.type}var assign=e=>t=>t.patch(e),I=class{constructor(e,t=!1,n=!0){let{machine:r,events:i,cleanups:o}=function(e,t){let n=makeEventSource();n.pause();let r=makeEventSource();function fireErrorEvent(e,t){return()=>{let n=new C(e,t);r.notify(n)}}let i=new b({successCount:0,authValue:null,socket:null,backoffDelay:249}).addState("@idle.initial").addState("@idle.failed").addState("@idle.zombie").addState("@auth.busy").addState("@auth.backoff").addState("@connecting.busy").addState("@connecting.backoff").addState("@ok.connected").addState("@ok.awaiting-pong");i.addTransitions("*",{RECONNECT:{target:"@auth.backoff",effect:[increaseBackoffDelay,resetSuccessCount]},DISCONNECT:"@idle.initial"}),i.onEnter("@idle.*",resetSuccessCount).addTransitions("@idle.*",{CONNECT:(e,t)=>null!==t.authValue?"@connecting.busy":"@auth.busy"}),i.addTransitions("@auth.backoff",{NAVIGATOR_ONLINE:{target:"@auth.busy",effect:assign({backoffDelay:249})}}).addTimedTransition("@auth.backoff",e=>e.backoffDelay,"@auth.busy").onEnterAsync("@auth.busy",()=>withTimeout(e.authenticate(),1e4,"Timed out during auth"),e=>({target:"@connecting.busy",effect:assign({authValue:e.data,backoffDelay:249})}),e=>e.reason instanceof O?{target:"@idle.failed",effect:[log(2,e.reason.message),fireErrorEvent(e.reason.message,-1)]}:{target:"@auth.backoff",effect:[increaseBackoffDelay,log(2,`Authentication failed: ${e.reason instanceof Error?e.reason.message:String(e.reason)}`)]});let onSocketError=e=>i.send({type:"EXPLICIT_SOCKET_ERROR",event:e}),onSocketClose=e=>i.send({type:"EXPLICIT_SOCKET_CLOSE",event:e}),onSocketMessage=e=>"pong"===e.data?i.send({type:"PONG"}):n.notify(e);function teardownSocket(e){e&&(e.removeEventListener("error",onSocketError),e.removeEventListener("close",onSocketClose),e.removeEventListener("message",onSocketMessage),e.close())}i.addTransitions("@connecting.backoff",{NAVIGATOR_ONLINE:{target:"@connecting.busy",effect:assign({backoffDelay:249})}}).addTimedTransition("@connecting.backoff",e=>e.backoffDelay,"@connecting.busy").onEnterAsync("@connecting.busy",async n=>{let r=null,i=new Promise((i,o)=>{if(null===n.authValue)throw Error("No auth authValue");let s=e.createSocket(n.authValue);function reject(e){r=e,s.removeEventListener("message",onSocketMessage),o(e)}let[a,d]=function(){let e;let t=new Promise(t=>{e=t});if(!e)throw Error("Should never happen");return[t,e]}();function waitForActorId(e){let t=tryParseJson(e.data);t?.type===104&&d()}t.waitForActorId||d(),s.addEventListener("message",onSocketMessage),t.waitForActorId&&s.addEventListener("message",waitForActorId),s.addEventListener("error",reject),s.addEventListener("close",reject),s.addEventListener("open",()=>{s.addEventListener("error",onSocketError),s.addEventListener("close",onSocketClose);let unsub=()=>{s.removeEventListener("error",reject),s.removeEventListener("close",reject),s.removeEventListener("message",waitForActorId)};a.then(()=>{i([s,unsub])})})});return withTimeout(i,1e4,"Timed out during websocket connection").then(([e,t])=>{if(t(),r)throw r;return e})},e=>({target:"@ok.connected",effect:assign({socket:e.data,backoffDelay:249})}),e=>{let t=e.reason;if(t instanceof O)return{target:"@idle.failed",effect:[log(2,t.message),fireErrorEvent(t.message,-1)]};if(isCloseEvent(t)){if(4109===t.code)return"@auth.busy";if(shouldRetryWithoutReauth(t.code))return{target:"@connecting.backoff",effect:[increaseBackoffDelayAggressively,logPrematureErrorOrCloseEvent(t)]};if(shouldDisconnect(t.code))return{target:"@idle.failed",effect:[log(2,t.reason),fireErrorEvent(t.reason,t.code)]}}return{target:"@auth.backoff",effect:[increaseBackoffDelay,logPrematureErrorOrCloseEvent(t)]}});let o={target:"@ok.awaiting-pong",effect:e=>{e.socket?.send("ping")}},maybeHeartbeat=()=>{let t="undefined"!=typeof document?document:void 0,n=t?.visibilityState==="hidden"&&e.canZombie();return n?"@idle.zombie":o};if(i.addTimedTransition("@ok.connected",3e4,maybeHeartbeat).addTransitions("@ok.connected",{NAVIGATOR_OFFLINE:maybeHeartbeat,WINDOW_GOT_FOCUS:o}),i.addTransitions("@idle.zombie",{WINDOW_GOT_FOCUS:"@connecting.backoff"}),i.onEnter("@ok.*",e=>{e.patch({successCount:e.successCount+1});let t=setTimeout(n.unpause,0);return e=>{teardownSocket(e.socket),e.patch({socket:null}),clearTimeout(t),n.pause()}}).addTransitions("@ok.awaiting-pong",{PONG:"@ok.connected"}).addTimedTransition("@ok.awaiting-pong",2e3,{target:"@connecting.busy",effect:log(1,"Received no pong from server, assume implicit connection loss.")}).addTransitions("@ok.*",{EXPLICIT_SOCKET_ERROR:(e,t)=>t.socket?.readyState===1?null:{target:"@connecting.backoff",effect:increaseBackoffDelay},EXPLICIT_SOCKET_CLOSE:e=>{var t;return shouldDisconnect(e.event.code)?{target:"@idle.failed",effect:[T,fireErrorEvent(e.event.reason,e.event.code)]}:(t=e.event.code)>=4100&&t<4200?4109===e.event.code?"@auth.busy":{target:"@auth.backoff",effect:[increaseBackoffDelay,logCloseEvent(e.event)]}:shouldRetryWithoutReauth(e.event.code)?{target:"@connecting.backoff",effect:[increaseBackoffDelayAggressively,logCloseEvent(e.event)]}:{target:"@connecting.backoff",effect:[increaseBackoffDelay,logCloseEvent(e.event)]}}}),"undefined"!=typeof document){let e="undefined"!=typeof document?document:void 0,t="undefined"!=typeof window?window:void 0,n=t??e;i.onEnter("*",r=>{function onNetworkOffline(){i.send({type:"NAVIGATOR_OFFLINE"})}function onNetworkBackOnline(){i.send({type:"NAVIGATOR_ONLINE"})}function onVisibilityChange(){e?.visibilityState==="visible"&&i.send({type:"WINDOW_GOT_FOCUS"})}return t?.addEventListener("online",onNetworkBackOnline),t?.addEventListener("offline",onNetworkOffline),n?.addEventListener("visibilitychange",onVisibilityChange),()=>{n?.removeEventListener("visibilitychange",onVisibilityChange),t?.removeEventListener("online",onNetworkBackOnline),t?.removeEventListener("offline",onNetworkOffline),teardownSocket(r.socket)}})}let s=[],{statusDidChange:a,didConnect:d,didDisconnect:l,unsubscribe:u}=function(e){let t=makeEventSource(),n=makeEventSource(),r=makeEventSource(),i=null,o=e.events.didEnterState.subscribe(()=>{let o=toNewConnectionStatus(e);o!==i&&t.notify(o),"connected"===i&&"connected"!==o?r.notify():"connected"!==i&&"connected"===o&&n.notify(),i=o});return{statusDidChange:t.observable,didConnect:n.observable,didDisconnect:r.observable,unsubscribe:o}}(i);return s.push(u),t.enableDebugLogging&&s.push(function(e){let t=new Date().getTime();function log2(...n){f(`${((new Date().getTime()-t)/1e3).toFixed(2)} [FSM #${e.id}]`,...n)}let n=[e.events.didReceiveEvent.subscribe(e=>log2(`Event ${e.type}`)),e.events.willTransition.subscribe(({from:e,to:t})=>log2("Transitioning",e,"â†’",t)),e.events.didIgnoreEvent.subscribe(e=>log2("Ignored event",e.type,e,"(current state won't handle it)"))];return()=>{for(let e of n)e()}}(i)),i.start(),{machine:i,cleanups:s,events:{statusDidChange:a,didConnect:d,didDisconnect:l,onMessage:n.observable,onLiveblocksError:r.observable}}}(e,{waitForActorId:n,enableDebugLogging:t});this.machine=r,this.events=i,this.cleanups=o}getLegacyStatus(){return newToLegacyStatus(this.getStatus())}getStatus(){try{return toNewConnectionStatus(this.machine)}catch{return"initial"}}get authValue(){return this.machine.context.authValue}connect(){this.machine.send({type:"CONNECT"})}reconnect(){this.machine.send({type:"RECONNECT"})}disconnect(){this.machine.send({type:"DISCONNECT"})}destroy(){let e;for(this.machine.stop();e=this.cleanups.pop();)e()}send(e){let t=this.machine.context?.socket;null===t?f("Cannot send: not connected yet",e):1!==t.readyState?f("Cannot send: WebSocket no longer open",e):t.send(e)}_privateSendMachineEvent(e){this.machine.send(e)}};function canWriteStorage(e){return e.includes("room:write")}function canComment(e){return e.includes("comments:write")||e.includes("room:write")}function parseAuthToken(e){var t;let n=e.split(".");if(3!==n.length)throw Error("Authentication error: invalid JWT token");let r=tryParseJson(function(e){try{let t=e.replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return n}catch(t){return atob(e)}}(n[1]));if(!(r&&isPlainObject(t=r)&&("acc"===t.k||"id"===t.k||"sec-legacy"===t.k)))throw Error("Authentication error: expected a valid token but did not get one. Hint: if you are using a callback, ensure the room is passed when creating the token. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientCallback");return{raw:e,parsed:r}}async function fetchAuthEndpoint(e,t,n){let r;let i=await e(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok){let e=`${(await i.text()).trim()||"reason not provided in auth response"} (${i.status} returned by POST ${t})`;if(401===i.status||403===i.status)throw new O(`Unauthorized: ${e}`);throw Error(`Failed to authenticate: ${e}`)}try{r=await i.json()}catch(e){throw Error(`Expected a JSON response when doing a POST request on "${t}". ${String(e)}`)}if(!isPlainObject(r)||"string"!=typeof r.token)throw Error(`Expected a JSON response of the form \`{ token: "..." }\` when doing a POST request on "${t}", but got ${JSON.stringify(r)}`);let{token:o}=r;return{token:o}}makeEventSource().observable,Date.now();var L=class extends Error{constructor(e,t,n){super(e),this.message=e,this.status=t,this.details=n}},R=nthDigit(0),P=nthDigit(1),A=R+nthDigit(-1);function nthDigit(e){let t=32+(e<0?95+e:e);if(t<32||t>126)throw Error(`Invalid n value: ${e}`);return String.fromCharCode(t)}function makePosition(e,t){return void 0!==e&&void 0!==t?function(e,t){if(e<t)return _between(e,t);if(e>t)return _between(t,e);throw Error("Cannot compute value between two equal positions")}(e,t):void 0!==e?function(e){for(let t=0;t<=e.length-1;t++){let n=e.charCodeAt(t);if(!(n>=126))return e.substring(0,t)+String.fromCharCode(n+1)}return e+P}(e):void 0!==t?function(e){let t=e.length-1;for(let n=0;n<=t;n++){let r=e.charCodeAt(n);if(!(r<=32)){if(n!==t)return e.substring(0,n+1);if(33===r)return e.substring(0,n)+A;return e.substring(0,n)+String.fromCharCode(r-1)}}return P}(t):P}function _between(e,t){let n=0,r=e.length,i=t.length;for(;;){let s=n<r?e.charCodeAt(n):32,a=n<i?t.charCodeAt(n):126;if(s===a){n++;continue}if(a-s!=1){var o;return((o=n)<e.length?e.substring(0,o):e+R.repeat(o-e.length))+String.fromCharCode(a+s>>1)}{let t=n+1,r=e.substring(0,t);r.length<t&&(r+=R.repeat(t-r.length));let i=e.substring(t);return r+_between(i,"")}}}function asPos(e){return!function(e){if(""===e)return!1;let t=e.length-1,n=e.charCodeAt(t);if(n<33||n>126)return!1;for(let n=0;n<t;n++){let t=e.charCodeAt(n);if(t<32||t>126)return!1}return!0}(e)?function(e){let t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);t.push(r<32?32:r>126?126:r)}for(;t.length>0&&32===t[t.length-1];)t.length--;return t.length>0?String.fromCharCode(...t):P}(e):e}var N=((o=N||{})[o.INIT=0]="INIT",o[o.SET_PARENT_KEY=1]="SET_PARENT_KEY",o[o.CREATE_LIST=2]="CREATE_LIST",o[o.UPDATE_OBJECT=3]="UPDATE_OBJECT",o[o.CREATE_OBJECT=4]="CREATE_OBJECT",o[o.DELETE_CRDT=5]="DELETE_CRDT",o[o.DELETE_OBJECT_KEY=6]="DELETE_OBJECT_KEY",o[o.CREATE_MAP=7]="CREATE_MAP",o[o.CREATE_REGISTER=8]="CREATE_REGISTER",o);function HasParent(e,t,n=asPos(t)){return Object.freeze({type:"HasParent",node:e,key:t,pos:n})}var U=Object.freeze({type:"NoParent"}),D=class{constructor(){this._parent=U}_getParentKeyOrThrow(){switch(this.parent.type){case"HasParent":return this.parent.key;case"NoParent":throw Error("Parent key is missing");case"Orphaned":return this.parent.oldKey;default:return assertNever(this.parent,"Unknown state")}}get _parentPos(){switch(this.parent.type){case"HasParent":return this.parent.pos;case"NoParent":throw Error("Parent key is missing");case"Orphaned":return this.parent.oldPos;default:return assertNever(this.parent,"Unknown state")}}get _pool(){return this.__pool}get roomId(){return this.__pool?this.__pool.roomId:null}get _id(){return this.__id}get parent(){return this._parent}get _parentKey(){switch(this.parent.type){case"HasParent":return this.parent.key;case"NoParent":return null;case"Orphaned":return this.parent.oldKey;default:return assertNever(this.parent,"Unknown state")}}_apply(e,t){return 5===e.type&&"HasParent"===this.parent.type?this.parent.node._detachChild(this):{modified:!1}}_setParentLink(e,t){switch(this.parent.type){case"HasParent":if(this.parent.node!==e)throw Error("Cannot set parent: node already has a parent");this._parent=HasParent(e,t);return;case"Orphaned":case"NoParent":this._parent=HasParent(e,t);return;default:return assertNever(this.parent,"Unknown state")}}_attach(e,t){if(this.__id||this.__pool)throw Error("Cannot attach node: already attached");t.addNode(e,this),this.__id=e,this.__pool=t}_detach(){switch(this.__pool&&this.__id&&this.__pool.deleteNode(this.__id),this.parent.type){case"HasParent":this._parent=function(e,t=asPos(e)){return Object.freeze({type:"Orphaned",oldKey:e,oldPos:t})}(this.parent.key,this.parent.pos);break;case"NoParent":this._parent=U;break;case"Orphaned":break;default:assertNever(this.parent,"Unknown state")}this.__pool=void 0}invalidate(){(void 0!==this._cachedImmutable||void 0!==this._cachedTreeNode)&&(this._cachedImmutable=void 0,this._cachedTreeNode=void 0,"HasParent"===this.parent.type&&this.parent.node.invalidate())}toTreeNode(e){return(void 0===this._cachedTreeNode||this._cachedTreeNodeKey!==e)&&(this._cachedTreeNodeKey=e,this._cachedTreeNode=this._toTreeNode(e)),this._cachedTreeNode}toImmutable(){return void 0===this._cachedImmutable&&(this._cachedImmutable=this._toImmutable()),this._cachedImmutable}},M=((s=M||{})[s.OBJECT=0]="OBJECT",s[s.LIST=1]="LIST",s[s.MAP=2]="MAP",s[s.REGISTER=3]="REGISTER",s);function nanoid(e=7){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789,./;[]~!@#$%&*()_+=-",n=t.length;return Array.from({length:e},()=>t.charAt(Math.floor(Math.random()*n))).join("")}var x=class _LiveRegister extends D{constructor(e){super(),this._data=e}get data(){return this._data}static _deserialize([e,t],n,r){let i=new _LiveRegister(t.data);return i._attach(e,r),i}_toOps(e,t,n){if(void 0===this._id)throw Error("Cannot serialize register if parentId or parentKey is undefined");return[{type:8,opId:n?.generateOpId(),id:this._id,parentId:e,parentKey:t,data:this.data}]}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveRegister if parent is missing");return{type:3,parentId:nn(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key,data:this.data}}_attachChild(e){throw Error("Method not implemented.")}_detachChild(e){throw Error("Method not implemented.")}_apply(e,t){return super._apply(e,t)}_toTreeNode(e){return{type:"Json",id:this._id??nanoid(),key:e,payload:this._data}}_toImmutable(){return this._data}clone(){return deepClone(this.data)}};function compareNodePosition(e,t){let n=e._parentPos,r=t._parentPos;return n===r?0:n<r?-1:1}var K=class _LiveList extends D{constructor(e=[]){let t;for(let n of(super(),this._items=[],this._implicitlyDeletedItems=new WeakSet,this._unacknowledgedSets=new Map,e)){let e=makePosition(t),r=lsonToLiveNode(n);r._setParentLink(this,e),this._items.push(r),t=e}}static _deserialize([e],t,n){let r=new _LiveList;r._attach(e,n);let i=t.get(e);if(void 0===i)return r;for(let[e,o]of i){let i=deserialize([e,o],t,n);i._setParentLink(r,o.parentKey),r._insertAndSort(i)}return r}_toOps(e,t,n){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let r=[],i={id:this._id,opId:n?.generateOpId(),type:2,parentId:e,parentKey:t};for(let e of(r.push(i),this._items)){let t=e._getParentKeyOrThrow(),i=HACK_addIntentAndDeletedIdToOperation(e._toOps(this._id,t,n),void 0),o=i[0].opId;void 0!==o&&this._unacknowledgedSets.set(t,o),r.push(...i)}return r}_insertAndSort(e){this._items.push(e),this._sortItems()}_sortItems(){this._items.sort(compareNodePosition),this.invalidate()}_indexOfPosition(e){return this._items.findIndex(t=>t._getParentKeyOrThrow()===e)}_attach(e,t){for(let n of(super._attach(e,t),this._items))n._attach(t.generateId(),t)}_detach(){for(let e of(super._detach(),this._items))e._detach()}_applySetRemote(e){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:t,parentKey:n}=e,r=creationOpToLiveNode(e);r._attach(t,this._pool),r._setParentLink(this,n);let i=e.deletedId,o=this._indexOfPosition(n);if(-1!==o){let t=this._items[o];if(t._id===i)return t._detach(),this._items[o]=r,{modified:makeUpdate(this,[setDelta(o,r)]),reverse:[]};{this._implicitlyDeletedItems.add(t),this._items[o]=r;let n=[setDelta(o,r)],i=this._detachItemAssociatedToSetOperation(e.deletedId);return i&&n.push(i),{modified:makeUpdate(this,n),reverse:[]}}}{let t=[],i=this._detachItemAssociatedToSetOperation(e.deletedId);return i&&t.push(i),this._insertAndSort(r),t.push(insertDelta(this._indexOfPosition(n),r)),{reverse:[],modified:makeUpdate(this,t)}}}_applySetAck(e){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let t=[],n=this._detachItemAssociatedToSetOperation(e.deletedId);n&&t.push(n);let r=this._unacknowledgedSets.get(e.parentKey);if(void 0!==r){if(r!==e.opId)return 0===t.length?{modified:!1}:{modified:makeUpdate(this,t),reverse:[]};this._unacknowledgedSets.delete(e.parentKey)}let i=this._indexOfPosition(e.parentKey),o=this._items.find(t=>t._id===e.id);if(void 0!==o){if(o._parentKey===e.parentKey)return{modified:t.length>0&&makeUpdate(this,t),reverse:[]};-1!==i&&(this._implicitlyDeletedItems.add(this._items[i]),this._items.splice(i,1),t.push(deleteDelta(i)));let n=this._items.indexOf(o);o._setParentLink(this,e.parentKey),this._sortItems();let r=this._items.indexOf(o);return r!==n&&t.push(moveDelta(n,r,o)),{modified:t.length>0&&makeUpdate(this,t),reverse:[]}}{let n=this._pool.getNode(e.id);if(n&&this._implicitlyDeletedItems.has(n)){n._setParentLink(this,e.parentKey),this._implicitlyDeletedItems.delete(n),this._insertAndSort(n);let r=this._items.indexOf(n);return{modified:makeUpdate(this,[-1===i?insertDelta(r,n):setDelta(r,n),...t]),reverse:[]}}{-1!==i&&this._items.splice(i,1);let{newItem:n,newIndex:r}=this._createAttachItemAndSort(e,e.parentKey);return{modified:makeUpdate(this,[-1===i?insertDelta(r,n):setDelta(r,n),...t]),reverse:[]}}}}_detachItemAssociatedToSetOperation(e){if(void 0===e||void 0===this._pool)return null;let t=this._pool.getNode(e);if(void 0===t)return null;let n=this._detachChild(t);return!1===n.modified?null:n.modified.updates[0]}_applyRemoteInsert(e){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let t=asPos(e.parentKey),n=this._indexOfPosition(t);-1!==n&&this._shiftItemPosition(n,t);let{newItem:r,newIndex:i}=this._createAttachItemAndSort(e,t);return{modified:makeUpdate(this,[insertDelta(i,r)]),reverse:[]}}_applyInsertAck(e){let t=this._items.find(t=>t._id===e.id),n=asPos(e.parentKey),r=this._indexOfPosition(n);if(t){if(t._parentKey===n)return{modified:!1};{let e=this._items.indexOf(t);-1!==r&&this._shiftItemPosition(r,n),t._setParentLink(this,n),this._sortItems();let i=this._indexOfPosition(n);return i===e?{modified:!1}:{modified:makeUpdate(this,[moveDelta(e,i,t)]),reverse:[]}}}{let t=nn(this._pool).getNode(e.id);if(t&&this._implicitlyDeletedItems.has(t)){t._setParentLink(this,n),this._implicitlyDeletedItems.delete(t),this._insertAndSort(t);let e=this._indexOfPosition(n);return{modified:makeUpdate(this,[insertDelta(e,t)]),reverse:[]}}{-1!==r&&this._shiftItemPosition(r,n);let{newItem:t,newIndex:i}=this._createAttachItemAndSort(e,n);return{modified:makeUpdate(this,[insertDelta(i,t)]),reverse:[]}}}}_applyInsertUndoRedo(e){let{id:t,parentKey:n}=e,r=creationOpToLiveNode(e);if(this._pool?.getNode(t)!==void 0)return{modified:!1};r._attach(t,nn(this._pool)),r._setParentLink(this,n);let i=this._indexOfPosition(n),o=n;if(-1!==i){let e=this._items[i]?._parentPos,t=this._items[i+1]?._parentPos;o=makePosition(e,t),r._setParentLink(this,o)}this._insertAndSort(r);let s=this._indexOfPosition(o);return{modified:makeUpdate(this,[insertDelta(s,r)]),reverse:[{type:5,id:t}]}}_applySetUndoRedo(e){let{id:t,parentKey:n}=e,r=creationOpToLiveNode(e);if(this._pool?.getNode(t)!==void 0)return{modified:!1};this._unacknowledgedSets.set(n,nn(e.opId));let i=this._indexOfPosition(n);if(r._attach(t,nn(this._pool)),r._setParentLink(this,n),-1!==i){let t=this._items[i];t._detach(),this._items[i]=r;let o=HACK_addIntentAndDeletedIdToOperation(t._toOps(nn(this._id),n,this._pool),e.id),s=[setDelta(i,r)],a=this._detachItemAssociatedToSetOperation(e.deletedId);return a&&s.push(a),{modified:makeUpdate(this,s),reverse:o}}{this._insertAndSort(r),this._detachItemAssociatedToSetOperation(e.deletedId);let i=this._indexOfPosition(n);return{reverse:[{type:5,id:t}],modified:makeUpdate(this,[insertDelta(i,r)])}}}_attachChild(e,t){let n;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");return!1!==(n="set"===e.intent?1===t?this._applySetRemote(e):2===t?this._applySetAck(e):this._applySetUndoRedo(e):1===t?this._applyRemoteInsert(e):2===t?this._applyInsertAck(e):this._applyInsertUndoRedo(e)).modified&&this.invalidate(),n}_detachChild(e){if(e){let t=nn(e._parentKey),n=e._toOps(nn(this._id),t,this._pool),r=this._items.indexOf(e);return -1===r?{modified:!1}:(this._items.splice(r,1),this.invalidate(),e._detach(),{modified:makeUpdate(this,[deleteDelta(r)]),reverse:n})}return{modified:!1}}_applySetChildKeyRemote(e,t){if(this._implicitlyDeletedItems.has(t)){this._implicitlyDeletedItems.delete(t),t._setParentLink(this,e),this._insertAndSort(t);let n=this._items.indexOf(t);return{modified:makeUpdate(this,[insertDelta(n,t)]),reverse:[]}}let n=t._parentKey;if(e===n)return{modified:!1};let r=this._indexOfPosition(e);if(-1===r){let n=this._items.indexOf(t);t._setParentLink(this,e),this._sortItems();let r=this._items.indexOf(t);return r===n?{modified:!1}:{modified:makeUpdate(this,[moveDelta(n,r,t)]),reverse:[]}}{this._items[r]._setParentLink(this,makePosition(e,this._items[r+1]?._parentPos));let n=this._items.indexOf(t);t._setParentLink(this,e),this._sortItems();let i=this._items.indexOf(t);return i===n?{modified:!1}:{modified:makeUpdate(this,[moveDelta(n,i,t)]),reverse:[]}}}_applySetChildKeyAck(e,t){let n=nn(t._parentKey);if(this._implicitlyDeletedItems.has(t)){let n=this._indexOfPosition(e);return this._implicitlyDeletedItems.delete(t),-1!==n&&this._items[n]._setParentLink(this,makePosition(e,this._items[n+1]?._parentPos)),t._setParentLink(this,e),this._insertAndSort(t),{modified:!1}}{if(e===n)return{modified:!1};let r=this._items.indexOf(t),i=this._indexOfPosition(e);-1!==i&&this._items[i]._setParentLink(this,makePosition(e,this._items[i+1]?._parentPos)),t._setParentLink(this,e),this._sortItems();let o=this._items.indexOf(t);return r===o?{modified:!1}:{modified:makeUpdate(this,[moveDelta(r,o,t)]),reverse:[]}}}_applySetChildKeyUndoRedo(e,t){let n=nn(t._parentKey),r=this._items.indexOf(t),i=this._indexOfPosition(e);-1!==i&&this._items[i]._setParentLink(this,makePosition(e,this._items[i+1]?._parentPos)),t._setParentLink(this,e),this._sortItems();let o=this._items.indexOf(t);return r===o?{modified:!1}:{modified:makeUpdate(this,[moveDelta(r,o,t)]),reverse:[{type:1,id:nn(t._id),parentKey:n}]}}_setChildKey(e,t,n){return 1===n?this._applySetChildKeyRemote(e,t):2===n?this._applySetChildKeyAck(e,t):this._applySetChildKeyUndoRedo(e,t)}_apply(e,t){return super._apply(e,t)}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveList if parent is missing");return{type:1,parentId:nn(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key}}get length(){return this._items.length}push(e){return this._pool?.assertStorageIsWritable(),this.insert(e,this.length)}insert(e,t){if(this._pool?.assertStorageIsWritable(),t<0||t>this._items.length)throw Error(`Cannot insert list item at index "${t}". index should be between 0 and ${this._items.length}`);let n=this._items[t-1]?this._items[t-1]._parentPos:void 0,r=this._items[t]?this._items[t]._parentPos:void 0,i=makePosition(n,r),o=lsonToLiveNode(e);if(o._setParentLink(this,i),this._insertAndSort(o),this._pool&&this._id){let e=this._pool.generateId();o._attach(e,this._pool),this._pool.dispatch(o._toOps(this._id,i,this._pool),[{type:5,id:e}],new Map([[this._id,makeUpdate(this,[insertDelta(t,o)])]]))}}move(e,t){if(this._pool?.assertStorageIsWritable(),t<0)throw Error("targetIndex cannot be less than 0");if(t>=this._items.length)throw Error("targetIndex cannot be greater or equal than the list length");if(e<0)throw Error("index cannot be less than 0");if(e>=this._items.length)throw Error("index cannot be greater or equal than the list length");let n=null,r=null;e<t?(r=t===this._items.length-1?void 0:this._items[t+1]._parentPos,n=this._items[t]._parentPos):(r=this._items[t]._parentPos,n=0===t?void 0:this._items[t-1]._parentPos);let i=makePosition(n,r),o=this._items[e],s=o._getParentKeyOrThrow();if(o._setParentLink(this,i),this._sortItems(),this._pool&&this._id){let n=new Map([[this._id,makeUpdate(this,[moveDelta(e,t,o)])]]);this._pool.dispatch([{type:1,id:nn(o._id),opId:this._pool.generateOpId(),parentKey:i}],[{type:1,id:nn(o._id),parentKey:s}],n)}}delete(e){if(this._pool?.assertStorageIsWritable(),e<0||e>=this._items.length)throw Error(`Cannot delete list item at index "${e}". index should be between 0 and ${this._items.length-1}`);let t=this._items[e];if(t._detach(),this._items.splice(e,1),this.invalidate(),this._pool){let n=t._id;if(n){let r=new Map;r.set(nn(this._id),makeUpdate(this,[deleteDelta(e)])),this._pool.dispatch([{id:n,opId:this._pool.generateOpId(),type:5}],t._toOps(nn(this._id),t._getParentKeyOrThrow()),r)}}}clear(){if(this._pool?.assertStorageIsWritable(),this._pool){let e=[],t=[],n=[];for(let r of this._items){r._detach();let i=r._id;i&&(e.push({type:5,id:i,opId:this._pool.generateOpId()}),t.push(...r._toOps(nn(this._id),r._getParentKeyOrThrow())),n.push(deleteDelta(0)))}this._items=[],this.invalidate();let r=new Map;r.set(nn(this._id),makeUpdate(this,n)),this._pool.dispatch(e,t,r)}else{for(let e of this._items)e._detach();this._items=[],this.invalidate()}}set(e,t){if(this._pool?.assertStorageIsWritable(),e<0||e>=this._items.length)throw Error(`Cannot set list item at index "${e}". index should be between 0 and ${this._items.length-1}`);let n=this._items[e],r=n._getParentKeyOrThrow(),i=n._id;n._detach();let o=lsonToLiveNode(t);if(o._setParentLink(this,r),this._items[e]=o,this.invalidate(),this._pool&&this._id){let t=this._pool.generateId();o._attach(t,this._pool);let s=new Map;s.set(this._id,makeUpdate(this,[setDelta(e,o)]));let a=HACK_addIntentAndDeletedIdToOperation(o._toOps(this._id,r,this._pool),i);this._unacknowledgedSets.set(r,nn(a[0].opId));let d=HACK_addIntentAndDeletedIdToOperation(n._toOps(this._id,r,void 0),t);this._pool.dispatch(a,d,s)}}toArray(){return this._items.map(e=>liveNodeToLson(e))}every(e){return this.toArray().every(e)}filter(e){return this.toArray().filter(e)}find(e){return this.toArray().find(e)}findIndex(e){return this.toArray().findIndex(e)}forEach(e){return this.toArray().forEach(e)}get(e){if(!(e<0)&&!(e>=this._items.length))return liveNodeToLson(this._items[e])}indexOf(e,t){return this.toArray().indexOf(e,t)}lastIndexOf(e,t){return this.toArray().lastIndexOf(e,t)}map(e){return this._items.map((t,n)=>e(liveNodeToLson(t),n))}some(e){return this.toArray().some(e)}[Symbol.iterator](){return new j(this._items)}_createAttachItemAndSort(e,t){let n=creationOpToLiveNode(e);n._attach(e.id,nn(this._pool)),n._setParentLink(this,t),this._insertAndSort(n);let r=this._indexOfPosition(t);return{newItem:n,newIndex:r}}_shiftItemPosition(e,t){let n=makePosition(t,this._items.length>e+1?this._items[e+1]?._parentPos:void 0);this._items[e]._setParentLink(this,n)}_toTreeNode(e){return{type:"LiveList",id:this._id??nanoid(),key:e,payload:this._items.map((e,t)=>e.toTreeNode(t.toString()))}}toImmutable(){return super.toImmutable()}_toImmutable(){let e=this._items.map(e=>e.toImmutable());return e}clone(){return new _LiveList(this._items.map(e=>e.clone()))}},j=class{constructor(e){this._innerIterator=e[Symbol.iterator]()}[Symbol.iterator](){return this}next(){let e=this._innerIterator.next();if(e.done)return{done:!0,value:void 0};let t=liveNodeToLson(e.value);return{value:t}}};function makeUpdate(e,t){return{node:e,type:"LiveList",updates:t}}function setDelta(e,t){return{index:e,type:"set",item:t instanceof x?t.data:t}}function deleteDelta(e){return{index:e,type:"delete"}}function insertDelta(e,t){return{index:e,type:"insert",item:t instanceof x?t.data:t}}function moveDelta(e,t,n){return{index:t,type:"move",previousIndex:e,item:n instanceof x?n.data:n}}function HACK_addIntentAndDeletedIdToOperation(e,t){return e.map((e,n)=>0===n?{...e,intent:"set",deletedId:t}:e)}var freeze=e=>e,$=class _LiveMap extends D{constructor(e){if(super(),this.unacknowledgedSet=new Map,e){let t=[];for(let[n,r]of e){let e=lsonToLiveNode(r);e._setParentLink(this,n),t.push([n,e])}this._map=new Map(t)}else this._map=new Map}_toOps(e,t,n){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let r=[],i={id:this._id,opId:n?.generateOpId(),type:7,parentId:e,parentKey:t};for(let[e,t]of(r.push(i),this._map))r.push(...t._toOps(this._id,e,n));return r}static _deserialize([e,t],n,r){let i=new _LiveMap;i._attach(e,r);let o=n.get(e);if(void 0===o)return i;for(let[e,t]of o){let o=deserialize([e,t],n,r);o._setParentLink(i,t.parentKey),i._map.set(t.parentKey,o),i.invalidate()}return i}_attach(e,t){for(let[n,r]of(super._attach(e,t),this._map))isLiveNode(r)&&r._attach(t.generateId(),t)}_attachChild(e,t){let n;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:r,parentKey:i,opId:o}=e,s=creationOpToLiveNode(e);if(void 0!==this._pool.getNode(r))return{modified:!1};if(2===t){let e=this.unacknowledgedSet.get(i);if(e===o)return this.unacknowledgedSet.delete(i),{modified:!1};if(void 0!==e)return{modified:!1}}else 1===t&&this.unacknowledgedSet.delete(i);let a=this._map.get(i);if(a){let e=nn(this._id);n=a._toOps(e,i),a._detach()}else n=[{type:5,id:r}];return s._setParentLink(this,i),s._attach(r,this._pool),this._map.set(i,s),this.invalidate(),{modified:{node:this,type:"LiveMap",updates:{[i]:{type:"update"}}},reverse:n}}_detach(){for(let e of(super._detach(),this._map.values()))e._detach()}_detachChild(e){let t=nn(this._id),n=nn(e._parentKey),r=e._toOps(t,n,this._pool);for(let[t,n]of this._map)n===e&&(this._map.delete(t),this.invalidate());return e._detach(),{modified:{node:this,type:"LiveMap",updates:{[n]:{type:"delete"}}},reverse:r}}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveMap if parent is missing");return{type:2,parentId:nn(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key}}get(e){let t=this._map.get(e);if(void 0!==t)return liveNodeToLson(t)}set(e,t){this._pool?.assertStorageIsWritable();let n=this._map.get(e);n&&n._detach();let r=lsonToLiveNode(t);if(r._setParentLink(this,e),this._map.set(e,r),this.invalidate(),this._pool&&this._id){let t=this._pool.generateId();r._attach(t,this._pool);let i=new Map;i.set(this._id,{node:this,type:"LiveMap",updates:{[e]:{type:"update"}}});let o=r._toOps(this._id,e,this._pool);this.unacknowledgedSet.set(e,nn(o[0].opId)),this._pool.dispatch(r._toOps(this._id,e,this._pool),n?n._toOps(this._id,e):[{type:5,id:t}],i)}}get size(){return this._map.size}has(e){return this._map.has(e)}delete(e){this._pool?.assertStorageIsWritable();let t=this._map.get(e);if(void 0===t)return!1;if(t._detach(),this._map.delete(e),this.invalidate(),this._pool&&t._id){let n=nn(this._id),r=new Map;r.set(n,{node:this,type:"LiveMap",updates:{[e]:{type:"delete"}}}),this._pool.dispatch([{type:5,id:t._id,opId:this._pool.generateOpId()}],t._toOps(n,e),r)}return!0}entries(){let e=this._map.entries();return{[Symbol.iterator](){return this},next(){let t=e.next();if(t.done)return{done:!0,value:void 0};let n=t.value,r=n[0],i=liveNodeToLson(t.value[1]);return{value:[r,i]}}}}[Symbol.iterator](){return this.entries()}keys(){return this._map.keys()}values(){let e=this._map.values();return{[Symbol.iterator](){return this},next(){let t=e.next();if(t.done)return{done:!0,value:void 0};let n=liveNodeToLson(t.value);return{value:n}}}}forEach(e){for(let t of this)e(t[1],t[0],this)}_toTreeNode(e){return{type:"LiveMap",id:this._id??nanoid(),key:e,payload:Array.from(this._map.entries()).map(([e,t])=>t.toTreeNode(e))}}toImmutable(){return super.toImmutable()}_toImmutable(){let e=new Map;for(let[t,n]of this._map)e.set(t,n.toImmutable());return freeze(e)}clone(){return new _LiveMap(Array.from(this._map).map(([e,t])=>[e,t.clone()]))}},B=class _LiveObject extends D{constructor(e={}){for(let t in super(),this._propToLastUpdate=new Map,e){let n=e[t];void 0!==n&&isLiveNode(n)&&n._setParentLink(this,t)}this._map=new Map(Object.entries(e))}static _buildRootAndParentToChildren(e){let t=new Map,n=null;for(let[r,i]of e)if(0!==i.type||void 0!==i.parentId&&void 0!==i.parentKey){let e=[r,i],n=t.get(i.parentId);void 0!==n?n.push(e):t.set(i.parentId,[e])}else n=[r,i];if(null===n)throw Error("Root can't be null");return[n,t]}static _fromItems(e,t){let[n,r]=_LiveObject._buildRootAndParentToChildren(e);return _LiveObject._deserialize(n,r,t)}_toOps(e,t,n){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let r=n?.generateOpId(),i=[],o={type:4,id:this._id,opId:r,parentId:e,parentKey:t,data:{}};for(let[e,t]of(i.push(o),this._map))isLiveNode(t)?i.push(...t._toOps(this._id,e,n)):o.data[e]=t;return i}static _deserialize([e,t],n,r){let i=new _LiveObject(t.data);return i._attach(e,r),this._deserializeChildren(i,n,r)}static _deserializeChildren(e,t,n){let r=t.get(nn(e._id));if(void 0===r)return e;for(let[i,o]of r){let r=function([e,t],n,r){switch(t.type){case 0:return B._deserialize([e,t],n,r);case 1:return K._deserialize([e,t],n,r);case 2:return $._deserialize([e,t],n,r);case 3:return t.data;default:throw Error("Unexpected CRDT type")}}([i,o],t,n);isLiveStructure(r)&&r._setParentLink(e,o.parentKey),e._map.set(o.parentKey,r),e.invalidate()}return e}_attach(e,t){for(let[n,r]of(super._attach(e,t),this._map))isLiveNode(r)&&r._attach(t.generateId(),t)}_attachChild(e,t){let n;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:r,opId:i,parentKey:o}=e,s=creationOpToLson(e);if(void 0!==this._pool.getNode(r))return this._propToLastUpdate.get(o)===i&&this._propToLastUpdate.delete(o),{modified:!1};if(0===t)this._propToLastUpdate.set(o,nn(i));else if(void 0===this._propToLastUpdate.get(o));else if(this._propToLastUpdate.get(o)===i)return this._propToLastUpdate.delete(o),{modified:!1};else return{modified:!1};let a=nn(this._id),d=this._map.get(o);return isLiveNode(d)?(n=d._toOps(a,o),d._detach()):n=void 0===d?[{type:6,id:a,key:o}]:[{type:3,id:a,data:{[o]:d}}],this._map.set(o,s),this.invalidate(),isLiveStructure(s)&&(s._setParentLink(this,o),s._attach(r,this._pool)),{reverse:n,modified:{node:this,type:"LiveObject",updates:{[o]:{type:"update"}}}}}_detachChild(e){if(e){let t=nn(this._id),n=nn(e._parentKey),r=e._toOps(t,n,this._pool);for(let[t,n]of this._map)n===e&&(this._map.delete(t),this.invalidate());return e._detach(),{modified:{node:this,type:"LiveObject",updates:{[n]:{type:"delete"}}},reverse:r}}return{modified:!1}}_detach(){for(let e of(super._detach(),this._map.values()))isLiveNode(e)&&e._detach()}_apply(e,t){return 3===e.type?this._applyUpdate(e,t):6===e.type?this._applyDeleteObjectKey(e,t):super._apply(e,t)}_serialize(){let e={};for(let[t,n]of this._map)isLiveNode(n)||(e[t]=n);return"HasParent"===this.parent.type&&this.parent.node._id?{type:0,parentId:this.parent.node._id,parentKey:this.parent.key,data:e}:{type:0,data:e}}_applyUpdate(e,t){let n=!1,r=nn(this._id),i=[],o={type:3,id:r,data:{}};for(let t in e.data){let e=this._map.get(t);isLiveNode(e)?(i.push(...e._toOps(r,t)),e._detach()):void 0!==e?o.data[t]=e:void 0===e&&i.push({type:6,id:r,key:t})}let s={};for(let r in e.data){let i=e.data[r];if(void 0===i)continue;if(t)this._propToLastUpdate.set(r,nn(e.opId));else if(void 0===this._propToLastUpdate.get(r))n=!0;else{if(this._propToLastUpdate.get(r)!==e.opId)continue;this._propToLastUpdate.delete(r);continue}let o=this._map.get(r);isLiveNode(o)&&o._detach(),n=!0,s[r]={type:"update"},this._map.set(r,i),this.invalidate()}return 0!==Object.keys(o.data).length&&i.unshift(o),n?{modified:{node:this,type:"LiveObject",updates:s},reverse:i}:{modified:!1}}_applyDeleteObjectKey(e,t){let n=e.key;if(!1===this._map.has(n)||!t&&void 0!==this._propToLastUpdate.get(n))return{modified:!1};let r=this._map.get(n),i=nn(this._id),o=[];return isLiveNode(r)?(o=r._toOps(i,e.key),r._detach()):void 0!==r&&(o=[{type:3,id:i,data:{[n]:r}}]),this._map.delete(n),this.invalidate(),{modified:{node:this,type:"LiveObject",updates:{[e.key]:{type:"delete"}}},reverse:o}}toObject(){return Object.fromEntries(this._map)}set(e,t){this._pool?.assertStorageIsWritable(),this.update({[e]:t})}get(e){return this._map.get(e)}delete(e){let t;this._pool?.assertStorageIsWritable();let n=this._map.get(e);if(void 0===n)return;if(void 0===this._pool||void 0===this._id){isLiveNode(n)&&n._detach(),this._map.delete(e),this.invalidate();return}isLiveNode(n)?(n._detach(),t=n._toOps(this._id,e)):t=[{type:3,data:{[e]:n},id:this._id}],this._map.delete(e),this.invalidate();let r=new Map;r.set(this._id,{node:this,type:"LiveObject",updates:{[e]:{type:"delete"}}}),this._pool.dispatch([{type:6,key:e,id:this._id,opId:this._pool.generateOpId()}],t,r)}update(e){if(this._pool?.assertStorageIsWritable(),void 0===this._pool||void 0===this._id){for(let t in e){let n=e[t];if(void 0===n)continue;let r=this._map.get(t);isLiveNode(r)&&r._detach(),isLiveNode(n)&&n._setParentLink(this,t),this._map.set(t,n),this.invalidate()}return}let t=[],n=[],r=this._pool.generateOpId(),i={},o={id:this._id,type:3,data:{}},s={};for(let a in e){let d=e[a];if(void 0===d)continue;let l=this._map.get(a);if(isLiveNode(l)?(n.push(...l._toOps(this._id,a)),l._detach()):void 0===l?n.push({type:6,id:this._id,key:a}):o.data[a]=l,isLiveNode(d)){d._setParentLink(this,a),d._attach(this._pool.generateId(),this._pool);let e=d._toOps(this._id,a,this._pool),n=e.find(e=>e.parentId===this._id);n&&this._propToLastUpdate.set(a,nn(n.opId)),t.push(...e)}else i[a]=d,this._propToLastUpdate.set(a,r);this._map.set(a,d),this.invalidate(),s[a]={type:"update"}}0!==Object.keys(o.data).length&&n.unshift(o),0!==Object.keys(i).length&&t.unshift({opId:r,id:this._id,type:3,data:i});let a=new Map;a.set(this._id,{node:this,type:"LiveObject",updates:s}),this._pool.dispatch(t,n,a)}toImmutable(){return super.toImmutable()}toTreeNode(e){return super.toTreeNode(e)}_toTreeNode(e){let t=this._id??nanoid();return{type:"LiveObject",id:t,key:e,payload:Array.from(this._map.entries()).map(([e,n])=>isLiveNode(n)?n.toTreeNode(e):{type:"Json",id:`${t}:${e}`,key:e,payload:n})}}_toImmutable(){let e={};for(let[t,n]of this._map)e[t]=isLiveStructure(n)?n.toImmutable():n;return e}clone(){return new _LiveObject(Object.fromEntries(Array.from(this._map).map(([e,t])=>[e,isLiveStructure(t)?t.clone():deepClone(t)])))}};function creationOpToLiveNode(e){return lsonToLiveNode(creationOpToLson(e))}function creationOpToLson(e){switch(e.type){case 8:return e.data;case 4:return new B(e.data);case 7:return new $;case 2:return new K;default:return assertNever(e,"Unknown creation Op")}}function deserialize([e,t],n,r){switch(t.type){case 0:return B._deserialize([e,t],n,r);case 1:return K._deserialize([e,t],n,r);case 2:return $._deserialize([e,t],n,r);case 3:return x._deserialize([e,t],n,r);default:throw Error("Unexpected CRDT type")}}function isLiveStructure(e){return isLiveList(e)||e instanceof $||function(e){return e instanceof B}(e)}function isLiveNode(e){return isLiveStructure(e)||e instanceof x}function isLiveList(e){return e instanceof K}function liveNodeToLson(e){return e instanceof x?e.data:e instanceof K||e instanceof $||e instanceof B?e:assertNever(e,"Unknown AbstractCrdt")}function lsonToLiveNode(e){return e instanceof B||e instanceof $||e instanceof K?e:new x(e)}function mergeStorageUpdates(e,t){return void 0===e?t:"LiveObject"===e.type&&"LiveObject"===t.type?function(e,t){let n=e.updates;for(let[e,r]of entries(t.updates))n[e]=r;return{...t,updates:n}}(e,t):"LiveMap"===e.type&&"LiveMap"===t.type?function(e,t){let n=e.updates;for(let[e,r]of entries(t.updates))n[e]=r;return{...t,updates:n}}(e,t):"LiveList"===e.type&&"LiveList"===t.type?function(e,t){let n=e.updates;return{...t,updates:n.concat(t.updates)}}(e,t):t}function isJsonArray(e){return Array.isArray(e)}var z=((a=z||{})[a.UPDATE_PRESENCE=100]="UPDATE_PRESENCE",a[a.BROADCAST_EVENT=103]="BROADCAST_EVENT",a[a.FETCH_STORAGE=200]="FETCH_STORAGE",a[a.UPDATE_STORAGE=201]="UPDATE_STORAGE",a[a.FETCH_YDOC=300]="FETCH_YDOC",a[a.UPDATE_YDOC=301]="UPDATE_YDOC",a);function merge(e,t){let n=!1,r={...e};return Object.keys(t).forEach(e=>{let i=t[e];r[e]!==i&&(void 0===i?delete r[e]:r[e]=i,n=!0)}),n?r:e}var H=class{constructor(){this._ev=makeEventSource()}get didInvalidate(){return this._ev.observable}invalidate(){void 0!==this._cache&&(this._cache=void 0,this._ev.notify())}get current(){return this._cache??(this._cache=this._toImmutable())}},J=class extends H{constructor(){super(),this._connections=new Map,this._presences=new Map,this._users=new Map}connectionIds(){return this._connections.keys()}_toImmutable(){let e=compact(Array.from(this._presences.keys()).map(e=>this.getUser(Number(e))));return e}clearOthers(){this._connections=new Map,this._presences=new Map,this._users=new Map,this.invalidate()}_getUser(e){let t=this._connections.get(e),n=this._presences.get(e);if(void 0!==t&&void 0!==n)return function(e,t){let{connectionId:n,id:r,info:i}=e,o=canWriteStorage(e.scopes);return freeze(compactObject({connectionId:n,id:r,info:i,canWrite:o,canComment:canComment(e.scopes),isReadOnly:!o,presence:t}))}(t,n)}getUser(e){let t=this._users.get(e);if(t)return t;let n=this._getUser(e);if(n)return this._users.set(e,n),n}_invalidateUser(e){this._users.has(e)&&this._users.delete(e),this.invalidate()}setConnection(e,t,n,r){this._connections.set(e,freeze({connectionId:e,id:t,info:n,scopes:r})),this._presences.has(e)&&this._invalidateUser(e)}removeConnection(e){this._connections.delete(e),this._presences.delete(e),this._invalidateUser(e)}setOther(e,t){this._presences.set(e,freeze(compactObject(t))),this._connections.has(e)&&this._invalidateUser(e)}patchOther(e,t){let n=this._presences.get(e);if(void 0===n)return;let r=merge(n,t);n!==r&&(this._presences.set(e,freeze(r)),this._invalidateUser(e))}},F=class extends H{constructor(e){super(),this._data=freeze(compactObject(e))}_toImmutable(){return this._data}patch(e){let t=this._data,n=merge(t,e);t!==n&&(this._data=freeze(n),this.invalidate())}},W=class extends H{constructor(e){super(),this._value=freeze(e)}_toImmutable(){return this._value}set(e){this._value=freeze(e),this.invalidate()}},V=class extends H{constructor(...e){super();let t=e.pop();this._refs=e,this._refs.forEach(e=>{e.didInvalidate.subscribe(()=>this.invalidate())}),this._transform=t}_toImmutable(){return this._transform(...this._refs.map(e=>e.current))}};function userToTreeNode(e,t){return{type:"User",id:`${t.connectionId}`,key:e,payload:t}}function createClient(e){let t=checkBounds("throttle",e.throttle??100,16,1e3),n=checkBounds("lostConnectionTimeout",e.lostConnectionTimeout??5e3,200,3e4,1e3),r=function(e){if(void 0!==e)return checkBounds("backgroundKeepAliveTimeout",e,15e3)}(e.backgroundKeepAliveTimeout),i=function(e){let t=function(e){let{publicApiKey:t,authEndpoint:n}=e;if(void 0!==n&&void 0!==t)throw Error("You cannot simultaneously use `publicApiKey` and `authEndpoint` options. Please pick one and leave the other option unspecified. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient");if("string"==typeof t){if(t.startsWith("sk_"))throw Error("Invalid `publicApiKey` option. The value you passed is a secret key, which should not be used from the client. Please only ever pass a public key here. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey");if(!t.startsWith("pk_"))throw Error("Invalid key. Please use the public key format: pk_<public key>. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey");return{type:"public",publicApiKey:t}}if("string"==typeof n)return{type:"private",url:n};if("function"==typeof n)return{type:"custom",callback:n};if(void 0!==n)throw Error("The `authEndpoint` option must be a string or a function. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientAuthEndpoint");throw Error("Invalid Liveblocks client options. Please provide either a `publicApiKey` or `authEndpoint` option. They cannot both be empty. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient")}(e),n=new Set,r=[],i=[],o=new Map;async function makeAuthRequest(r){let i=e.polyfills?.fetch??("undefined"==typeof window?void 0:window.fetch);if("private"===t.type){if(void 0===i)throw new O("To use Liveblocks client in a non-DOM environment with a url as auth endpoint, you need to provide a fetch polyfill.");let e=await fetchAuthEndpoint(i,t.url,{room:r}),o=parseAuthToken(e.token);if(n.has(o.raw))throw new O("The same Liveblocks auth token was issued from the backend before. Caching Liveblocks tokens is not supported.");return o}if("custom"===t.type){let e=await t.callback(r);if(e&&"object"==typeof e){if("string"==typeof e.token)return parseAuthToken(e.token);if("string"==typeof e.error){let t=`Authentication failed: ${"reason"in e&&"string"==typeof e.reason?e.reason:"Forbidden"}`;if("forbidden"===e.error)throw new O(t);throw Error(t)}}throw Error('Your authentication callback function should return a token, but it did not. Hint: the return value should look like: { token: "..." }')}throw Error("Unexpected authentication type. Must be private or custom.")}return{reset:function(){n.clear(),r.length=0,i.length=0,o.clear()},getAuthValue:async function(e,s){if("public"===t.type)return{type:"public",publicApiKey:t.publicApiKey};let a=function(e,t){let n=Math.ceil(Date.now()/1e3);for(let o=r.length-1;o>=0;o--){let s=r[o],a=i[o];if(a<=n){r.splice(o,1),i.splice(o,1);continue}if("id"===s.parsed.k)return s;if("acc"===s.parsed.k){for(let[n,r]of Object.entries(s.parsed.perms))if(n.includes("*")&&t.startsWith(n.replace("*",""))||t===n&&("comments:read"===e?r.includes("comments:read")||r.includes("comments:write")||r.includes("room:read")||r.includes("room:write"):"room:read"===e&&(r.includes("room:read")||r.includes("room:write"))))return s}}}(e,s);if(void 0!==a)return{type:"secret",token:a};let d=o.get(s);void 0===d&&(d=makeAuthRequest(s),o.set(s,d));try{let e=await d,t=Math.floor(Date.now()/1e3)+(e.parsed.exp-e.parsed.iat)-30;return n.add(e.raw),"sec-legacy"!==e.parsed.k&&(r.push(e),i.push(t)),{type:"secret",token:e}}finally{o.delete(s)}}}}(e),o=new Map;function leaseRoom(e){let leave=()=>{if(e.unsubs.delete(leave)){if(0===e.unsubs.size){var t;(t=e.room).id,o.delete(t.id),t.destroy()}}else f("This leave function was already called. Calling it more than once has no effect.")};return e.unsubs.add(leave),{room:e.room,leave}}function enterRoom(s,a){var d;let l=o.get(s);if(void 0!==l)return leaseRoom(l);!function(e,t,n=t){}(null===a.initialPresence||a.initialPresence,"Please provide an initial presence value for the current user when entering the room.");let c=function(e){if("liveblocksServer"in e)throw Error("Client option no longer supported");return"string"==typeof e.baseUrl&&e.baseUrl.startsWith("http")?e.baseUrl:"https://api.liveblocks.io"}(e),h=function(e,t){let n,r,i;let o="function"==typeof e.initialPresence?e.initialPresence(t.roomId):e.initialPresence,s="function"==typeof e.initialStorage?e.initialStorage(t.roomId):e.initialStorage,[a,d]=function(){let e="undefined"!=typeof document?document:void 0,t={current:null};function onVisibilityChange(){e?.visibilityState==="hidden"?t.current=t.current??Date.now():t.current=null}return e?.addEventListener("visibilitychange",onVisibilityChange),[t,()=>{e?.removeEventListener("visibilitychange",onVisibilityChange)}]}(),l={...t.delegates,canZombie:()=>void 0!==t.backgroundKeepAliveTimeout&&null!==a.current&&Date.now()>a.current+t.backgroundKeepAliveTimeout&&"synchronizing"!==getStorageStatus()},u=new I(l,t.enableDebugLogging),c={buffer:{flushTimerID:void 0,lastFlushedAt:0,presenceUpdates:{type:"full",data:o},messages:[],storageOperations:[]},staticSessionInfo:new W(null),dynamicSessionInfo:new W(null),myPresence:new F(o),others:new J,initialStorage:s,idFactory:null,clock:0,opClock:0,nodes:new Map,root:void 0,undoStack:[],redoStack:[],pausedHistory:null,activeBatch:null,unacknowledgedOps:new Map,opStackTraces:void 0},doNotBatchUpdates=e=>e(),h=t.unstable_batchedUpdates??doNotBatchUpdates,p=!1;u.events.onMessage.subscribe(function(e){if("string"!=typeof e.data)return;let t=function(e){let t=tryParseJson(e);return void 0===t?null:isJsonArray(t)?compact(t.map(e=>parseServerMessage(e))):compact([parseServerMessage(t)])}(e.data);if(null===t||0===t.length)return;let n={storageUpdates:new Map,others:[]};h(()=>{for(let e of t)switch(e.type){case 101:{let t=function(e){c.others.setConnection(e.actor,e.id,e.info,e.scopes),c.buffer.messages.push({type:100,data:c.myPresence.current,targetActor:e.actor}),flushNowOrSoon();let t=c.others.getUser(e.actor);return t?{type:"enter",user:t}:void 0}(e);t&&n.others.push(t);break}case 100:{let t=function(e){if(void 0!==e.targetActor){let t=c.others.getUser(e.actor);c.others.setOther(e.actor,e.data);let n=c.others.getUser(e.actor);if(void 0===t&&void 0!==n)return{type:"enter",user:n}}else c.others.patchOther(e.actor,e.data);let t=c.others.getUser(e.actor);return t?{type:"update",updates:e.data,user:t}:void 0}(e);t&&n.others.push(t);break}case 103:{let t=c.others.current;y.customEvent.notify({connectionId:e.actor,user:e.actor<0?null:t.find(t=>t.connectionId===e.actor)??null,event:e.event});break}case 102:{let t=function(e){let t=c.others.getUser(e.actor);return t?(c.others.removeConnection(e.actor),{type:"leave",user:t}):null}(e);t&&n.others.push(t);break}case 300:y.ydoc.notify(e);break;case 104:n.others.push(function(e,t){var n;let r;for(let i of(c.dynamicSessionInfo.set({actor:e.actor,nonce:e.nonce,scopes:e.scopes}),c.idFactory=(n=e.actor,r=0,()=>`${n}:${r++}`),notifySelfChanged(t),c.others.connectionIds())){let t=e.users[i];void 0===t&&c.others.removeConnection(i)}for(let t in e.users){let n=e.users[t],r=Number(t);c.others.setConnection(r,n.id,n.info,n.scopes)}return{type:"reset"}}(e,doNotBatchUpdates));break;case 200:{let t=new Map(c.unacknowledgedOps);(function(e,t){if(0===e.items.length)throw Error("Internal error: cannot load storage without items");void 0!==c.root?function(e,t){if(void 0===c.root)return;let n=new Map;for(let[e,t]of c.nodes)n.set(e,t._serialize());let r=function(e,t){let n=[];return e.forEach((e,r)=>{t.get(r)||n.push({type:5,id:r})}),t.forEach((t,r)=>{let i=e.get(r);if(i)0===t.type&&(0!==i.type||JSON.stringify(t.data)!==JSON.stringify(i.data))&&n.push({type:3,id:r,data:t.data}),t.parentKey!==i.parentKey&&n.push({type:1,id:r,parentKey:nn(t.parentKey,"Parent key must not be missing")});else switch(t.type){case 3:n.push({type:8,id:r,parentId:t.parentId,parentKey:t.parentKey,data:t.data});break;case 1:n.push({type:2,id:r,parentId:t.parentId,parentKey:t.parentKey});break;case 0:if(void 0===t.parentId||void 0===t.parentKey)throw Error("Internal error. Cannot serialize storage root into an operation");n.push({type:4,id:r,parentId:t.parentId,parentKey:t.parentKey,data:t.data});break;case 2:n.push({type:7,id:r,parentId:t.parentId,parentKey:t.parentKey})}}),n}(n,new Map(e)),i=applyOps(r,!1);notify(i.updates,t)}(e.items,t):c.root=B._fromItems(e.items,m);let n=c.undoStack.length;for(let e in c.initialStorage)if(void 0===c.root.get(e)){var r;c.root.set(e,void 0===(r=c.initialStorage[e])?void 0:isLiveStructure(r)?r.clone():deepClone(r))}c.undoStack.length=n})(e,doNotBatchUpdates),function(e,t){if(0===e.size)return;let n=[],r=Array.from(e.values()),i=applyOps(r,!0);n.push({type:201,ops:i.ops}),notify(i.updates,t),sendMessages(n)}(t,doNotBatchUpdates),E?.(),notifyStorageStatus(),y.storageDidLoad.notify();break}case 201:{let t=applyOps(e.ops,!1);for(let[e,r]of t.updates.storageUpdates)n.storageUpdates.set(e,mergeStorageUpdates(n.storageUpdates.get(e),r));break}case 299:_("Storage mutation rejection error",e.reason);break;case 400:case 401:case 405:case 406:case 402:case 403:case 404:y.comments.notify(e)}notify(n,doNotBatchUpdates)})}),u.events.statusDidChange.subscribe(function(e){let t=u.authValue;if(null!==t){let e="secret"===t.type?t.token.raw:t.publicApiKey;if(e!==n){if(n=e,"secret"===t.type){let e=t.token.parsed;c.staticSessionInfo.set({userId:"sec-legacy"===e.k?e.id:e.uid,userInfo:"sec-legacy"===e.k?e.info:e.ui})}else c.staticSessionInfo.set({userId:void 0,userInfo:void 0})}}h(()=>{y.status.notify(e),notifySelfChanged(doNotBatchUpdates)})}),u.events.statusDidChange.subscribe(function(e){"reconnecting"===e?r=setTimeout(()=>{h(()=>{y.lostConnection.notify("lost"),p=!0,c.others.clearOthers(),notify({others:[{type:"reset"}]},doNotBatchUpdates)})},t.lostConnectionTimeout):(clearTimeout(r),p&&("disconnected"===e?h(()=>{y.lostConnection.notify("failed")}):h(()=>{y.lostConnection.notify("restored")}),p=!1))}),u.events.didConnect.subscribe(function(){c.buffer.presenceUpdates={type:"full",data:{...c.myPresence.current}},null!==b&&refreshStorage({flush:!1}),flushNowOrSoon()}),u.events.didDisconnect.subscribe(function(){clearTimeout(c.buffer.flushTimerID)}),u.events.onLiveblocksError.subscribe(e=>{h(()=>{y.error.notify(e)})});let m={roomId:t.roomId,getNode:e=>c.nodes.get(e),addNode:(e,t)=>void c.nodes.set(e,t),deleteNode:e=>void c.nodes.delete(e),generateId:()=>`${getConnectionId()}:${c.clock++}`,generateOpId:()=>`${getConnectionId()}:${c.opClock++}`,dispatch(e,t,n){let r=c.activeBatch;if(r){for(let[t,i]of(r.ops.push(...e),n))r.updates.storageUpdates.set(t,mergeStorageUpdates(r.updates.storageUpdates.get(t),i));r.reverseOps.unshift(...t)}else h(()=>{addToUndoStack(t,doNotBatchUpdates),c.redoStack.length=0,dispatchOps(e),notify({storageUpdates:n},doNotBatchUpdates)})},assertStorageIsWritable:()=>{let e=c.dynamicSessionInfo.current?.scopes;if(void 0===e)return;let t=canWriteStorage(e);if(!t)throw Error("Cannot write to storage with a read only user, please ensure the user has write permissions")}},y={connection:makeEventSource(),status:makeEventSource(),lostConnection:makeEventSource(),customEvent:makeEventSource(),self:makeEventSource(),myPresence:makeEventSource(),others:makeEventSource(),error:makeEventSource(),storage:makeEventSource(),history:makeEventSource(),storageDidLoad:makeEventSource(),storageStatus:makeEventSource(),ydoc:makeEventSource(),comments:makeEventSource()};async function httpSend(e,n,r,i){let o=new URL(`/v2/c/rooms/${encodeURIComponent(n)}/send-message`,t.baseUrl).toString(),s=t.polyfills?.fetch||fetch;return s(o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({nonce:r,messages:i})})}function sendMessages(e){let n=JSON.stringify(e),r=c.dynamicSessionInfo.current?.nonce;if(t.unstable_fallbackToHTTP&&u.authValue&&r){let i=new TextEncoder().encode(n).length;if(i>1047552){httpSend("public"===u.authValue.type?u.authValue.publicApiKey:u.authValue.token.raw,t.roomId,r,e).then(e=>{e.ok||403!==e.status||u.reconnect()}),f("Message was too large for websockets and sent over HTTP instead");return}}u.send(n)}let g=new V(c.staticSessionInfo,c.dynamicSessionInfo,c.myPresence,(e,t,n)=>{if(null===e||null===t)return null;{let r=canWriteStorage(t.scopes);return{connectionId:t.actor,id:e.userId,info:e.userInfo,presence:n,canWrite:r,canComment:canComment(t.scopes),isReadOnly:!r}}});function notifySelfChanged(e){let t=g.current;null!==t&&t!==i&&(e(()=>{y.self.notify(t)}),i=t)}let v=new V(g,e=>null!==e?userToTreeNode("Me",e):null);function _addToRealUndoStack(e,t){c.undoStack.length>=50&&c.undoStack.shift(),c.undoStack.push(e),onHistoryChange(t)}function addToUndoStack(e,t){null!==c.pausedHistory?c.pausedHistory.unshift(...e):_addToRealUndoStack(e,t)}function notify(e,t){let n=e.storageUpdates,r=e.others;t(()=>{if(void 0!==r&&r.length>0){let e=c.others.current;for(let t of r)y.others.notify({...t,others:e})}if(e.presence&&(notifySelfChanged(doNotBatchUpdates),y.myPresence.notify(c.myPresence.current)),void 0!==n&&n.size>0){let e=Array.from(n.values());y.storage.notify(e)}notifyStorageStatus()})}function getConnectionId(){let e=c.dynamicSessionInfo.current;if(e)return e.actor;throw Error("Internal. Tried to get connection id but connection was never open")}function applyOps(e,t){let n={reverse:[],storageUpdates:new Map,presence:!1},r=new Set,i=e.map(e=>"presence"===e.type||e.opId?e:{...e,opId:m.generateOpId()});for(let e of i)if("presence"===e.type){let t={type:"presence",data:{}};for(let n in e.data)t.data[n]=c.myPresence.current[n];if(c.myPresence.patch(e.data),null===c.buffer.presenceUpdates)c.buffer.presenceUpdates={type:"partial",data:e.data};else for(let t in e.data)c.buffer.presenceUpdates.data[t]=e.data[t];n.reverse.unshift(t),n.presence=!0}else{let i;if(t)i=0;else{let t=nn(e.opId),n=c.unacknowledgedOps.delete(t);i=n?2:1}let o=function(e,t){if(5===e.type&&"ACK"===e.id)return{modified:!1};switch(e.type){case 6:case 3:case 5:{let n=c.nodes.get(e.id);if(void 0===n)return{modified:!1};return n._apply(e,0===t)}case 1:{let n=c.nodes.get(e.id);if(void 0===n)return{modified:!1};if("HasParent"===n.parent.type&&isLiveList(n.parent.node))return n.parent.node._setChildKey(asPos(e.parentKey),n,t);return{modified:!1}}case 4:case 2:case 7:case 8:{if(void 0===e.parentId)return{modified:!1};let n=c.nodes.get(e.parentId);if(void 0===n)return{modified:!1};return n._attachChild(e,t)}}}(e,i);if(o.modified){let t=o.modified.node._id;t&&r.has(t)||(n.storageUpdates.set(nn(o.modified.node._id),mergeStorageUpdates(n.storageUpdates.get(nn(o.modified.node._id)),o.modified)),n.reverse.unshift(...o.reverse)),(2===e.type||7===e.type||4===e.type)&&r.add(nn(e.id))}}return{ops:i,reverse:n.reverse,updates:{storageUpdates:n.storageUpdates,presence:n.presence}}}function canUndo(){return c.undoStack.length>0}function canRedo(){return c.redoStack.length>0}function onHistoryChange(e){e(()=>{y.history.notify({canUndo:canUndo(),canRedo:canRedo()})})}function parseServerMessage(e){var t;return null===(t=e)||"string"==typeof t||"number"==typeof t||"boolean"==typeof t||isJsonArray(t)?null:e}function flushNowOrSoon(){let e=c.buffer.storageOperations;if(e.length>0){for(let t of e)c.unacknowledgedOps.set(nn(t.opId),t);notifyStorageStatus()}if("connected"!==u.getStatus()){c.buffer.storageOperations=[];return}let n=Date.now(),r=n-c.buffer.lastFlushedAt;if(r>t.throttleDelay){let e=function(){let e=[];for(let t of(c.buffer.presenceUpdates&&e.push("full"===c.buffer.presenceUpdates.type?{type:100,targetActor:-1,data:c.buffer.presenceUpdates.data}:{type:100,data:c.buffer.presenceUpdates.data}),c.buffer.messages))e.push(t);return c.buffer.storageOperations.length>0&&e.push({type:201,ops:c.buffer.storageOperations}),e}();if(0===e.length)return;sendMessages(e),c.buffer={flushTimerID:void 0,lastFlushedAt:n,messages:[],storageOperations:[],presenceUpdates:null}}else clearTimeout(c.buffer.flushTimerID),c.buffer.flushTimerID=setTimeout(flushNowOrSoon,t.throttleDelay-r)}function dispatchOps(e){c.buffer.storageOperations.push(...e),flushNowOrSoon()}let b=null,E=null;function refreshStorage(e){let t=c.buffer.messages;t.some(e=>200===e.type)||t.push({type:200}),e.flush&&flushNowOrSoon()}function startLoadingStorage(){return null===b&&(refreshStorage({flush:!0}),b=new Promise(e=>{E=e}),notifyStorageStatus()),b}async function getStorage(){return void 0!==c.root?Promise.resolve({root:c.root}):(await startLoadingStorage(),{root:nn(c.root)})}function getStorageStatus(){return void 0===c.root?null===b?"not-loaded":"loading":0===c.unacknowledgedOps.size?"synchronized":"synchronizing"}let S=getStorageStatus();function notifyStorageStatus(){let e=getStorageStatus();S!==e&&(S=e,y.storageStatus.notify(e))}let k=new V(c.others,e=>e.map((e,t)=>userToTreeNode(`Other ${t}`,e))),w={status:y.status.observable,lostConnection:y.lostConnection.observable,customEvent:y.customEvent.observable,others:y.others.observable,self:y.self.observable,myPresence:y.myPresence.observable,error:y.error.observable,storage:y.storage.observable,history:y.history.observable,storageDidLoad:y.storageDidLoad.observable,storageStatus:y.storageStatus.observable,ydoc:y.ydoc.observable,comments:y.comments.observable},O=function(e,t,n){async function fetchJson(t,n){let r;let i=await fetchApi(e,t,n);if(!i.ok&&i.status>=400&&i.status<600){let e;try{let t=await i.json();e=new L(t.message,i.status,t)}catch{e=new L(i.statusText,i.status)}throw e}try{r=await i.json()}catch{r={}}return r}async function fetchApi(e,r,i){let o=await t(),s=new URL(`/v2/c/rooms/${encodeURIComponent(e)}${r}`,n.baseUrl).toString();return await fetch(s,{...i,headers:{...i?.headers,Authorization:`Bearer ${"public"===o.type?o.publicApiKey:o.token.raw}`}})}return{getThreads:async function(){let t=await fetchApi(e,"/threads");if(t.ok){let e=await t.json();return e.data}if(404===t.status)return[];throw Error("There was an error while getting threads.")},createThread:function({metadata:e,body:t,commentId:n,threadId:r}){return fetchJson("/threads",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r,comment:{id:n,body:t},metadata:e})})},editThreadMetadata:function({metadata:e,threadId:t}){return fetchJson(`/threads/${encodeURIComponent(t)}/metadata`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})},createComment:function({threadId:e,commentId:t,body:n}){return fetchJson(`/threads/${encodeURIComponent(e)}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t,body:n})})},editComment:function({threadId:e,commentId:t,body:n}){return fetchJson(`/threads/${encodeURIComponent(e)}/comments/${encodeURIComponent(t)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({body:n})})},deleteComment:async function({threadId:e,commentId:t}){await fetchJson(`/threads/${encodeURIComponent(e)}/comments/${encodeURIComponent(t)}`,{method:"DELETE"})},addReaction:function({threadId:e,commentId:t,emoji:n}){return fetchJson(`/threads/${encodeURIComponent(e)}/comments/${encodeURIComponent(t)}/reactions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emoji:n})})},removeReaction:function({threadId:e,commentId:t,emoji:n}){return fetchJson(`/threads/${encodeURIComponent(e)}/comments/${encodeURIComponent(t)}/reactions/${encodeURIComponent(n)}`,{method:"DELETE"})}}}(t.roomId,l.authenticate,{baseUrl:t.baseUrl});return Object.defineProperty({__internal:{get presenceBuffer(){return deepClone(c.buffer.presenceUpdates?.data??null)},get undoStack(){return deepClone(c.undoStack)},get nodeCount(){return c.nodes.size},getSelf_forDevTools:()=>v.current,getOthers_forDevTools:()=>k.current,simulate:{explicitClose:e=>u._privateSendMachineEvent({type:"EXPLICIT_SOCKET_CLOSE",event:e}),rawSend:e=>u.send(e)}},id:t.roomId,subscribe:function(e,t,n){if("string"==typeof e&&("my-presence"===e||"others"===e||"event"===e||"error"===e||"history"===e||"status"===e||"storage-status"===e||"lost-connection"===e||"connection"===e)){if("function"!=typeof t)throw Error("Second argument must be a callback function");switch(e){case"event":return w.customEvent.subscribe(t);case"my-presence":return w.myPresence.subscribe(t);case"others":return w.others.subscribe(e=>{let{others:n,...r}=e;return t(n,r)});case"error":return w.error.subscribe(t);case"connection":return w.status.subscribe(e=>t(newToLegacyStatus(e)));case"status":return w.status.subscribe(t);case"lost-connection":return w.lostConnection.subscribe(t);case"history":return w.history.subscribe(t);case"storage-status":return w.storageStatus.subscribe(t);default:return assertNever(e,`"${String(e)}" is not a valid event name`)}}if(void 0===t||"function"==typeof e){if("function"==typeof e)return w.storage.subscribe(e);throw Error("Please specify a listener callback")}if(isLiveNode(e))return n?.isDeep?w.storage.subscribe(n=>{let r=n.filter(t=>(function isSameNodeOrChildOf(e,t){return e===t||"HasParent"===e.parent.type&&isSameNodeOrChildOf(e.parent.node,t)})(t.node,e));r.length>0&&t(r)}):w.storage.subscribe(n=>{for(let r of n)r.node._id===e._id&&t(r.node)});throw Error(`${String(e)} is not a value that can be subscribed to.`)},connect:()=>u.connect(),reconnect:()=>u.reconnect(),disconnect:()=>u.disconnect(),destroy:()=>{d(),u.destroy()},updatePresence:function(e,t){let n={};for(let t in null===c.buffer.presenceUpdates&&(c.buffer.presenceUpdates={type:"partial",data:{}}),e){let r=e[t];void 0!==r&&(c.buffer.presenceUpdates.data[t]=r,n[t]=c.myPresence.current[t])}c.myPresence.patch(e),c.activeBatch?(t?.addToHistory&&c.activeBatch.reverseOps.unshift({type:"presence",data:n}),c.activeBatch.updates.presence=!0):(flushNowOrSoon(),h(()=>{t?.addToHistory&&addToUndoStack([{type:"presence",data:n}],doNotBatchUpdates),notify({presence:!0},doNotBatchUpdates)}))},updateYDoc:function(e,t){let n={type:301,update:e,guid:t};c.buffer.messages.push(n),y.ydoc.notify(n),flushNowOrSoon()},broadcastEvent:function(e,t={shouldQueueEventIfNotReady:!1}){("connected"===u.getStatus()||t.shouldQueueEventIfNotReady)&&(c.buffer.messages.push({type:103,event:e}),flushNowOrSoon())},batch:function(e){let t;return c.activeBatch?e():(h(()=>{c.activeBatch={ops:[],updates:{storageUpdates:new Map,presence:!1,others:[]},reverseOps:[]};try{t=e()}finally{let e=c.activeBatch;c.activeBatch=null,e.reverseOps.length>0&&addToUndoStack(e.reverseOps,doNotBatchUpdates),e.ops.length>0&&(c.redoStack.length=0),e.ops.length>0&&dispatchOps(e.ops),notify(e.updates,doNotBatchUpdates),flushNowOrSoon()}}),t)},history:{undo:function(){if(c.activeBatch)throw Error("undo is not allowed during a batch");let e=c.undoStack.pop();if(void 0===e)return;c.pausedHistory=null;let t=applyOps(e,!0);for(let e of(h(()=>{notify(t.updates,doNotBatchUpdates),c.redoStack.push(t.reverse),onHistoryChange(doNotBatchUpdates)}),t.ops))"presence"!==e.type&&c.buffer.storageOperations.push(e);flushNowOrSoon()},redo:function(){if(c.activeBatch)throw Error("redo is not allowed during a batch");let e=c.redoStack.pop();if(void 0===e)return;c.pausedHistory=null;let t=applyOps(e,!0);for(let e of(h(()=>{notify(t.updates,doNotBatchUpdates),c.undoStack.push(t.reverse),onHistoryChange(doNotBatchUpdates)}),t.ops))"presence"!==e.type&&c.buffer.storageOperations.push(e);flushNowOrSoon()},canUndo,canRedo,clear:function(){c.undoStack.length=0,c.redoStack.length=0},pause:function(){null===c.pausedHistory&&(c.pausedHistory=[])},resume:function(){let e=c.pausedHistory;c.pausedHistory=null,null!==e&&e.length>0&&_addToRealUndoStack(e,h)}},fetchYDoc:function(e,t){c.buffer.messages.find(n=>300===n.type&&n.vector===e&&n.guid===t)||c.buffer.messages.push({type:300,vector:e,guid:t}),flushNowOrSoon()},getStorage,getStorageSnapshot:function(){let e=c.root;return void 0!==e?e:(startLoadingStorage(),null)},getStorageStatus,events:w,getStatus:()=>u.getStatus(),getConnectionState:()=>u.getLegacyStatus(),getSelf:()=>g.current,getPresence:()=>c.myPresence.current,getOthers:()=>c.others.current,...O},"__internal",{enumerable:!1})}({initialPresence:a.initialPresence??{},initialStorage:a.initialStorage},{roomId:s,throttleDelay:t,lostConnectionTimeout:n,backgroundKeepAliveTimeout:r,polyfills:e.polyfills,delegates:e.mockedDelegates??{createSocket:(d=e.polyfills?.WebSocket,e=>{let t=d??("undefined"==typeof WebSocket?void 0:WebSocket);if(void 0===t)throw new O("To use Liveblocks client in a non-DOM environment, you need to provide a WebSocket polyfill.");let n=new URL(c);if(n.protocol="http:"===n.protocol?"ws":"wss",n.pathname="/v7",n.searchParams.set("roomId",s),"secret"===e.type)n.searchParams.set("tok",e.token.raw);else{if("public"!==e.type)return assertNever(e,"Unhandled case");n.searchParams.set("pubkey",e.publicApiKey)}return n.searchParams.set("version",u||"dev"),new t(n.toString())}),authenticate:async()=>i.getAuthValue("room:read",s)},enableDebugLogging:e.enableDebugLogging,unstable_batchedUpdates:a?.unstable_batchedUpdates,baseUrl:c,unstable_fallbackToHTTP:!!e.unstable_fallbackToHTTP}),p={room:h,unsubs:new Set};o.set(s,p),()=>Array.from(o.keys());let m=a.autoConnect??a.shouldInitiallyConnect??!0;if(m){if("undefined"==typeof atob){if(e.polyfills?.atob===void 0)throw Error("You need to polyfill atob to use the client in your environment. Please follow the instructions at https://liveblocks.io/docs/errors/liveblocks-client/atob-polyfill");global.atob=e.polyfills.atob}h.connect()}return leaseRoom(p)}return{logout:function(){for(let{room:t}of(i.reset(),o.values())){var e;"initial"===(e=t.getStatus())||"disconnected"===e||t.reconnect()}},enter:function(e,t){let{room:n,leave:r}=enterRoom(e,t);return n},getRoom:function(e){let t=o.get(e)?.room;return t||null},leave:function(e){let t=o.get(e)?.unsubs??new Set;for(let e of t)e()},enterRoom}}function checkBounds(e,t,n,r,i){if("number"!=typeof t||t<n||void 0!==r&&t>r)throw Error(void 0!==r?`${e} should be between ${i??n} and ${r}.`:`${e} should be at least ${i??n}.`);return t}function lsonObjectToJson(e){let t={};for(let n in e){let r=e[n];void 0!==r&&(t[n]=function lsonToJson(e){return e instanceof B?lsonObjectToJson(e.toObject()):e instanceof K?e.toArray().map(lsonToJson):e instanceof $?function(e){let t={};for(let[n,r]of e.entries())t[n]=lsonToJson(r);return t}(e):e instanceof x?e.data:Array.isArray(e)?e.map(lsonToJson):isPlainObject(e)?lsonObjectToJson(e):e}(r))}return t}function shallow(e,t){if(Object.is(e,t))return!0;let n=Array.isArray(e),r=Array.isArray(t);return n||r?!!n&&!!r&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Object.is(e[n],t[n]))return!1;return!0}(e,t):function(e,t){if("object"!=typeof e||null===e||"object"!=typeof t||null===t||"[object Object]"!==Object.prototype.toString.call(e)||"[object Object]"!==Object.prototype.toString.call(t))return!1;let n=Object.keys(e);return n.length===Object.keys(t).length&&n.every(n=>Object.prototype.hasOwnProperty.call(t,n)&&Object.is(e[n],t[n]))}(e,t)}var noop=()=>{};function isShallowEqual(e,t){return e.isLoading===t.isLoading&&void 0===e.data==(void 0===t.data)&&void 0===e.error==(void 0===t.error)&&shallow(e.data,t.data)&&shallow(e.error,t.error)}function createAsyncCache(e,t){let n=new Map;function create(r){let i=n.get(r);return i||(i=function(e,t,n){let $asyncFunction=async()=>t(e),r={isInvalid:!0},i={isLoading:!1},o={isLoading:!1},s=makeEventSource();function notify(){let e=n?.isStateEqual??isShallowEqual;e(o,i)||(o=i,s.notify(i))}async function resolve(){if(r.promise){try{let e=await r.promise;r.isInvalid=!1,i={isLoading:!1,data:e}}catch(e){i={isLoading:!1,data:i.data,error:e}}r.promise=void 0,notify()}}async function revalidate(){return r.isInvalid=!0,get()}async function get(){return r.isInvalid&&(r.promise||(r.isInvalid=!0,r.promise=$asyncFunction(),i={isLoading:!0,data:i.data},notify()),await resolve()),i}return{...s.observable,get,getState:function(){return i},revalidate}}(r,e,t),n.set(r,i)),i}return{create,get:function(e){return create(e).get()},getState:function(e){return n.get(e)?.getState()},revalidate:function(e){return create(e).revalidate()},subscribe:function(e,t){return create(e).subscribe(t)??noop},subscribeOnce:function(e,t){return create(e).subscribeOnce(t)??noop},has:function(e){return n.has(e)},clear:function(){n.clear()}}}function stringify(e,...t){if("object"!=typeof e||null===e||Array.isArray(e))return JSON.stringify(e,...t);let n=Object.keys(e).sort().reduce((t,n)=>(t[n]=e[n],t),{});return JSON.stringify(n,...t)}var G={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},q=RegExp(Object.keys(G).map(e=>`\\${e}`).join("|"),"g"),Z=class{constructor(e,t){this._strings=e,this._values=t}toString(){return this._strings.reduce((e,t,n)=>{var r;return e+((r=nn(this._values[n-1]))instanceof Z?r.toString():Array.isArray(r)?(r.length<=0?new Z([""],[]):new Z(["",...Array(r.length-1).fill(""),""],r)).toString():String(r).replace(q,e=>G[e]))+t})}},Y={_:"\\_","*":"\\*","#":"\\#","`":"\\`","~":"\\~","!":"\\!","|":"\\|","(":"\\(",")":"\\)","{":"\\{","}":"\\}","[":"\\[","]":"\\]"},X=RegExp(Object.keys(Y).map(e=>`\\${e}`).join("|"),"g"),Q=class{constructor(e,t){this._strings=e,this._values=t}toString(){return this._strings.reduce((e,t,n)=>{var r;return e+((r=nn(this._values[n-1]))instanceof Q?r.toString():Array.isArray(r)?(r.length<=0?new Q([""],[]):new Q(["",...Array(r.length-1).fill(""),""],r)).toString():String(r).replace(X,e=>Y[e]))+t})}};detectDupes(l,u,"esm")},55579:(e,t,n)=>{"use strict";let r,i;n.d(t,{EH:()=>ClientSideSuspense,m1:()=>createRoomContext});var o=n(34705),s=n(78726),a=n(57028),d=n(6113);let fillPool=e=>{!r||r.length<e?(r=Buffer.allocUnsafe(128*e),d.randomFillSync(r),i=0):i+e>r.length&&(d.randomFillSync(r),i=0),i+=e},nanoid=(e=21)=>{fillPool(e-=0);let t="";for(let n=i-e;n<i;n++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&r[n]];return t};var l=n(85004);function ClientSideSuspense(e){let[t,n]=s.useState(!1);return s.useEffect(()=>{n(!0)},[]),s.createElement(s.Suspense,{fallback:e.fallback},t?e.children():e.fallback)}var u=class extends Error{constructor(e,t){super("Create thread failed."),this.cause=e,this.context=t,this.name="CreateThreadError"}},c=class extends Error{constructor(e,t){super("Edit thread metadata failed."),this.cause=e,this.context=t,this.name="EditThreadMetadataError"}},h=class extends Error{constructor(e,t){super("Create comment failed."),this.cause=e,this.context=t,this.name="CreateCommentError"}},p=class extends Error{constructor(e,t){super("Edit comment failed."),this.cause=e,this.context=t,this.name="EditCommentError"}},f=class extends Error{constructor(e,t){super("Delete comment failed."),this.cause=e,this.context=t,this.name="DeleteCommentError"}},m=class extends Error{constructor(e,t){super("Add reaction failed."),this.cause=e,this.context=t,this.name="AddReactionError"}},y=class extends Error{constructor(e,t){super("Remove reaction failed."),this.cause=e,this.context=t,this.name="RemoveReactionError"}};function useIsDocumentVisible(){let e=(0,l.useSyncExternalStore)(subscribe,getSnapshot,getSnapshot);return e}function subscribe(e){return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}function getSnapshot(){let e="undefined"!=typeof document;return!e||"visible"===document.visibilityState}function useIsOnline(){let e=(0,s.useRef)(!0),t=(0,s.useCallback)(t=>{function handleIsOnline(){e.current=!0,t()}function handleIsOffline(){e.current=!1,t()}return window.addEventListener("online",handleIsOnline),window.addEventListener("offline",handleIsOffline),()=>{window.removeEventListener("online",handleIsOnline),window.removeEventListener("offline",handleIsOffline)}},[]),n=(0,s.useCallback)(()=>e.current,[]),r=(0,l.useSyncExternalStore)(t,n,n);return r}var _=0;function useRevalidateCache(e,t,n={}){let r=(0,s.useRef)(!0),{dedupingInterval:i=2e3,errorRetryInterval:o=5e3,errorRetryCount:a=5}=n,d=(0,s.useCallback)(async(n,s=0)=>{let l;let u=!e.request||!n;function deleteActiveRequest(){let t=e.request;t&&t.timestamp===l&&(e.request=void 0)}try{if(u){let n=e.cache;n||(e.cache={isLoading:!0}),e.request={fetcher:t(),timestamp:++_}}let n=e.request;if(!n)return;l=n.timestamp;let r=await n.fetcher;if(u&&setTimeout(deleteActiveRequest,i),!e.request||e.request.timestamp!==l)return;let o=e.mutation;if(o&&(o.startTime>l||o.endTime>l||0===o.endTime))return;e.cache={isLoading:!1,data:r}}catch(i){deleteActiveRequest();let t="visible"===document.visibilityState,n=r.current;u&&t&&n&&function(){let e=~~((Math.random()+.5)*(1<<(s<8?s:8)))*o;s>a||setTimeout(()=>{d(!1,s+1)},e)}(),e.cache={data:e.cache?.data,isLoading:!1,error:i}}},[e,t,i,o,a]);(0,s.useEffect)(()=>{function handleIsOnline(){r.current=!0}function handleIsOffline(){r.current=!1}return window.addEventListener("online",handleIsOnline),window.addEventListener("offline",handleIsOffline),()=>{window.removeEventListener("online",handleIsOnline),window.removeEventListener("offline",handleIsOffline)}},[]);let l=(0,s.useCallback)(e=>d(e,0),[d]);return l}function useMutate(e,t){let n=(0,s.useCallback)(async(n,r)=>{let i;let o=++_;e.mutation={startTime:o,endTime:0};let s=e.cache;e.cache={isLoading:!1,data:r.optimisticData};try{await n}catch(e){i=e}let a=e.mutation;if(a&&o!==a.startTime){if(i)throw i;return}if(i&&(e.cache=s),e.mutation={startTime:o,endTime:++_},e.request=void 0,t(!1),i)throw i},[e,t]);return n}function createOptimisticId(e){return`${e}_${nanoid()}`}function useInitial(e){return(0,s.useState)(e)[0]}var g={isLoading:!1,data:void 0,error:void 0},noop=()=>{};function useAsyncCache(e,t,n){let r=useInitial(n),i=(0,s.useMemo)(()=>{if(null===t||!e)return null;let n=e.create(t);return n.get(),n},[e,t]),o=(0,s.useCallback)(e=>i?.subscribe(e)??noop,[i]),a=(0,s.useCallback)(()=>i?.getState()??g,[i]),d=(0,s.useCallback)(()=>i?.revalidate(),[i]),u=(0,l.useSyncExternalStore)(o,a,a),c=(0,s.useRef)(),h=u.data;if((0,s.useEffect)(()=>{c.current={key:t,data:u.data}},[t,u.data]),!i)return{isLoading:!1,data:void 0,error:void 0,getState:a,revalidate:d};if(r?.suspense){let e=a().error;if(e)throw e;if(a().isLoading)throw new Promise(e=>{i.subscribeOnce(t=>{t.isLoading||e()})})}return u.isLoading&&r?.keepPreviousDataWhileLoading&&void 0===u.data&&c.current?.key!==t&&void 0!==c.current?.data&&(h=c.current.data),{isLoading:u.isLoading,data:h,error:u.error,getState:a,revalidate:d}}function useLatest(e){let t=(0,s.useRef)(e);return(0,s.useEffect)(()=>{t.current=e},[e]),t}var noop2=()=>{},identity=e=>e;function useSyncExternalStore5(e,t,n){return(0,a.useSyncExternalStoreWithSelector)(e,t,n,identity)}var v=Object.freeze([]);function alwaysEmptyList(){return v}function alwaysNull(){return null}function warnIfNoResolveUsers(e){}var b=s.createContext(null);function createRoomContext(e,t){let n=s.createContext(null);function RoomProviderOuter(t){let[n]=s.useState(()=>new Map),r=s.useCallback((t,r)=>{let i=n.get(t);if(i)return i;let o=e.enterRoom(t,r),s=o.leave;return o.leave=()=>{s(),n.delete(t)},n.set(t,o),o},[n]);return s.createElement(RoomProviderInner,{...t,stableEnterRoom:r})}function RoomProviderInner(e){let{id:t,stableEnterRoom:r}=e,i=useInitial({initialPresence:e.initialPresence,initialStorage:e.initialStorage,unstable_batchedUpdates:e.unstable_batchedUpdates,autoConnect:e.autoConnect??e.shouldInitiallyConnect??"undefined"!=typeof window}),[{room:o},a]=s.useState(()=>r(t,{...i,autoConnect:!1}));return s.useEffect(()=>{let e=r(t,i);a(e);let{room:n,leave:o}=e;return i.autoConnect&&n.connect(),()=>{let e=d.get(n);e&&d.delete(n),o()}},[t,i,r]),s.createElement(n.Provider,{value:o},s.createElement(b.Provider,{value:k},e.children))}function connectionIdSelector(e){return e.map(e=>e.connectionId)}function useRoom(){let e=s.useContext(n);if(null===e)throw Error("RoomProvider is missing from the React tree.");return e}function useStatus(){let e=useRoom(),t=e.events.status.subscribe,n=e.getStatus,r=e.getStatus;return useSyncExternalStore5(t,n,r)}function useMyPresence(){let e=useRoom(),t=e.events.myPresence.subscribe,n=e.getPresence,r=useSyncExternalStore5(t,n,n),i=e.updatePresence;return[r,i]}function useUpdateMyPresence(){return useRoom().updatePresence}function useOthers(e,t){let n=useRoom(),r=n.events.others.subscribe,i=n.getOthers;return(0,a.useSyncExternalStoreWithSelector)(r,i,alwaysEmptyList,e??identity,t)}function useOthersConnectionIds(){return useOthers(connectionIdSelector,o.Xd)}function useOthersMapped(e,t){let n=s.useCallback(t=>t.map(t=>[t.connectionId,e(t)]),[e]),r=s.useCallback((e,n)=>{let r=t??Object.is;return e.length===n.length&&e.every((e,t)=>{let i=n[t];return e[0]===i[0]&&r(e[1],i[1])})},[t]);return useOthers(n,r)}let r=Symbol();function useOther(e,t,n){let i=s.useCallback(n=>{let i=n.find(t=>t.connectionId===e);return void 0!==i?t(i):r},[e,t]),o=s.useCallback((e,t)=>{if(e===r||t===r)return e===t;let i=n??Object.is;return i(e,t)},[n]),a=useOthers(i,o);if(a===r)throw Error(`No such other user with connection id ${e} exists`);return a}function useBroadcastEvent(){let e=useRoom();return s.useCallback((t,n={shouldQueueEventIfNotReady:!1})=>{e.broadcastEvent(t,n)},[e])}function useOthersListener(e){let t=useRoom(),n=useLatest(e);s.useEffect(()=>t.events.others.subscribe(e=>n.current(e)),[t,n])}function useLostConnectionListener(e){let t=useRoom(),n=useLatest(e);s.useEffect(()=>t.events.lostConnection.subscribe(e=>n.current(e)),[t,n])}function useErrorListener(e){let t=useRoom(),n=useLatest(e);s.useEffect(()=>t.events.error.subscribe(e=>n.current(e)),[t,n])}function useEventListener(e){let t=useRoom(),n=useLatest(e);s.useEffect(()=>t.events.customEvent.subscribe(e=>{n.current(e)}),[t,n])}function useSelf(e,t){let n=useRoom(),r=n.events.self.subscribe,i=n.getSelf,o=e??identity,d=s.useCallback(e=>null!==e?o(e):null,[o]);return(0,a.useSyncExternalStoreWithSelector)(r,i,alwaysNull,d,t)}function useMutableStorageRoot(){let e=useRoom(),t=e.events.storageDidLoad.subscribeOnce,n=e.getStorageSnapshot;return useSyncExternalStore5(t,n,alwaysNull)}function useStorageRoot(){return[useMutableStorageRoot()]}function useHistory(){return useRoom().history}function useUndo(){return useHistory().undo}function useRedo(){return useHistory().redo}function useCanUndo(){let e=useRoom(),t=e.events.history.subscribe,n=e.history.canUndo;return useSyncExternalStore5(t,n,n)}function useCanRedo(){let e=useRoom(),t=e.events.history.subscribe,n=e.history.canRedo;return useSyncExternalStore5(t,n,n)}function useBatch(){return useRoom().batch}function useLegacyKey(e){let t=useRoom(),n=useMutableStorageRoot(),r=function(){let[,e]=(0,s.useReducer)(e=>e+1,0);return e}();return(s.useEffect(()=>{let i;if(null===n)return;let s=n.get(e);function subscribeToCurr(){i=(0,o.I6)(s)?t.subscribe(s,r):void 0}subscribeToCurr(),r();let a=t.subscribe(n,function(){let t=n.get(e);t!==s&&(i?.(),s=t,subscribeToCurr(),r())});return()=>{a(),i?.()}},[n,t,e,r]),null===n)?null:n.get(e)}function useStorage(e,t){let n=useRoom(),r=useMutableStorageRoot(),i=s.useCallback(t=>null!==t?e(t):null,[e]),o=s.useCallback(e=>null!==r?n.subscribe(r,e,{isDeep:!0}):noop2,[n,r]),d=s.useCallback(()=>{if(null===r)return null;{let e=r.toImmutable();return e}},[r]);return(0,a.useSyncExternalStoreWithSelector)(o,d,alwaysNull,i,t)}function ensureNotServerSide(){if("undefined"==typeof window)throw Error("You cannot use the Suspense version of this hook on the server side. Make sure to only call them on the client side.\nFor tips, see https://liveblocks.io/docs/api-reference/liveblocks-react#suspense-avoid-ssr")}function useSuspendUntilStorageLoaded(){let e=useRoom();if(null===e.getStorageSnapshot())throw ensureNotServerSide(),new Promise(t=>{e.events.storageDidLoad.subscribeOnce(()=>t())})}function useSuspendUntilPresenceLoaded(){let e=useRoom();if(null===e.getSelf())throw ensureNotServerSide(),new Promise(t=>{e.events.self.subscribeOnce(()=>t()),e.events.status.subscribeOnce(()=>t())})}function useMutation(e,t){let n=useRoom();return s.useMemo(()=>(...t)=>n.batch(()=>e(function(e){let t="This mutation cannot be used until connected to the Liveblocks room";return{get storage(){let n=e.getStorageSnapshot();if(null===n)throw Error(t);return n},get self(){let n=e.getSelf();if(null===n)throw Error(t);return n},get others(){let n=e.getOthers();if(null===e.getSelf())throw Error(t);return n},setMyPresence:e.updatePresence}}(n),...t)),[n,...t])}function useLegacyKeySuspense(e){return useSuspendUntilStorageLoaded(),useLegacyKey(e)}let i=(0,o.Zb)(),d=new Map;function getCommentsRoom(e){let t=d.get(e);return void 0===t&&(t=function(e,t){let n=function(){let e,t,n;let r=(0,o.Zb)();return{get cache(){return e},set cache(value){e=value,r.notify(e)},get request(){return t},set request(value){t=value},get mutation(){return n},set mutation(value){n=value},subscribe:e=>r.subscribe(e)}}();function _useThreads(t){let r=(0,l.useSyncExternalStore)(e.events.status.subscribe,e.getStatus,e.getStatus),i=useIsOnline(),o=useIsDocumentVisible(),a=function(e,t,n){if(e&&t)return n?3e4:5e3}(i,o,"connected"===r);(function(e,t,n={}){let r=useIsOnline(),i=useIsDocumentVisible(),{revalidateOnFocus:o=!0,revalidateOnReconnect:a=!0,refreshInterval:d=0}=n;(0,s.useEffect)(()=>{let n;return function scheduleRevalidation(){0!==d&&(n=window.setTimeout(()=>{if(r&&i&&!e.cache?.error){t(!0).then(scheduleRevalidation);return}scheduleRevalidation()},d))}(),()=>{window.clearTimeout(n)}},[t,d,r,i,e]),(0,s.useEffect)(()=>{function handleIsOnline(){a&&i&&t(!0)}return window.addEventListener("online",handleIsOnline),()=>{window.removeEventListener("online",handleIsOnline)}},[t,a,i]),(0,s.useEffect)(()=>{function handleVisibilityChange(){let e="visible"===document.visibilityState;o&&e&&r&&t(!0)}return document.addEventListener("visibilitychange",handleVisibilityChange),()=>{document.removeEventListener("visibilitychange",handleVisibilityChange)}},[t,o,r])})(n,t,{revalidateOnFocus:!0,revalidateOnReconnect:!0,refreshInterval:a}),(0,s.useEffect)(()=>{let n=e.events.comments.subscribe(()=>{t(!0)});return()=>{n()}},[t]);let d=(0,l.useSyncExternalStore)(n.subscribe,()=>n.cache,()=>n.cache);return!d||d.isLoading?{isLoading:!0}:{isLoading:d.isLoading,threads:d.data??[],error:d.error}}function getThreads(){let e=n.cache;if(!e||e.isLoading||e.error||void 0===e.data)throw Error("Cannot update threads or comments before they are loaded.");return e.data}function getCurrentUserId(){let t=e.getSelf();return null===t||void 0===t.id?"anonymous":t.id}function handleCommentsApiError(e){let t=`Request failed with status ${e.status}: ${e.message}`;if(e.details?.error==="FORBIDDEN"){let n=[t,e.details.suggestion,e.details.docs].filter(Boolean).join("\n");o.iV.error(n)}return Error(t)}return{useThreads:function(){let t=useRevalidateCache(n,e.getThreads);return(0,s.useEffect)(()=>{t(!0)},[t]),_useThreads(t)},useThreadsSuspense:function(){let t=useRevalidateCache(n,e.getThreads),r=_useThreads(t);if(r.error)throw r.error;if(r.isLoading||!r.threads)throw t(!0);return{threads:r.threads,isLoading:!1}},useCreateThread:function(){let r=useRevalidateCache(n,e.getThreads),i=useMutate(n,r),a=(0,s.useCallback)(n=>{let r=n.body,s="metadata"in n?n.metadata:{},a=getThreads(),d=createOptimisticId("th"),l=createOptimisticId("cm"),c=new Date().toISOString(),h={id:l,threadId:d,roomId:e.id,createdAt:c,type:"comment",userId:getCurrentUserId(),body:r,reactions:[]},p={id:d,type:"thread",createdAt:c,roomId:e.id,metadata:s,comments:[h]};return i(e.createThread({threadId:d,commentId:l,body:r,metadata:s}),{optimisticData:[...a,p]}).catch(n=>{if(!(n instanceof o.iz))throw n;let i=handleCommentsApiError(n);t.notify(new u(i,{roomId:e.id,threadId:d,commentId:l,body:r,metadata:s}))}),p},[i]);return a},useEditThreadMetadata:function(){let r=useRevalidateCache(n,e.getThreads),i=useMutate(n,r),a=(0,s.useCallback)(n=>{let r=n.threadId,s="metadata"in n?n.metadata:{},a=getThreads(),d=a.map(e=>e.id===r?{...e,metadata:{...e.metadata,...s}}:e);i(e.editThreadMetadata({metadata:s,threadId:r}),{optimisticData:d}).catch(n=>{if(!(n instanceof o.iz))throw n;let i=handleCommentsApiError(n);t.notify(new c(i,{roomId:e.id,threadId:r,metadata:s}))})},[i]);return a},useCreateComment:function(){let r=useRevalidateCache(n,e.getThreads),i=useMutate(n,r),a=(0,s.useCallback)(({threadId:n,body:r})=>{let s=getThreads(),a=createOptimisticId("cm"),d=new Date().toISOString(),l={id:a,threadId:n,roomId:e.id,type:"comment",createdAt:d,userId:getCurrentUserId(),body:r,reactions:[]},u=s.map(e=>e.id===n?{...e,comments:[...e.comments,l]}:e);return i(e.createComment({threadId:n,commentId:a,body:r}),{optimisticData:u}).catch(i=>{if(!(i instanceof o.iz))throw i;let s=handleCommentsApiError(i);t.notify(new h(s,{roomId:e.id,threadId:n,commentId:a,body:r}))}),l},[i]);return a},useEditComment:function(){let r=useRevalidateCache(n,e.getThreads),i=useMutate(n,r),a=(0,s.useCallback)(({threadId:n,commentId:r,body:s})=>{let a=getThreads(),d=new Date().toISOString(),l=a.map(e=>e.id===n?{...e,comments:e.comments.map(e=>e.id===r?{...e,editedAt:d,body:s}:e)}:e);i(e.editComment({threadId:n,commentId:r,body:s}),{optimisticData:l}).catch(i=>{if(!(i instanceof o.iz))throw i;let a=handleCommentsApiError(i);t.notify(new p(a,{roomId:e.id,threadId:n,commentId:r,body:s}))})},[i]);return a},useDeleteComment:function(){let r=useRevalidateCache(n,e.getThreads),i=useMutate(n,r),a=(0,s.useCallback)(({threadId:n,commentId:r})=>{let s=getThreads(),a=new Date().toISOString(),d=[];for(let e of s)if(e.id===n){let t={...e,comments:e.comments.map(e=>e.id===r?{...e,deletedAt:a,body:void 0}:e)};t.comments.some(e=>void 0===e.deletedAt)&&d.push(t)}else d.push(e);i(e.deleteComment({threadId:n,commentId:r}),{optimisticData:d}).catch(i=>{if(!(i instanceof o.iz))throw i;let s=handleCommentsApiError(i);t.notify(new f(s,{roomId:e.id,threadId:n,commentId:r}))})},[i]);return a},useAddReaction:function(){let r=useRevalidateCache(n,e.getThreads),i=useMutate(n,r),a=(0,s.useCallback)(({threadId:n,commentId:r,emoji:s})=>{let a=getThreads(),d=new Date().toISOString(),l=getCurrentUserId(),u=a.map(e=>e.id===n?{...e,comments:e.comments.map(e=>{let t;return e.id!==r?e:(t=e.reactions.some(e=>e.emoji===s)?e.reactions.map(e=>e.emoji===s?{...e,users:[...e.users,{id:l}]}:e):[...e.reactions,{emoji:s,createdAt:d,users:[{id:l}]}],{...e,reactions:t})})}:e);i(e.addReaction({threadId:n,commentId:r,emoji:s}),{optimisticData:u}).catch(i=>{if(!(i instanceof o.iz))throw i;let a=handleCommentsApiError(i);t.notify(new m(a,{roomId:e.id,threadId:n,commentId:r,emoji:s}))})},[i]);return a},useRemoveReaction:function(){let r=useRevalidateCache(n,e.getThreads),i=useMutate(n,r),a=(0,s.useCallback)(({threadId:n,commentId:r,emoji:s})=>{let a=getThreads(),d=getCurrentUserId(),l=a.map(e=>e.id===n?{...e,comments:e.comments.map(e=>{if(e.id!==r)return e;let t=e.reactions.findIndex(e=>e.emoji===s),n=e.reactions;return t>=0&&e.reactions[t].users.some(e=>e.id===d)&&(e.reactions[t].users.length<=1?(n=[...e.reactions]).splice(t,1):n[t]={...n[t],users:n[t].users.filter(e=>e.id!==d)}),{...e,reactions:n}})}:e);i(e.removeReaction({threadId:n,commentId:r,emoji:s}),{optimisticData:l}).catch(i=>{if(!(i instanceof o.iz))throw i;let a=handleCommentsApiError(i);t.notify(new y(a,{roomId:e.id,threadId:n,commentId:r,emoji:s}))})},[i]);return a}}}(e,i),d.set(e,t)),t}function useCreateThread(){let e=useRoom();return getCommentsRoom(e).useCreateThread()}function useEditThreadMetadata(){let e=useRoom();return getCommentsRoom(e).useEditThreadMetadata()}function useAddReaction(){let e=useRoom();return getCommentsRoom(e).useAddReaction()}function useRemoveReaction(){let e=useRoom();return getCommentsRoom(e).useRemoveReaction()}function useCreateComment(){let e=useRoom();return getCommentsRoom(e).useCreateComment()}function useEditComment(){let e=useRoom();return getCommentsRoom(e).useEditComment()}function useDeleteComment(){let e=useRoom();return getCommentsRoom(e).useDeleteComment()}let{resolveUsers:_,resolveMentionSuggestions:g}=t??{},v=_?(0,o.$s)(async e=>{let t=await _(JSON.parse(e));return t?.[0]}):void 0,E=(0,o.$s)(g?e=>g(JSON.parse(e)):()=>Promise.resolve([])),S={RoomContext:n,RoomProvider:RoomProviderOuter,useRoom,useStatus,useBatch,useBroadcastEvent,useOthersListener,useLostConnectionListener,useErrorListener,useEventListener,useHistory,useUndo,useRedo,useCanRedo,useCanUndo,useList:useLegacyKey,useMap:useLegacyKey,useObject:useLegacyKey,useStorageRoot,useStorage,useSelf,useMyPresence,useUpdateMyPresence,useOthers,useOthersMapped,useOthersConnectionIds,useOther,useMutation,useThreads:function(){let e=useRoom();return getCommentsRoom(e).useThreads()},useUser:function(e){let t=useRoom(),n=s.useMemo(()=>(0,o.Pz)({userIds:[e],roomId:t.id}),[e,t.id]),r=useAsyncCache(v,n);return(s.useEffect(()=>warnIfNoResolveUsers(v),[]),r.isLoading)?{isLoading:!0}:{user:r.data,error:r.error,isLoading:!1}},useCreateThread,useEditThreadMetadata,useCreateComment,useEditComment,useDeleteComment,useAddReaction,useRemoveReaction,suspense:{RoomContext:n,RoomProvider:RoomProviderOuter,useRoom,useStatus,useBatch,useBroadcastEvent,useOthersListener,useLostConnectionListener,useErrorListener,useEventListener,useHistory,useUndo,useRedo,useCanRedo,useCanUndo,useList:useLegacyKeySuspense,useMap:useLegacyKeySuspense,useObject:useLegacyKeySuspense,useStorageRoot,useStorage:function(e,t){return useSuspendUntilStorageLoaded(),useStorage(e,t)},useSelf:function(e,t){return useSuspendUntilPresenceLoaded(),useSelf(e,t)},useMyPresence,useUpdateMyPresence,useOthers:function(e,t){return useSuspendUntilPresenceLoaded(),useOthers(e,t)},useOthersMapped:function(e,t){return useSuspendUntilPresenceLoaded(),useOthersMapped(e,t)},useOthersConnectionIds:function(){return useSuspendUntilPresenceLoaded(),useOthersConnectionIds()},useOther:function(e,t,n){return useSuspendUntilPresenceLoaded(),useOther(e,t,n)},useMutation,useThreads:function(){let e=useRoom();return getCommentsRoom(e).useThreadsSuspense()},useUser:function(e){let t=useRoom(),n=s.useMemo(()=>(0,o.Pz)({userIds:[e],roomId:t.id}),[e,t.id]),r=useAsyncCache(v,n,{suspense:!0});return s.useEffect(()=>warnIfNoResolveUsers(v),[]),{user:r.data,isLoading:!1}},useCreateThread,useEditThreadMetadata,useCreateComment,useEditComment,useDeleteComment,useAddReaction,useRemoveReaction}},k={...S,hasResolveMentionSuggestions:void 0!==g,useMentionSuggestions:function(e){let t=useRoom(),n=function(e,t=500){let n=(0,s.useRef)(),[r,i]=(0,s.useState)(e);return(0,s.useEffect)(()=>{if(!1!==t)return void 0===n.current&&i(e),n.current=window.setTimeout(()=>{i(e),n.current=void 0},t),()=>{window.clearTimeout(n.current)}},[e,t]),r}(e,500),r=s.useMemo(()=>void 0!==n?(0,o.Pz)({text:n,roomId:t.id}):null,[n,t.id]),{data:i}=useAsyncCache(E,r,{keepPreviousDataWhileLoading:!0});return i}};return S}(0,o.l8)("@liveblocks/react","1.8.2","esm")},42120:(e,t,n)=>{"use strict";n.d(t,{_:()=>useAnimation});var r=n(79458),i=n(67537),o=n(63394);function animationControls(){let e=!1,t=new Set,n={subscribe:e=>(t.add(e),()=>void t.delete(e)),start(n,i){(0,r.k)(e,"controls.start() should only be called after a component has mounted. Consider calling within a useEffect hook.");let s=[];return t.forEach(e=>{s.push((0,o.d)(e,n,{transitionOverride:i}))}),Promise.all(s)},set:n=>((0,r.k)(e,"controls.set() should only be called after a component has mounted. Consider calling within a useEffect hook."),t.forEach(e=>{(0,i.gg)(e,n)})),stop(){t.forEach(e=>{!function(e){e.values.forEach(e=>e.stop())}(e)})},mount:()=>(e=!0,()=>{e=!1,n.stop()})};return n}var s=n(37116),a=n(5249);let useAnimation=function(){let e=(0,s.h)(animationControls);return(0,a.L)(e.mount,[]),e}}};