"use strict";(()=>{var e={};e.id=9871,e.ids=[9871],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},204:(e,r,s)=>{s.r(r),s.d(r,{headerHooks:()=>P,originalPathname:()=>j,requestAsyncStorage:()=>g,routeModule:()=>w,serverHooks:()=>f,staticGenerationAsyncStorage:()=>x,staticGenerationBailout:()=>S});var a={};s.r(a),s.d(a,{POST:()=>POST}),s(44388);var t=s(15789),o=s(74902),i=s(46251),n=s(65773),l=s(50532),d=s(70914),u=s(73867),p=s(66355),c=s(31349),m=s(66412);let h=u.z.object({email:u.z.string().email(),password:u.z.string()}),POST=async e=>{let r=await e.formData(),{set:s}=(0,l.cookies)(),a=String(r.get("email")),t=String(r.get("password")),o=h.safeParse({email:a,password:t});if(!o.success)return console.log(`BadRequest: ${JSON.stringify({email:a,password:t},null,2)}`),d.Z.json({error:o.error},{status:400});let u=await getPasswordHashForUserByEmailAddress(o.data.email);if(!u)return d.Z.json({error:{email:"No user found with that email address"}},{status:401});let{email:p,passwordHash:c,publicId:m}=u;if(!c)return d.Z.json({error:{password:"Incorrect password"}},{status:401});let w=await (0,i.j)(c,o.data.password);if(!w)return d.Z.json({error:{password:"Incorrect password"}},{status:401});let g=await (0,n.hE)(p,e),x=new URL(e.url);return s("sessionToken",g.token,{expires:g.expirationDate,secure:!0,domain:x.hostname,sameSite:"strict",httpOnly:!0,path:"/"}),d.Z.json({email:p,id:m})},getPasswordHashForUserByEmailAddress=async e=>{let r=await p.db.select({passwordHash:m.rC.passwordHash,email:m.rC.email,publicId:m.rC.publicId}).from(m.rC).where((0,c.eq)(m.rC.email,e)).limit(1).execute(),s=r[0];return s},w=new t.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/login/email/route",pathname:"/api/auth/login/email",filename:"route",bundlePath:"app/api/auth/login/email/route"},resolvedPagePath:"/home/shovonh/workspaces/anveio/apps/blog/src/app/api/auth/login/email/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:x,serverHooks:f,headerHooks:P,staticGenerationBailout:S}=w,j="/api/auth/login/email/route"},46251:(e,r,s)=>{s.d(r,{j:()=>doesPasswordMatchHash,c:()=>hashPassword});let a=require("argon2"),t=process.env.PASSWORD_SALT;if(!t)throw Error("PASSWORD_SALT is not defined");let hashPassword=e=>(0,a.hash)(e,{salt:Buffer.from(t)}),doesPasswordMatchHash=async(e,r)=>(0,a.verify)(e,r)}};var r=require("../../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),s=r.X(0,[7534,3369,3077,3867,962,1861,914,9654,5773],()=>__webpack_exec__(204));module.exports=s})();